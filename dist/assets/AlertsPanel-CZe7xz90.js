import{j as e}from"./vendor-ui-BGGfvU-n.js";import{a as i}from"./vendor-react-BiKKw5Rc.js";import{a as $}from"./analyticsConfig-Di1mAdDI.js";import{u as P,C as w,b as T,d as F,e as L,B as x,j as g,J as j}from"./index-p40y1I9K.js";import{B as p}from"./badge-XQGYYPGp.js";import{T as z}from"./textarea-2v1IUrdg.js";import{D as H,a as J,b as M,c as V,d as q,e as G}from"./dialog-91XSgeKl.js";import{d as u}from"./analyticsManager-D5rdgc0M.js";import{l as I}from"./logger-Bi5o39IC.js";import{C as K}from"./circle-check-big-DUkzVwRO.js";import{E as O}from"./eye-CGa4_C8K.js";import{T as Q}from"./trending-up-B9AG_QY6.js";import"./3d-DUDogAyU.js";import"./vendor-utils-BNQKEpbf.js";import"./i18n-DNqVcHxj.js";import"./x-CtjkR7Fw.js";import"./enhancedPatternAnalysis-BSzs8ls5.js";import"./ml-BTt1mEdE.js";import"./storageUtils-DyonkL-b.js";import"./dataStorage-ZXqbZ8jG.js";const U=({studentId:n,showOnlyUnresolved:o=!1})=>{const{tAnalytics:t,tCommon:l}=P(),[f,D]=i.useState([]),[a,c]=i.useState(null),[v,h]=i.useState(""),[N,b]=i.useState(!1),d=i.useCallback(()=>{let s;n?s=u.getStudentAlerts(n):s=u.getAllAlerts(),o&&(s=s.filter(m=>!m.resolved));const r=[...s].sort((m,S)=>{const A={high:3,medium:2,low:1},C=A[S.alert.severity]-A[m.alert.severity];return C!==0?C:S.alert.timestamp.getTime()-m.alert.timestamp.getTime()});D(r)},[n,o]);i.useEffect(()=>{d()},[d]);const k=s=>{u.markAlertAsViewed(s),d(),j.success("Alert marked as viewed")},B=()=>{if(a){b(!0);try{u.resolveAlert(a.alert.id,"Teacher",v.trim()||void 0),c(null),h(""),d(),j.success("Alert resolved successfully")}catch(s){I.error("Failed to resolve alert",s),j.error("Failed to resolve alert. Please try again.")}finally{b(!1)}}},R=s=>{switch(s){case"high":return e.jsx(g,{className:"h-4 w-4 text-destructive"});case"medium":return e.jsx(g,{className:"h-4 w-4 text-warning"});case"low":return e.jsx(Q,{className:"h-4 w-4 text-info"});default:return e.jsx(g,{className:"h-4 w-4"})}},y=s=>{switch(s){case"high":return"destructive";case"medium":return"default";case"low":return"secondary";default:return"outline"}};return f.length===0?e.jsx(w,{children:e.jsx(T,{className:"pt-6",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(K,{className:"h-8 w-8 mx-auto mb-2 text-success"}),e.jsx("p",{children:String(t(o?"alerts.noneUnresolved":"alerts.none"))})]})})}):e.jsx("div",{className:"space-y-4",children:f.map(s=>e.jsxs(w,{className:`transition-all ${s.viewed?"":"ring-2 ring-primary/20"}`,children:[e.jsx(F,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1",children:R(s.alert.severity)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(L,{className:"text-base font-semibold",children:s.alert.title}),e.jsx(p,{variant:y(s.alert.severity),children:s.alert.severity}),e.jsx(p,{variant:"outline",className:"text-xs",children:s.alert.type})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:s.alert.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsx("span",{children:s.alert.timestamp.toLocaleDateString()}),e.jsxs("span",{children:[s.alert.dataPoints," data points"]}),s.resolved&&e.jsx(p,{variant:"outline",className:"text-success-foreground bg-success",children:"Resolved"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!s.viewed&&e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>k(s.alert.id),children:e.jsx(O,{className:"h-4 w-4"})}),!s.resolved&&e.jsxs(H,{open:a?.alert.id===s.alert.id,onOpenChange:r=>{r?c(s):(c(null),h(""))},children:[e.jsx(J,{asChild:!0,children:e.jsx(x,{variant:"outline",size:"sm",children:String(l("resolve"))})}),e.jsxs(M,{children:[e.jsxs(V,{children:[e.jsx(q,{children:String(t("alerts.resolveTitle"))}),e.jsx(G,{children:"Review details and add resolution notes before confirming."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:String(t("alerts.details"))}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:a?.alert.description}),a?.alert.recommendations&&a.alert.recommendations.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-medium mb-2",children:[String(l("recommendations")),":"]}),e.jsx("ul",{className:"text-sm text-muted-foreground space-y-1",children:a.alert.recommendations.map(r=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary",children:"•"}),e.jsx("span",{children:r})]},`${a.alert.id}-${r}`))})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"resolution-notes",className:"text-sm font-medium mb-2 block",children:String(t("alerts.resolutionNotes"))}),e.jsx(z,{id:"resolution-notes",value:v,onChange:r=>h(r.target.value),placeholder:"Describe actions taken or observations...",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(x,{variant:"outline",onClick:()=>c(null),children:String(l("cancel"))}),e.jsx(x,{onClick:B,disabled:N,children:String(N?l("resolving"):t("alerts.resolveTitle"))})]})]})]})]})]})]})}),s.alert.recommendations&&s.alert.recommendations.length>0&&e.jsxs(T,{className:"pt-0",children:[e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3",children:[e.jsxs("h4",{className:"text-sm font-medium mb-2 text-foreground",children:[String(t("alerts.recommendedActions")),":"]}),e.jsx("ul",{className:"text-sm text-muted-foreground space-y-1",children:s.alert.recommendations.map(r=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary",children:"•"}),e.jsx("span",{children:r})]},`${s.alert.id}-${r}`))})]}),s.resolved&&s.resolvedNotes&&e.jsxs("div",{className:"mt-3 bg-success/10 border border-success/20 rounded-lg p-3",children:[e.jsxs("h5",{className:"text-sm font-medium text-success-foreground mb-1",children:[String(t("alerts.resolutionNotes")),":"]}),e.jsx("p",{className:"text-sm text-success-foreground/80",children:s.resolvedNotes}),e.jsxs("p",{className:"text-xs text-success-foreground/60 mt-1",children:[String(t("alerts.resolvedBy"))," ",s.resolvedBy," ",String(l("on"))," ",s.resolvedAt?.toLocaleDateString()]})]})]})]},s.alert.id))})},he=i.memo(function({filteredData:o,studentId:t}){return $.getThresholds?.(),e.jsx("div",{className:"space-y-4",children:e.jsx(U,{studentId:t})})});export{he as AlertsPanel};
