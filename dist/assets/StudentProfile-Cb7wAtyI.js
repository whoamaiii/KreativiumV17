const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AnalyticsDashboard-D_6BNLBO.js","assets/3d-DUDogAyU.js","assets/vendor-react-BiKKw5Rc.js","assets/vendor-ui-BGGfvU-n.js","assets/index-p40y1I9K.js","assets/vendor-utils-BNQKEpbf.js","assets/logger-Bi5o39IC.js","assets/i18n-DNqVcHxj.js","assets/index-uIufv1TD.css","assets/tabs-Ctr851dG.js","assets/dropdown-menu-7gruBPiX.js","assets/check-JkTn6zF0.js","assets/label-DPtwVyR_.js","assets/slider-BzqSx8sm.js","assets/dialog-91XSgeKl.js","assets/x-CtjkR7Fw.js","assets/analyticsConfig-Di1mAdDI.js","assets/enhancedPatternAnalysis-BSzs8ls5.js","assets/ml-BTt1mEdE.js","assets/progress-DZC4VRn8.js","assets/badge-XQGYYPGp.js","assets/analyticsExport-NqB-BhO_.js","assets/zap-DStDXklo.js","assets/brain-BaLNfPwJ.js","assets/loader-circle-D6K3-BGk.js","assets/download-B5AHGw6a.js","assets/save-C79c2pc2.js","assets/usePerformanceCache-BszGIQAI.js","assets/diagnostics-BmeDtVon.js","assets/analyticsManager-D5rdgc0M.js","assets/storageUtils-DyonkL-b.js","assets/dataStorage-ZXqbZ8jG.js","assets/file-text-x8qZG1DU.js","assets/chart-column-RudVS-6d.js","assets/eye-CGa4_C8K.js","assets/trending-up-B9AG_QY6.js"])))=>i.map(i=>d[i]);
import{j as e,k as Ce}from"./vendor-ui-BGGfvU-n.js";import{a as d,R as bt,u as ot,d as gt,j as Xt}from"./vendor-react-BiKKw5Rc.js";import{c as W,T as es,a as R,B as M,f as ts,g as ss,h as as,i as ns,u as Z,C as D,b as T,d as E,e as O,j as Fe,R as rs,E as le,J as z,P as $e,k as ht}from"./index-p40y1I9K.js";import{I as oe}from"./input-Gpuq0ah-.js";import{S as is}from"./separator-D0mNSZsN.js";import{S as os,a as ls,C as cs,T as Se,b as K,P as vt,c as Nt,d as wt,e as St,F as ds}from"./popover-CvKzu0vF.js";import{S as J}from"./skeleton-Cw78M60-.js";import{l as L}from"./logger-Bi5o39IC.js";import{B as I}from"./badge-XQGYYPGp.js";import{S as ue,a as ge,b as he,c as xe,d as B,C as lt}from"./select-Df25Jq5p.js";import{C as ms}from"./dropdown-menu-7gruBPiX.js";import{P as Q}from"./progress-DZC4VRn8.js";import{k as ne,l as ce,m as us,f as V,j as de,n as ve,o as xt,p as se,q as ae,r as Le,u as gs,v as hs,w as xs,h as ps}from"./vendor-utils-BNQKEpbf.js";import{C as kt}from"./circle-alert-C4zRNhqb.js";import{C as Y}from"./circle-check-big-DUkzVwRO.js";import{T as te}from"./trending-up-B9AG_QY6.js";import{C as re}from"./chart-column-RudVS-6d.js";import{C as pe}from"./clock-3bmf-fze.js";import{a as Ne}from"./analyticsManager-D5rdgc0M.js";import{d as q}from"./dataStorage-ZXqbZ8jG.js";import{B as Ct}from"./brain-BaLNfPwJ.js";import{A as Ye,Z as Ke}from"./zap-DStDXklo.js";import{P as we,U as fs}from"./user-CQXHlJDq.js";import{I as js,T as ys,a as bs,b as Me,c as Pe}from"./tabs-Ctr851dG.js";import{_ as vs}from"./3d-DUDogAyU.js";import{C as Ue}from"./checkbox-wCMB9JkF.js";import{X as fe}from"./x-CtjkR7Fw.js";import{D as Dt,a as Tt,b as Mt,c as Pt,d as It,e as Rt}from"./dialog-91XSgeKl.js";import{T as Qe}from"./textarea-2v1IUrdg.js";import{T as At}from"./trash-2-J27CM5os.js";import{T as Ns}from"./trending-down-8q66-3MU.js";import{L as ie}from"./label-DPtwVyR_.js";import{b as ws,E as me}from"./ChartKit-BStub1tR.js";import{L as Ss}from"./LazyReportBuilder-ayOTdqok.js";import{c as ks,p as Cs,e as Ve}from"./enhancedPatternAnalysis-BSzs8ls5.js";import{u as Ds}from"./usePerformanceCache-BszGIQAI.js";import{exportSystem as Ie}from"./exportSystem-Cd06BMud.js";import{L as Ts}from"./LanguageSettings-DP-p1Cso.js";import{G as Ms}from"./GlobalMenu-CEfZkLK-.js";import{A as Ps}from"./arrow-left-DTqb6Oho.js";import{F as Is}from"./file-text-x8qZG1DU.js";import{D as Rs}from"./download-B5AHGw6a.js";import{S as As}from"./save-C79c2pc2.js";import"./i18n-DNqVcHxj.js";import"./check-JkTn6zF0.js";import"./analyticsConfig-Di1mAdDI.js";import"./storageUtils-DyonkL-b.js";import"./charts-B1guaMDk.js";import"./chartRegistry-BLFZNPaW.js";import"./LazyLoadWrapper-CBZYyc2T.js";import"./loader-circle-D6K3-BGk.js";import"./ml-BTt1mEdE.js";import"./hand-DEREcSp_.js";import"./wrench-jYO5Gt6b.js";/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=W("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _s=W("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=W("ChartPie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]);/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=W("ChevronsLeft",[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]]);/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=W("ChevronsRight",[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]]);/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=W("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=W("Crosshair",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]]);/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=W("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]);/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=W("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=W("PanelLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]]);/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=W("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=W("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=W("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),We=768;function Us(){const[t,s]=d.useState(void 0);return d.useEffect(()=>{const a=window.matchMedia(`(max-width: ${We-1}px)`),o=()=>{s(window.innerWidth<We)};return a.addEventListener("change",o),s(window.innerWidth<We),()=>{a.removeEventListener&&a.removeEventListener("change",o)}},[]),!!t}const Vs="sidebar:state",qs=3600*24*7,Ws="16rem",Hs="18rem",Ys="3rem",Ks="b",_t=d.createContext(null);function De(){const t=d.useContext(_t);if(!t)throw new Error("useSidebar must be used within a SidebarProvider.");return t}const Ot=d.forwardRef(({defaultOpen:t=!0,open:s,onOpenChange:a,className:o,style:r,children:c,...x},g)=>{const n=Us(),[l,h]=d.useState(!1),[u,i]=d.useState(t),f=s??u,k=d.useCallback(y=>{const j=typeof y=="function"?y(f):y;a?a(j):i(j),document.cookie=`${Vs}=${j}; path=/; max-age=${qs}`},[a,f]),N=d.useCallback(()=>n?h(y=>!y):k(y=>!y),[n,k,h]);d.useEffect(()=>{const y=j=>{j.key===Ks&&(j.metaKey||j.ctrlKey)&&(j.preventDefault(),N())};return window.addEventListener("keydown",y),()=>window.removeEventListener("keydown",y)},[N]);const p=f?"expanded":"collapsed",m=d.useMemo(()=>({state:p,open:f,setOpen:k,isMobile:n,openMobile:l,setOpenMobile:h,toggleSidebar:N}),[p,f,k,n,l,h,N]);return e.jsx(_t.Provider,{value:m,children:e.jsx(es,{delayDuration:0,children:e.jsx("div",{style:{"--sidebar-width":Ws,"--sidebar-width-icon":Ys,...r},className:R("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",o),ref:g,...x,children:c})})})});Ot.displayName="SidebarProvider";const Ft=d.forwardRef(({side:t="left",variant:s="sidebar",collapsible:a="offcanvas",className:o,children:r,...c},x)=>{const{isMobile:g,state:n,openMobile:l,setOpenMobile:h}=De();return a==="none"?e.jsx("div",{className:R("flex h-full w-[--sidebar-width] flex-col bg-bg-secondary border-r border-border-color text-text-primary",o),ref:x,...c,children:r}):g?e.jsx(os,{open:l,onOpenChange:h,...c,children:e.jsx(ls,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-bg-secondary border-border-color p-0 text-text-primary [&>button]:hidden",style:{"--sidebar-width":Hs},side:t,children:e.jsx("div",{className:"flex h-full w-full flex-col",children:r})})}):e.jsxs("div",{ref:x,className:"group peer hidden md:block text-text-primary pointer-events-auto","data-state":n,"data-collapsible":n==="collapsed"?a:"","data-variant":s,"data-side":t,children:[e.jsx("div",{className:R("duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear pointer-events-none","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",s==="floating"||s==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),e.jsx("div",{className:R("duration-200 fixed inset-y-0 z-[60] hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex",t==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",s==="floating"||s==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l border-border-color",o),...c,children:e.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-bg-secondary group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-border-color group-data-[variant=floating]:shadow-lg backdrop-blur-xl pointer-events-auto",children:r})})]})});Ft.displayName="Sidebar";const Lt=d.forwardRef(({className:t,onClick:s,...a},o)=>{const{toggleSidebar:r}=De();return e.jsxs(M,{ref:o,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:R("h-7 w-7",t),onClick:c=>{s?.(c),r()},...a,children:[e.jsx(Gs,{}),e.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]})});Lt.displayName="SidebarTrigger";const Qs=d.forwardRef(({className:t,...s},a)=>{const{toggleSidebar:o}=De();return e.jsx("button",{ref:a,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:o,title:"Toggle Sidebar",className:R("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",t),...s})});Qs.displayName="SidebarRail";const Js=d.forwardRef(({className:t,...s},a)=>e.jsx("main",{ref:a,className:R("relative flex min-h-svh flex-1 flex-col bg-background","peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",t),...s}));Js.displayName="SidebarInset";const Zs=d.forwardRef(({className:t,...s},a)=>e.jsx(oe,{ref:a,"data-sidebar":"input",className:R("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",t),...s}));Zs.displayName="SidebarInput";const Xs=d.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,"data-sidebar":"header",className:R("flex flex-col gap-2 p-2",t),...s}));Xs.displayName="SidebarHeader";const ea=d.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,"data-sidebar":"footer",className:R("flex flex-col gap-2 p-2",t),...s}));ea.displayName="SidebarFooter";const ta=d.forwardRef(({className:t,...s},a)=>e.jsx(is,{ref:a,"data-sidebar":"separator",className:R("mx-2 w-auto bg-sidebar-border",t),...s}));ta.displayName="SidebarSeparator";const zt=d.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,"data-sidebar":"content",className:R("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",t),...s}));zt.displayName="SidebarContent";const Xe=d.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,"data-sidebar":"group",className:R("relative flex w-full min-w-0 flex-col p-2",t),...s}));Xe.displayName="SidebarGroup";const et=d.forwardRef(({className:t,asChild:s=!1,...a},o)=>{const r=s?Ce:"div";return e.jsx(r,{ref:o,"data-sidebar":"group-label",className:R("duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",t),...a})});et.displayName="SidebarGroupLabel";const sa=d.forwardRef(({className:t,asChild:s=!1,...a},o)=>{const r=s?Ce:"button";return e.jsx(r,{ref:o,"data-sidebar":"group-action",className:R("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",t),...a})});sa.displayName="SidebarGroupAction";const tt=d.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,"data-sidebar":"group-content",className:R("w-full text-sm",t),...s}));tt.displayName="SidebarGroupContent";const st=d.forwardRef(({className:t,...s},a)=>e.jsx("ul",{ref:a,"data-sidebar":"menu",className:R("flex w-full min-w-0 flex-col gap-1",t),...s}));st.displayName="SidebarMenu";const at=d.forwardRef(({className:t,...s},a)=>e.jsx("li",{ref:a,"data-sidebar":"menu-item",className:R("group/menu-item relative",t),...s}));at.displayName="SidebarMenuItem";const aa=ts("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),nt=d.forwardRef(({asChild:t=!1,isActive:s=!1,variant:a="default",size:o="default",tooltip:r,className:c,...x},g)=>{const n=t?Ce:"button",{isMobile:l,state:h}=De(),u=e.jsx(n,{ref:g,"data-sidebar":"menu-button","data-size":o,"data-active":s,type:t?void 0:"button",className:R(aa({variant:a,size:o}),c),...x});return r?(typeof r=="string"&&(r={children:r}),e.jsxs(ss,{children:[e.jsx(as,{asChild:!0,children:u}),e.jsx(ns,{side:"right",align:"center",hidden:h!=="collapsed"||l,...r})]})):u});nt.displayName="SidebarMenuButton";const na=d.forwardRef(({className:t,asChild:s=!1,showOnHover:a=!1,...o},r)=>{const c=s?Ce:"button";return e.jsx(c,{ref:r,"data-sidebar":"menu-action",className:R("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",a&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",t),...o})});na.displayName="SidebarMenuAction";const ra=d.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,"data-sidebar":"menu-badge",className:R("absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",t),...s}));ra.displayName="SidebarMenuBadge";const ia=d.forwardRef(({className:t,showIcon:s=!1,...a},o)=>{const r=d.useMemo(()=>`${Math.floor(Math.random()*40)+50}%`,[]);return e.jsxs("div",{ref:o,"data-sidebar":"menu-skeleton",className:R("rounded-md h-8 flex gap-2 px-2 items-center",t),...a,children:[s&&e.jsx(J,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),e.jsx(J,{className:"h-4 flex-1 max-w-[--skeleton-width]","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":r}})]})});ia.displayName="SidebarMenuSkeleton";const oa=d.forwardRef(({className:t,...s},a)=>e.jsx("ul",{ref:a,"data-sidebar":"menu-sub",className:R("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",t),...s}));oa.displayName="SidebarMenuSub";const la=d.forwardRef(({...t},s)=>e.jsx("li",{ref:s,...t}));la.displayName="SidebarMenuSubItem";const ca=d.forwardRef(({asChild:t=!1,size:s="md",isActive:a,className:o,...r},c)=>{const x=t?Ce:"a";return e.jsx(x,{ref:c,"data-sidebar":"menu-sub-button","data-size":s,"data-active":a,className:R("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",s==="sm"&&"text-xs",s==="md"&&"text-sm","group-data-[collapsible=icon]:hidden",o),...r})});ca.displayName="SidebarMenuSubButton";function da({student:t,activeSection:s,onSectionChange:a}){const{state:o}=De(),{tStudent:r,tCommon:c}=Z(),x=[{section:"dashboard",title:c("navigation.dashboard"),icon:"dashboard",description:"Oversikt og sammendrag"},{section:"analytics",title:c("navigation.analytics"),icon:"analytics",description:"Datanalyse og innsikter"},{section:"goals",title:"Mål",icon:"flag",description:"Målstyring og progresjon"},{section:"progress",title:"Fremgang",icon:"trending_up",description:"Utviklingsanalyse"},{section:"reports",title:c("navigation.reports"),icon:"description",description:"Rapporter og eksport"}],g=[{section:"search",title:r("interface.advancedSearch"),icon:"search",description:"Avansert søk"},{section:"templates",title:r("interface.quickTemplates"),icon:"flash_on",description:"Hurtigmaler"},{section:"compare",title:"Sammenligning",icon:"compare_arrows",description:"Periodesammenligning"}],n=l=>s===l;return e.jsx(Ft,{className:`${o==="collapsed"?"w-14":"w-64"} bg-card/95 border-border backdrop-blur-sm z-50`,children:e.jsxs(zt,{className:"bg-transparent",children:[e.jsx("div",{className:`p-4 border-b border-border/20 bg-card/50 backdrop-blur-sm ${o==="collapsed"?"px-2":""}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-primary to-primary/70 flex items-center justify-center text-primary-foreground font-bold text-sm shadow-lg",children:t.name.split(" ").map(l=>l[0]).join("").toUpperCase()}),o!=="collapsed"&&e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"font-semibold text-sm truncate text-foreground",children:t.name}),t.grade&&e.jsx("p",{className:"text-xs text-muted-foreground",children:t.grade})]})]})}),e.jsxs(Xe,{children:[e.jsx(et,{className:"text-muted-foreground text-xs font-medium uppercase tracking-wider px-3 py-2",children:"Hovedseksjoner"}),e.jsx(tt,{children:e.jsx(st,{children:x.map(l=>e.jsx(at,{children:e.jsxs(nt,{onClick:()=>{try{L.debug("[UI] Sidebar nav click",{section:l.section})}catch{}a(l.section)},className:`cursor-pointer mx-2 rounded-lg transition-all duration-200 ${n(l.section)?"bg-primary text-primary-foreground shadow-lg":"text-foreground hover:bg-accent hover:text-accent-foreground"}`,children:[e.jsx("span",{className:"material-icons text-base",children:l.icon}),o!=="collapsed"&&e.jsx("span",{className:"text-sm ml-3",children:String(l.title)})]})},l.section))})})]}),e.jsxs(Xe,{children:[e.jsx(et,{className:"text-muted-foreground text-xs font-medium uppercase tracking-wider px-3 py-2",children:"Verktøy"}),e.jsx(tt,{children:e.jsx(st,{children:g.map(l=>e.jsx(at,{children:e.jsxs(nt,{onClick:()=>{try{L.debug("[UI] Sidebar tools click",{section:l.section})}catch{}a(l.section)},className:`cursor-pointer mx-2 rounded-lg transition-all duration-200 ${n(l.section)?"bg-primary text-primary-foreground shadow-lg":"text-foreground hover:bg-accent hover:text-accent-foreground"}`,children:[e.jsx("span",{className:"material-icons text-base",children:l.icon}),o!=="collapsed"&&e.jsx("span",{className:"text-sm ml-3",children:String(l.title)})]})},l.section))})})]})]})})}function ma(t,s,{checkForDefaultPrevented:a=!0}={}){return function(r){if(t?.(r),a===!1||!r.defaultPrevented)return s?.(r)}}function ua(t,s=[]){let a=[];function o(c,x){const g=d.createContext(x),n=a.length;a=[...a,x];const l=u=>{const{scope:i,children:f,...k}=u,N=i?.[t]?.[n]||g,p=d.useMemo(()=>k,Object.values(k));return e.jsx(N.Provider,{value:p,children:f})};l.displayName=c+"Provider";function h(u,i){const f=i?.[t]?.[n]||g,k=d.useContext(f);if(k)return k;if(x!==void 0)return x;throw new Error(`\`${u}\` must be used within \`${c}\``)}return[l,h]}const r=()=>{const c=a.map(x=>d.createContext(x));return function(g){const n=g?.[t]||c;return d.useMemo(()=>({[`__scope${t}`]:{...g,[t]:n}}),[g,n])}};return r.scopeName=t,[o,ga(r,...s)]}function ga(...t){const s=t[0];if(t.length===1)return s;const a=()=>{const o=t.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(c){const x=o.reduce((g,{useScope:n,scopeName:l})=>{const u=n(c)[`__scope${l}`];return{...g,...u}},{});return d.useMemo(()=>({[`__scope${s.scopeName}`]:x}),[x])}};return a.scopeName=s.scopeName,a}var ke=globalThis?.document?d.useLayoutEffect:()=>{},ha=bt[" useInsertionEffect ".trim().toString()]||ke;function xa({prop:t,defaultProp:s,onChange:a=()=>{},caller:o}){const[r,c,x]=pa({defaultProp:s,onChange:a}),g=t!==void 0,n=g?t:r;{const h=d.useRef(t!==void 0);d.useEffect(()=>{const u=h.current;u!==g&&console.warn(`${o} is changing from ${u?"controlled":"uncontrolled"} to ${g?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),h.current=g},[g,o])}const l=d.useCallback(h=>{if(g){const u=fa(h)?h(t):h;u!==t&&x.current?.(u)}else c(h)},[g,t,c,x]);return[n,l]}function pa({defaultProp:t,onChange:s}){const[a,o]=d.useState(t),r=d.useRef(a),c=d.useRef(s);return ha(()=>{c.current=s},[s]),d.useEffect(()=>{r.current!==a&&(c.current?.(a),r.current=a)},[a,r]),[a,o,c]}function fa(t){return typeof t=="function"}function pt(t,s){if(typeof t=="function")return t(s);t!=null&&(t.current=s)}function $t(...t){return s=>{let a=!1;const o=t.map(r=>{const c=pt(r,s);return!a&&typeof c=="function"&&(a=!0),c});if(a)return()=>{for(let r=0;r<o.length;r++){const c=o[r];typeof c=="function"?c():pt(t[r],null)}}}}function Gt(...t){return d.useCallback($t(...t),t)}function ja(t){const s=ya(t),a=d.forwardRef((o,r)=>{const{children:c,...x}=o,g=d.Children.toArray(c),n=g.find(va);if(n){const l=n.props.children,h=g.map(u=>u===n?d.Children.count(l)>1?d.Children.only(null):d.isValidElement(l)?l.props.children:null:u);return e.jsx(s,{...x,ref:r,children:d.isValidElement(l)?d.cloneElement(l,void 0,h):null})}return e.jsx(s,{...x,ref:r,children:c})});return a.displayName=`${t}.Slot`,a}function ya(t){const s=d.forwardRef((a,o)=>{const{children:r,...c}=a;if(d.isValidElement(r)){const x=wa(r),g=Na(c,r.props);return r.type!==d.Fragment&&(g.ref=o?$t(o,x):x),d.cloneElement(r,g)}return d.Children.count(r)>1?d.Children.only(null):null});return s.displayName=`${t}.SlotClone`,s}var ba=Symbol("radix.slottable");function va(t){return d.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===ba}function Na(t,s){const a={...s};for(const o in s){const r=t[o],c=s[o];/^on[A-Z]/.test(o)?r&&c?a[o]=(...g)=>{const n=c(...g);return r(...g),n}:r&&(a[o]=r):o==="style"?a[o]={...r,...c}:o==="className"&&(a[o]=[r,c].filter(Boolean).join(" "))}return{...t,...a}}function wa(t){let s=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,a=s&&"isReactWarning"in s&&s.isReactWarning;return a?t.ref:(s=Object.getOwnPropertyDescriptor(t,"ref")?.get,a=s&&"isReactWarning"in s&&s.isReactWarning,a?t.props.ref:t.props.ref||t.ref)}var Sa=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],ct=Sa.reduce((t,s)=>{const a=ja(`Primitive.${s}`),o=d.forwardRef((r,c)=>{const{asChild:x,...g}=r,n=x?a:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(n,{...g,ref:c})});return o.displayName=`Primitive.${s}`,{...t,[s]:o}},{});function ka(t,s){return d.useReducer((a,o)=>s[a][o]??a,t)}var Bt=t=>{const{present:s,children:a}=t,o=Ca(s),r=typeof a=="function"?a({present:o.isPresent}):d.Children.only(a),c=Gt(o.ref,Da(r));return typeof a=="function"||o.isPresent?d.cloneElement(r,{ref:c}):null};Bt.displayName="Presence";function Ca(t){const[s,a]=d.useState(),o=d.useRef(null),r=d.useRef(t),c=d.useRef("none"),x=t?"mounted":"unmounted",[g,n]=ka(x,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return d.useEffect(()=>{const l=Re(o.current);c.current=g==="mounted"?l:"none"},[g]),ke(()=>{const l=o.current,h=r.current;if(h!==t){const i=c.current,f=Re(l);t?n("MOUNT"):f==="none"||l?.display==="none"?n("UNMOUNT"):n(h&&i!==f?"ANIMATION_OUT":"UNMOUNT"),r.current=t}},[t,n]),ke(()=>{if(s){let l;const h=s.ownerDocument.defaultView??window,u=f=>{const N=Re(o.current).includes(f.animationName);if(f.target===s&&N&&(n("ANIMATION_END"),!r.current)){const p=s.style.animationFillMode;s.style.animationFillMode="forwards",l=h.setTimeout(()=>{s.style.animationFillMode==="forwards"&&(s.style.animationFillMode=p)})}},i=f=>{f.target===s&&(c.current=Re(o.current))};return s.addEventListener("animationstart",i),s.addEventListener("animationcancel",u),s.addEventListener("animationend",u),()=>{h.clearTimeout(l),s.removeEventListener("animationstart",i),s.removeEventListener("animationcancel",u),s.removeEventListener("animationend",u)}}else n("ANIMATION_END")},[s,n]),{isPresent:["mounted","unmountSuspended"].includes(g),ref:d.useCallback(l=>{o.current=l?getComputedStyle(l):null,a(l)},[])}}function Re(t){return t?.animationName||"none"}function Da(t){let s=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,a=s&&"isReactWarning"in s&&s.isReactWarning;return a?t.ref:(s=Object.getOwnPropertyDescriptor(t,"ref")?.get,a=s&&"isReactWarning"in s&&s.isReactWarning,a?t.props.ref:t.props.ref||t.ref)}var Ta=bt[" useId ".trim().toString()]||(()=>{}),Ma=0;function Pa(t){const[s,a]=d.useState(Ta());return ke(()=>{a(o=>o??String(Ma++))},[t]),t||(s?`radix-${s}`:"")}var Ge="Collapsible",[Ia,Gr]=ua(Ge),[Ra,dt]=Ia(Ge),Ut=d.forwardRef((t,s)=>{const{__scopeCollapsible:a,open:o,defaultOpen:r,disabled:c,onOpenChange:x,...g}=t,[n,l]=xa({prop:o,defaultProp:r??!1,onChange:x,caller:Ge});return e.jsx(Ra,{scope:a,disabled:c,contentId:Pa(),open:n,onOpenToggle:d.useCallback(()=>l(h=>!h),[l]),children:e.jsx(ct.div,{"data-state":ut(n),"data-disabled":c?"":void 0,...g,ref:s})})});Ut.displayName=Ge;var Vt="CollapsibleTrigger",qt=d.forwardRef((t,s)=>{const{__scopeCollapsible:a,...o}=t,r=dt(Vt,a);return e.jsx(ct.button,{type:"button","aria-controls":r.contentId,"aria-expanded":r.open||!1,"data-state":ut(r.open),"data-disabled":r.disabled?"":void 0,disabled:r.disabled,...o,ref:s,onClick:ma(t.onClick,r.onOpenToggle)})});qt.displayName=Vt;var mt="CollapsibleContent",Wt=d.forwardRef((t,s)=>{const{forceMount:a,...o}=t,r=dt(mt,t.__scopeCollapsible);return e.jsx(Bt,{present:a||r.open,children:({present:c})=>e.jsx(Aa,{...o,ref:s,present:c})})});Wt.displayName=mt;var Aa=d.forwardRef((t,s)=>{const{__scopeCollapsible:a,present:o,children:r,...c}=t,x=dt(mt,a),[g,n]=d.useState(o),l=d.useRef(null),h=Gt(s,l),u=d.useRef(0),i=u.current,f=d.useRef(0),k=f.current,N=x.open||g,p=d.useRef(N),m=d.useRef(void 0);return d.useEffect(()=>{const y=requestAnimationFrame(()=>p.current=!1);return()=>cancelAnimationFrame(y)},[]),ke(()=>{const y=l.current;if(y){m.current=m.current||{transitionDuration:y.style.transitionDuration,animationName:y.style.animationName},y.style.transitionDuration="0s",y.style.animationName="none";const j=y.getBoundingClientRect();u.current=j.height,f.current=j.width,p.current||(y.style.transitionDuration=m.current.transitionDuration,y.style.animationName=m.current.animationName),n(o)}},[x.open,o]),e.jsx(ct.div,{"data-state":ut(x.open),"data-disabled":x.disabled?"":void 0,id:x.contentId,hidden:!N,...c,ref:h,style:{"--radix-collapsible-content-height":i?`${i}px`:void 0,"--radix-collapsible-content-width":k?`${k}px`:void 0,...t.style},children:N&&r})});function ut(t){return t?"open":"closed"}var Ea=Ut;const rt=Ea,Ht=qt,Yt=Wt;function _a(t,s={}){const{initialPageSize:a=10,initialPage:o=1}=s,[r,c]=d.useState(o),[x,g]=d.useState(a),n=t.length,l=Math.ceil(n/x),h=d.useMemo(()=>{const v=(r-1)*x,b=v+x;return t.slice(v,b)},[t,r,x]),u=d.useCallback(v=>{const b=Math.max(1,Math.min(v,l));c(b)},[l]),i=d.useCallback(()=>{u(r+1)},[r,u]),f=d.useCallback(()=>{u(r-1)},[r,u]),k=d.useCallback(()=>{c(1)},[]),N=d.useCallback(()=>{c(l)},[l]),p=d.useCallback(v=>{const b=Math.ceil(n/v),S=Math.min(r,b);g(v),c(S||1)},[r,n]),m=r<l,y=r>1,j=n>0?(r-1)*x+1:0,w=Math.min(r*x,n);return{paginatedData:h,currentPage:r,pageSize:x,totalItems:n,totalPages:l,goToPage:u,goToNextPage:i,goToPreviousPage:f,goToFirstPage:k,goToLastPage:N,changePageSize:p,hasNextPage:m,hasPreviousPage:y,startIndex:j,endIndex:w,isFirstPage:r===1,isLastPage:r===l,isEmpty:n===0}}const Oa=d.memo(({pageNum:t,isCurrent:s,onClick:a})=>{const o=()=>{a(t)};return e.jsx(M,{variant:s?"default":"outline",size:"sm",onClick:o,className:"px-3",children:t})}),Kt=d.memo(({sessions:t,title:s="Sessions in Selected Period"})=>{const{paginatedData:a,currentPage:o,pageSize:r,totalItems:c,totalPages:x,goToPage:g,goToNextPage:n,goToPreviousPage:l,goToFirstPage:h,goToLastPage:u,changePageSize:i,hasNextPage:f,hasPreviousPage:k,startIndex:N,endIndex:p,isEmpty:m,isLoading:y}=_a(t,{initialPageSize:10}),j=d.useCallback(w=>{i(parseInt(w))},[i]);return m&&!y?e.jsx(D,{className:"bg-gradient-card border-0 shadow-soft",children:e.jsx(T,{className:"py-16 text-center text-muted-foreground",children:e.jsx("p",{children:"No sessions available in the selected period."})})}):e.jsxs(D,{className:"bg-gradient-card border-0 shadow-soft",children:[e.jsx(E,{children:e.jsxs(O,{className:"flex items-center justify-between",children:[e.jsx("span",{children:s}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Showing ",N,"-",p," of ",c]}),e.jsxs(ue,{value:r.toString(),onValueChange:j,children:[e.jsx(ge,{className:"w-20 h-8",children:e.jsx(he,{})}),e.jsxs(xe,{children:[e.jsx(B,{value:"5",children:"5"}),e.jsx(B,{value:"10",children:"10"}),e.jsx(B,{value:"20",children:"20"}),e.jsx(B,{value:"50",children:"50"})]})]})]})]})}),e.jsx(T,{className:"space-y-4",children:y?e.jsx("div",{className:"text-center p-8 text-muted-foreground",children:"Loading sessions..."}):e.jsxs("div",{children:[e.jsx("div",{className:"space-y-4",children:a.map(w=>e.jsxs("div",{className:"border-l-4 border-primary pl-4 py-2 hover:bg-muted/50 transition-colors rounded-r",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"font-medium text-foreground",children:[w.timestamp.toLocaleDateString()," at ",w.timestamp.toLocaleTimeString()]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(I,{variant:"outline",className:"text-xs",children:[w.emotions.length," emotions"]}),e.jsxs(I,{variant:"outline",className:"text-xs",children:[w.sensoryInputs.length," sensory"]}),w.environmentalData&&e.jsx(I,{variant:"outline",className:"text-xs",children:"Environmental data"})]})]}),w.generalNotes&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-2",children:w.generalNotes}),w.emotions.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[w.emotions.slice(0,3).map((v,b)=>e.jsxs(I,{variant:"secondary",className:"text-xs",children:[v.emotion," (",v.intensity,")"]},b)),w.emotions.length>3&&e.jsxs(I,{variant:"outline",className:"text-xs",children:["+",w.emotions.length-3," more"]})]})]},w.id))}),x>1&&e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Page ",o," of ",x]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(M,{variant:"ghost",size:"icon","aria-label":"First page",onClick:h,disabled:!k,children:e.jsx(Fs,{className:"h-4 w-4"})}),e.jsx(M,{variant:"ghost",size:"icon","aria-label":"Previous page",onClick:l,disabled:!k,children:e.jsx(cs,{className:"h-4 w-4"})}),Array.from({length:Math.min(5,x)},(w,v)=>{let b;return x<=5||o<=3?b=v+1:o>=x-2?b=x-4+v:b=o-2+v,e.jsx(Oa,{pageNum:b,isCurrent:o===b,onClick:g},b)}),e.jsx(M,{variant:"ghost",size:"icon","aria-label":"Next page",onClick:n,disabled:!f,children:e.jsx(ms,{className:"h-4 w-4"})}),e.jsx(M,{variant:"ghost",size:"icon","aria-label":"Last page",onClick:u,disabled:!f,children:e.jsx(Ls,{className:"h-4 w-4"})})]})]})]})})]})});Kt.displayName="PaginatedSessionsList";const Fa=({emotions:t,sensoryInputs:s,entries:a,className:o})=>{const{tAnalytics:r,formatDate:c}=Z(),x=d.useMemo(()=>[{level:"low",percentage:25,minDataPoints:5,minDays:7,minRSquared:.3,color:"bg-destructive",description:String(r("confidence.low"))},{level:"medium",percentage:50,minDataPoints:15,minDays:21,minRSquared:.5,color:"bg-warning",description:String(r("confidence.medium"))},{level:"high",percentage:75,minDataPoints:30,minDays:42,minRSquared:.7,color:"bg-success",description:String(r("confidence.high"))}],[r]),g=d.useMemo(()=>{const i=t.length+s.length,f=[...t.map(N=>N.timestamp),...s.map(N=>N.timestamp),...a.map(N=>N.timestamp)].sort((N,p)=>N.getTime()-p.getTime()),k=f.length>0?ne(new Date,f[0])+1:0;return{dataPoints:i,daysSpan:k,entriesCount:a.length,startDate:f[0]||new Date,hasData:i>0}},[t,s,a]),n=d.useMemo(()=>x.map(i=>{const f=Math.min(100,g.dataPoints/i.minDataPoints*100),k=Math.min(100,g.daysSpan/i.minDays*100),N=Math.min(f,k),p=Math.max(0,i.minDataPoints-g.dataPoints),m=Math.max(0,i.minDays-g.daysSpan),y=Math.max(p,m),j=ce(new Date,y);return{requirement:i,progress:N,dataPoints:{current:g.dataPoints,needed:p,progress:f},days:{current:g.daysSpan,needed:m,progress:k},daysToTarget:y,targetDate:j,isAchieved:N>=100}}),[x,g]),l=n.find(i=>!i.isAchieved),h=n.filter(i=>i.isAchieved).length,u=()=>{if(!l)return null;const i=Math.ceil(l.dataPoints.needed/Math.max(l.daysToTarget,1));return Math.max(1,i)};return g.hasData?e.jsxs(D,{className:o,children:[e.jsxs(E,{children:[e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-5 w-5"}),"Datakrav for sikkerhetsnivå"]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{children:[g.dataPoints," datapunkter samlet"]}),e.jsxs("span",{children:[g.daysSpan," dager med data"]})]})]}),e.jsxs(T,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Nåværende sikkerhetsnivå"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[h===0&&"Under lavt nivå",h===1&&"Lavt nivå oppnådd",h===2&&"Middels nivå oppnådd",h>=3&&"Høyt nivå oppnådd"]})]}),e.jsxs(I,{variant:h>=3?"default":h>=1?"secondary":"outline",children:[h>=3?"Høy":h>=1?"Middels":"Lav"," sikkerhet"]})]}),l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"font-medium",children:["Fremgang mot ",l.requirement.description]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[Math.round(l.progress),"% fullført"]})]}),e.jsx(Q,{value:l.progress,className:"h-2"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Datapunkter"}),e.jsxs("span",{children:[l.dataPoints.current," / ",l.requirement.minDataPoints]})]}),e.jsx(Q,{value:l.dataPoints.progress,className:"h-1"}),l.dataPoints.needed>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[l.dataPoints.needed," flere datapunkter trengs"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Tidsperiode"}),e.jsxs("span",{children:[l.days.current," / ",l.requirement.minDays," dager"]})]}),e.jsx(Q,{value:l.days.progress,className:"h-1"}),l.days.needed>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[l.days.needed," flere dager trengs"]})]})]}),e.jsxs("div",{className:"p-4 bg-info/10 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(K,{className:"h-4 w-4 text-info"}),e.jsx("span",{className:"font-medium text-info-foreground",children:"Tidsestimat"})]}),e.jsxs("p",{className:"text-sm text-info-foreground/80",children:["Med ",u()," datapunkt(er) per dag vil du nå"," ",e.jsx("span",{className:"font-medium",children:l.requirement.description})," innen"," ",e.jsx("span",{className:"font-medium",children:c(l.targetDate)}),l.daysToTarget>0&&` (om ${l.daysToTarget} dager)`]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"Alle sikkerhetsnivåer"}),n.map(i=>e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${i.isAchieved?"bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-800":"bg-muted/30"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[i.isAchieved?e.jsx(Y,{className:"h-5 w-5 text-success"}):e.jsx("div",{className:`w-5 h-5 rounded-full ${i.requirement.color} opacity-60`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:i.requirement.description}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[i.requirement.minDataPoints," datapunkter over ",i.requirement.minDays," dager"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(I,{variant:i.isAchieved?"default":"outline",children:i.isAchieved?"Oppnådd":`${Math.round(i.progress)}%`}),!i.isAchieved&&i.daysToTarget>0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["~",i.daysToTarget," dager igjen"]})]})]},i.requirement.level))]}),l&&e.jsxs("div",{className:"p-4 bg-primary/10 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(te,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"font-medium text-primary-foreground",children:"Anbefalinger"})]}),e.jsxs("ul",{className:"text-sm text-primary-foreground/80 space-y-1",children:[e.jsxs("li",{children:["• Samle ",u()," datapunkt(er) per dag for optimal fremgang"]}),e.jsx("li",{children:"• Registrer data konsekvent for bedre mønstergjenkjenning"}),e.jsx("li",{children:"• Inkluder både følelser og sensoriske opplevelser i hver økt"}),e.jsx("li",{children:"• Noter miljøfaktorer for å identifisere sammenhenger"})]})]})]})]}):e.jsxs(D,{className:o,children:[e.jsx(E,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-5 w-5"}),"Datakrav for sikkerhetsnivå"]})}),e.jsxs(T,{className:"text-center py-8",children:[e.jsx(kt,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Ingen data registrert ennå. Start med å samle data for å se fremgang mot sikkerhetsnivåer."}),e.jsx(M,{variant:"outline",children:"Start datainnsamling"})]})]})},Qt=d.memo(({emotions:t,sensoryInputs:s,entries:a,className:o})=>{const r=d.useMemo(()=>{const n=t.length+s.length,l=a.length;if(n===0)return[];const h=[...t.map(A=>A.timestamp),...s.map(A=>A.timestamp),...a.map(A=>A.timestamp)].sort((A,X)=>A.getTime()-X.getTime());if(h.length===0)return[];const u=h[0],i=new Date,f=Math.min(100,n/30*100),k=f>=80?"excellent":f>=60?"good":f>=40?"fair":"poor",N=us({start:u,end:i}),m=N.filter(A=>h.some(X=>V(X,"yyyy-MM-dd")===V(A,"yyyy-MM-dd"))).length/N.length*100,y=m>=80?"excellent":m>=60?"good":m>=40?"fair":"poor",j=n===0?0:t.length/n,w=n===0?0:s.length/n,b=(1-Math.abs(j-w))*100,S=b>=80?"excellent":b>=60?"good":b>=40?"fair":"poor",C=[...t,...s].filter(A=>de(A.timestamp,{start:ve(new Date,7),end:new Date})),P=Math.min(100,C.length/7*100),$=P>=80?"excellent":P>=60?"good":P>=40?"fair":"poor",F=a.filter(A=>Array.isArray(A.emotions)&&Array.isArray(A.sensoryInputs)&&A.emotions.length>0&&A.sensoryInputs.length>0),_=l>0?F.length/l*100:0,U=_>=80?"excellent":_>=60?"good":_>=40?"fair":"poor";return[{id:"volume",title:"Datamengde",description:"Total mengde data samlet over tid",score:Math.round(f),maxScore:100,status:k,recommendations:[f<40?"Samle mer data - mål på minst 30 datapunkter":"",f<80?"Øk frekvensen på datainnsamling":"",f>=80?"Utmerket datamengde!":""].filter(Boolean),icon:re},{id:"consistency",title:"Konsistens",description:"Hvor jevnlig data samles inn",score:Math.round(m),maxScore:100,status:y,recommendations:[m<60?"Samle data mer regelmessig - ideelt daglig":"",m<80?"Prøv å etablere en fast rutine for datainnsamling":"",m>=80?"Excellent consistency!":""].filter(Boolean),icon:K},{id:"diversity",title:"Databalanse",description:"Balanse mellom følelser og sensoriske data",score:Math.round(b),maxScore:100,status:S,recommendations:[j<.3?"Registrer flere følelser":"",w<.3?"Registrer flere sensoriske opplevelser":"",b>=80?"God balanse mellom datatyper!":""].filter(Boolean),icon:Se},{id:"recent",title:"Nylig aktivitet",description:"Datainnsamling siste 7 dager",score:Math.round(P),maxScore:100,status:$,recommendations:[P<40?"Øk datainnsamlingen de siste dagene":"",P<80?"Prøv å samle data hver dag denne uken":"",P>=80?"Utmerket nylig aktivitet!":""].filter(Boolean),icon:pe},{id:"completeness",title:"Øktfullstendighet",description:"Økter med både følelser og sensoriske data",score:Math.round(_),maxScore:100,status:U,recommendations:[_<60?"Inkluder både følelser og sensoriske data i hver økt":"",_<80?"Prøv å være mer komplett i dataregistreringen":"",_>=80?"Utmerket øktfullstendighet!":""].filter(Boolean),icon:Y}]},[t,s,a]),c=d.useMemo(()=>r.length===0?0:Math.round(r.reduce((n,l)=>n+l.score,0)/r.length),[r]),x=n=>{switch(n){case"excellent":return"text-success-foreground bg-success";case"good":return"text-info-foreground bg-info";case"fair":return"text-warning-foreground bg-warning";case"poor":return"text-destructive-foreground bg-destructive";default:return"text-gray-600 bg-gray-50 dark:bg-gray-950/20"}},g=n=>{switch(n){case"excellent":return e.jsx(Y,{className:"h-4 w-4"});case"good":return e.jsx(te,{className:"h-4 w-4"});case"fair":return e.jsx(Fe,{className:"h-4 w-4"});case"poor":return e.jsx(Fe,{className:"h-4 w-4"});default:return e.jsx(re,{className:"h-4 w-4"})}};return r.length===0?e.jsxs(D,{className:o,children:[e.jsx(E,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5"}),"Datakvalitet"]})}),e.jsxs(T,{className:"text-center py-8",children:[e.jsx(Fe,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"Ingen data tilgjengelig for kvalitetsvurdering"})]})]}):e.jsxs(D,{className:o,children:[e.jsxs(E,{children:[e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5"}),"Datakvalitet"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Samlet score:"}),e.jsxs(I,{variant:c>=80?"default":c>=60?"secondary":"outline",children:[c,"/100"]})]}),e.jsx(Q,{value:c,className:"flex-1 h-2"})]})]}),e.jsxs(T,{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:r.map(n=>e.jsxs("div",{className:`p-4 rounded-lg ${x(n.status)}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n.icon,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:n.title})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[g(n.status),e.jsxs("span",{className:"font-mono text-sm",children:[n.score,"/",n.maxScore]})]})]}),e.jsx("p",{className:"text-sm opacity-80 mb-3",children:n.description}),e.jsx(Q,{value:n.score,className:"mb-3 h-1"}),n.recommendations.length>0&&e.jsx("div",{className:"space-y-1",children:n.recommendations.map(l=>e.jsxs("p",{className:"text-xs opacity-90",children:["• ",l]},`${n.id}-${l}`))})]},n.id))}),e.jsxs("div",{className:"p-4 bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-950/20 dark:to-blue-950/20 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Samlet vurdering"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-3",children:[c>=90&&"Utmerket datakvalitet! Dine data gir høy sikkerhet for analyser.",c>=70&&c<90&&"God datakvalitet. Små forbedringer kan øke sikkerhetsnivået.",c>=50&&c<70&&"Moderat datakvalitet. Fokuser på de områdene som trenger forbedring.",c<50&&"Datakvaliteten kan forbedres betydelig. Følg anbefalingene for bedre analyser."]}),r.filter(n=>n.status==="poor"||n.status==="fair").length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"text-sm font-medium",children:"Prioriterte forbedringer:"}),r.filter(n=>n.status==="poor"||n.status==="fair").slice(0,3).map((n,l)=>e.jsxs("div",{className:"text-sm flex items-start gap-2",children:[e.jsx("span",{className:"font-medium text-xs bg-white dark:bg-gray-800 px-2 py-1 rounded",children:l+1}),e.jsx("span",{children:n.recommendations[0]})]},n.id))]})]})]})]})});Qt.displayName="DataQualityFeedback";const La=({emotions:t,sensoryInputs:s,entries:a,className:o})=>{const{formatDate:r}=Z(),c=d.useMemo(()=>{const l=t.length+s.length,h=[...t.map(i=>i.timestamp),...s.map(i=>i.timestamp),...a.map(i=>i.timestamp)].sort((i,f)=>i.getTime()-f.getTime()),u=h.length>0?ne(new Date,h[0])+1:0;return{dataPoints:l,daysSpan:u,startDate:h[0]||new Date,hasData:l>0}},[t,s,a]),x=d.useMemo(()=>{const l=c.startDate||new Date;return[{id:"initial",title:"Første datainnsamling",description:"Start med å registrere grunnleggende data",targetDataPoints:3,targetDays:3,confidenceLevel:"Grunnlag",achieved:c.dataPoints>=3&&c.daysSpan>=3,progress:Math.min(100,(c.dataPoints/3+c.daysSpan/3)*50),estimatedDate:c.dataPoints>=3?null:ce(l,3),icon:Se,color:"bg-blue-500"},{id:"basic",title:"Grunnleggende mønster",description:"Nok data til å se grunnleggende trender",targetDataPoints:10,targetDays:14,confidenceLevel:"Lav sikkerhet (25%)",achieved:c.dataPoints>=10&&c.daysSpan>=14,progress:Math.min(100,(c.dataPoints/10+c.daysSpan/14)*50),estimatedDate:c.dataPoints>=10&&c.daysSpan>=14?null:ce(l,14),icon:pe,color:"bg-orange-500"},{id:"reliable",title:"Pålitelige innsikter",description:"Tilstrekkelig data for moderate innsikter",targetDataPoints:20,targetDays:28,confidenceLevel:"Middels sikkerhet (50%)",achieved:c.dataPoints>=20&&c.daysSpan>=28,progress:Math.min(100,(c.dataPoints/20+c.daysSpan/28)*50),estimatedDate:c.dataPoints>=20&&c.daysSpan>=28?null:ce(l,28),icon:qe,color:"bg-yellow-500"},{id:"strong",title:"Sterke mønstre",description:"Høy sikkerhet for pedagogiske beslutninger",targetDataPoints:35,targetDays:42,confidenceLevel:"Høy sikkerhet (75%)",achieved:c.dataPoints>=35&&c.daysSpan>=42,progress:Math.min(100,(c.dataPoints/35+c.daysSpan/42)*50),estimatedDate:c.dataPoints>=35&&c.daysSpan>=42?null:ce(l,42),icon:qe,color:"bg-green-500"},{id:"excellent",title:"Utmerket datagrunnlag",description:"Optimalt datagrunnlag for avanserte analyser",targetDataPoints:50,targetDays:60,confidenceLevel:"Meget høy sikkerhet (90%)",achieved:c.dataPoints>=50&&c.daysSpan>=60,progress:Math.min(100,(c.dataPoints/50+c.daysSpan/60)*50),estimatedDate:c.dataPoints>=50&&c.daysSpan>=60?null:ce(l,60),icon:qe,color:"bg-emerald-500"}]},[c]),g=x.findIndex(l=>!l.achieved),n=x[g];return c.hasData?e.jsxs(D,{className:o,children:[e.jsxs(E,{children:[e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5"}),"Datainnsamlingskart"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Fremgang mot høyere sikkerhetsnivå gjennom systematisk datainnsamling"})]}),e.jsxs(T,{children:[e.jsxs("div",{className:"mb-6 p-4 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-950/20 dark:to-purple-950/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium",children:"Din fremgang"}),e.jsxs(I,{variant:"outline",children:[x.filter(l=>l.achieved).length," av ",x.length," milepæler"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Datapunkter: "}),e.jsx("span",{className:"font-medium",children:c.dataPoints})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Dager: "}),e.jsx("span",{className:"font-medium",children:c.daysSpan})]})]})]}),n&&e.jsxs("div",{className:"mb-6 p-4 border-2 border-dashed border-primary/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:`p-2 rounded-full ${n.color} text-white`,children:e.jsx(n.icon,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium",children:["Neste mål: ",n.title]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n.description})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Fremgang"}),e.jsxs("span",{children:[Math.round(n.progress),"%"]})]}),e.jsx(Q,{value:n.progress,className:"h-2"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-xs text-muted-foreground",children:[e.jsxs("div",{children:["Datapunkter: ",c.dataPoints,"/",n.targetDataPoints]}),e.jsxs("div",{children:["Dager: ",c.daysSpan,"/",n.targetDays]})]})]}),n.estimatedDate&&e.jsxs("div",{className:"mt-3 text-sm text-blue-600 dark:text-blue-400",children:[e.jsx(K,{className:"h-4 w-4 inline mr-1"}),"Estimert ferdigdato: ",r(n.estimatedDate)]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Komplett veikart"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-6 top-0 bottom-0 w-0.5 bg-border"}),x.map(l=>e.jsxs("div",{className:"relative flex items-start gap-4 pb-6",children:[e.jsx("div",{className:`relative z-10 flex items-center justify-center w-12 h-12 rounded-full border-2 ${l.achieved?`${l.color} border-transparent text-white`:"bg-background border-border text-muted-foreground"}`,children:e.jsx(l.icon,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h5",{className:`font-medium ${l.achieved?"text-foreground":"text-muted-foreground"}`,children:l.title}),e.jsx(I,{variant:l.achieved?"default":"outline",className:"ml-2",children:l.achieved?"Oppnådd":l.confidenceLevel})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:l.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[l.targetDataPoints," datapunkter"]}),e.jsxs("span",{children:[l.targetDays," dager"]}),l.estimatedDate&&!l.achieved&&e.jsxs("span",{children:["Estimert: ",r(l.estimatedDate)]})]}),!l.achieved&&l.progress>0&&e.jsx("div",{className:"mt-2",children:e.jsx(Q,{value:l.progress,className:"h-1"})})]})]},l.id))]})]})]})]}):e.jsxs(D,{className:o,children:[e.jsx(E,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5"}),"Datainnsamlingskart"]})}),e.jsxs(T,{className:"text-center py-8",children:[e.jsx(Se,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Start datainnsamlingen for å se ditt fremgangskart mot høyere sikkerhetsnivåer."})]})]})},za=({studentId:t,showDetails:s=!1,className:a=""})=>{const[o,r]=d.useState([]),[c,x]=d.useState(!1),g=d.useCallback(()=>{const i=Ne.getAnalyticsStatus();r(t?i.filter(f=>f.studentId===t):i)},[t]);d.useEffect(()=>{g();let i=0,f=!0,k=Date.now();const N=()=>{if(!f)return;const p=Date.now();p-k>=3e4&&(k=p,g()),i=requestAnimationFrame(N)};return i=requestAnimationFrame(N),()=>{f=!1,i&&cancelAnimationFrame(i)}},[g]);const n=async()=>{x(!0);try{if(t){const i=q.getStudentById(t);i?await Ne.triggerAnalyticsForStudent(i):L.warn("Student not found for refresh",{studentId:t})}else await Ne.triggerAnalyticsForAllStudents();g()}catch(i){L.error("Error refreshing analytics",i)}finally{x(!1)}},l=i=>i.isInitialized?i.healthScore>=80?e.jsx(Y,{className:"h-4 w-4 text-green-600"}):i.healthScore>=60?e.jsx(te,{className:"h-4 w-4 text-yellow-600"}):i.healthScore>=40?e.jsx(Ye,{className:"h-4 w-4 text-orange-600"}):e.jsx(Fe,{className:"h-4 w-4 text-red-600"}):e.jsx(pe,{className:"h-4 w-4 text-muted-foreground"}),h=i=>i.isInitialized?i.healthScore>=80?"default":i.healthScore>=60?"secondary":"destructive":"secondary",u=i=>i.isInitialized?i.healthScore>=80?"Excellent":i.healthScore>=60?"Good":i.healthScore>=40?"Fair":"Limited":"Initializing";if(!s&&t&&o.length===1){const i=o[0];return e.jsxs("div",{className:`flex items-center gap-2 ${a}`,children:[l(i),e.jsxs(I,{variant:h(i),className:"text-xs",children:["Analytics: ",u(i)]}),i.lastAnalyzed&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Updated ",xt(i.lastAnalyzed,{addSuffix:!0})]})]})}return e.jsxs(D,{className:`bg-gradient-card border-0 shadow-soft ${a}`,children:[e.jsx(E,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(Ct,{className:"h-5 w-5"}),"Analytics Status",t&&` - ${o[0]?.studentName||"Student"}`]}),e.jsxs(M,{variant:"outline",size:"sm",onClick:n,disabled:c,children:[e.jsx(rs,{className:`h-4 w-4 mr-2 ${c?"animate-spin":""}`}),"Refresh"]})]})}),e.jsx(T,{children:o.length===0?e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(Ye,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No analytics data available"})]}):e.jsxs("div",{className:"space-y-4",children:[o.map(i=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[l(i),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:t?"Analytics Systems":i.studentName}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs(I,{variant:h(i),className:"text-xs",children:[u(i)," (",i.healthScore,"%)"]}),i.hasMinimumData?e.jsxs(I,{variant:"outline",className:"text-xs",children:[e.jsx(re,{className:"h-3 w-3 mr-1"}),"Data Available"]}):e.jsxs(I,{variant:"secondary",className:"text-xs",children:[e.jsx(pe,{className:"h-3 w-3 mr-1"}),"Collecting Data"]})]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:i.lastAnalyzed?e.jsxs(e.Fragment,{children:["Last updated:",e.jsx("br",{}),xt(i.lastAnalyzed,{addSuffix:!0})]}):"Never analyzed"})})]},i.studentId)),s&&e.jsxs("div",{className:"pt-4 border-t border-border",children:[e.jsx("h4",{className:"font-medium text-foreground mb-3",children:"Active Analytics Systems:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Y,{className:"h-4 w-4 text-green-600"}),"Pattern Analysis"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Y,{className:"h-4 w-4 text-green-600"}),"Correlation Analysis"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Y,{className:"h-4 w-4 text-green-600"}),"Predictive Insights"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Y,{className:"h-4 w-4 text-green-600"}),"Anomaly Detection"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Y,{className:"h-4 w-4 text-green-600"}),"Alert System"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Y,{className:"h-4 w-4 text-green-600"}),"Auto-Updates"]})]})]})]})})]})},$a=({onRangeChange:t,selectedRange:s,className:a})=>{const[o,r]=d.useState({from:s.start,to:s.end}),[c,x]=d.useState(!1),g=[{label:"Last 7 days",value:"7d",getRange:()=>({start:ae(ve(new Date,6)),end:se(new Date),label:"Last 7 days"})},{label:"Last 30 days",value:"30d",getRange:()=>({start:ae(ve(new Date,29)),end:se(new Date),label:"Last 30 days"})},{label:"Last 3 months",value:"3m",getRange:()=>({start:ae(Le(new Date,3)),end:se(new Date),label:"Last 3 months"})},{label:"Last 6 months",value:"6m",getRange:()=>({start:ae(Le(new Date,6)),end:se(new Date),label:"Last 6 months"})},{label:"This week",value:"week",getRange:()=>{const h=new Date,u=h.getDay(),i=ve(h,u);return{start:ae(i),end:se(h),label:"This week"}}},{label:"This month",value:"month",getRange:()=>{const h=new Date,u=new Date(h.getFullYear(),h.getMonth(),1);return{start:ae(u),end:se(h),label:"This month"}}}],n=h=>{const u=g.find(i=>i.value===h);if(u){const i=u.getRange();t(i),r({from:i.start,to:i.end})}},l=h=>{r(h),h?.from&&h?.to&&(t({start:ae(h.from),end:se(h.to),label:`${V(h.from,"MMM d")} - ${V(h.to,"MMM d, yyyy")}`}),x(!1))};return e.jsxs("div",{className:R("flex items-center gap-2 font-dyslexia",a),children:[e.jsxs(ue,{onValueChange:n,children:[e.jsx(ge,{className:"w-[160px] bg-input border-border",children:e.jsx(he,{placeholder:"Quick select"})}),e.jsx(xe,{children:g.map(h=>e.jsx(B,{value:h.value,children:h.label},h.value))})]}),e.jsxs(vt,{open:c,onOpenChange:x,children:[e.jsx(Nt,{asChild:!0,children:e.jsxs(M,{variant:"ghost",className:R("w-[280px] justify-start text-left font-normal bg-input",!o&&"text-muted-foreground"),children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),o?.from?o.to?e.jsxs(e.Fragment,{children:[V(o.from,"LLL dd, y")," -"," ",V(o.to,"LLL dd, y")]}):V(o.from,"LLL dd, y"):e.jsx("span",{children:"Pick a date range"}),e.jsx(lt,{className:"ml-auto h-4 w-4"})]})}),e.jsx(wt,{className:"w-auto p-0",align:"start",children:e.jsx(St,{initialFocus:!0,mode:"range",defaultMonth:o?.from,selected:o,onSelect:l,numberOfMonths:2,className:R("p-3 pointer-events-auto")})})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsx("span",{className:"hidden md:inline",children:"Selected: "}),e.jsx("span",{className:"font-medium text-foreground",children:s.label})]})]})};function Ga({student:t,trackingEntries:s,filteredData:a,selectedRange:o,onRangeChange:r,insights:c,isLoadingInsights:x}){const{tStudent:g,tCommon:n}=Z(),l=ot(),[h,u]=d.useState(!1),i={totalSessions:a.entries.length,totalEmotions:a.emotions.length,totalSensoryInputs:a.sensoryInputs.length},f=Math.min(100,Math.round((i.totalSessions*.4+i.totalEmotions*.3+i.totalSensoryInputs*.3)/10*100)),N=(p=>p>=80?{label:"Utmerket",color:"bg-green-500",variant:"default"}:p>=60?{label:"God",color:"bg-blue-500",variant:"secondary"}:p>=40?{label:"Moderat",color:"bg-yellow-500",variant:"outline"}:{label:"Trenger mer data",color:"bg-red-500",variant:"destructive"})(f);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Oversikt"}),e.jsxs("p",{className:"text-muted-foreground",children:["Sammendrag av ",t.name,"s data og aktivitet"]})]}),e.jsxs(M,{onClick:()=>l(`/track/${t.id}`),className:"bg-gradient-primary hover:opacity-90",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),String(g("interface.newSession"))]})]}),e.jsxs(D,{className:"bg-gradient-card border-0 shadow-soft",children:[e.jsx(E,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5"}),"Analysestatus"]})}),e.jsx(T,{children:e.jsx(za,{studentId:t.id,showDetails:!1})})]}),e.jsxs(D,{className:"bg-gradient-card border-0 shadow-soft",children:[e.jsx(E,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5"}),String(g("interface.dataAnalysisPeriod"))]})}),e.jsx(T,{children:e.jsx($a,{selectedRange:o,onRangeChange:r})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(D,{className:"bg-gradient-card border-0 shadow-soft",children:e.jsx(T,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:String(g("interface.sessionsInPeriod"))}),e.jsx("p",{className:"text-2xl font-bold",children:i.totalSessions})]}),e.jsx(I,{variant:"secondary",children:String(g("interface.totalSessions"))})]})})}),e.jsx(D,{className:"bg-gradient-card border-0 shadow-soft",children:e.jsx(T,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:String(g("interface.emotionsTracked"))}),e.jsx("p",{className:"text-2xl font-bold",children:i.totalEmotions})]}),e.jsx(I,{variant:"secondary",children:String(g("interface.totalEmotions"))})]})})}),e.jsx(D,{className:"bg-gradient-card border-0 shadow-soft",children:e.jsx(T,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:String(g("interface.sensoryInputs"))}),e.jsx("p",{className:"text-2xl font-bold",children:i.totalSensoryInputs})]}),e.jsx(I,{variant:"secondary",children:String(g("interface.totalSensoryInputs"))})]})})})]}),e.jsxs(D,{className:"bg-gradient-card border-0 shadow-soft",children:[e.jsx(E,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(js,{className:"h-5 w-5"}),"Datakvalitet"]})}),e.jsxs(T,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Samlet kvalitetsscore"}),e.jsxs("p",{className:"text-3xl font-bold",children:[f,"%"]})]}),e.jsx(I,{variant:N.variant,className:"ml-2",children:N.label})]}),e.jsx("div",{className:"bg-muted rounded-full h-2 mb-4 overflow-hidden",children:e.jsx("div",{className:R("bg-primary h-2 rounded-full transition-all duration-500","w-full origin-left"),style:{transform:`scaleX(${f/100})`}})}),e.jsxs(rt,{open:h,onOpenChange:u,children:[e.jsx(Ht,{asChild:!0,children:e.jsxs(M,{variant:"ghost",className:"w-full justify-between p-0 h-auto",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:h?"Skjul detaljer":"Vis detaljert analyse"}),e.jsx(lt,{className:R("h-4 w-4 transition-transform",h&&"rotate-180")})]})}),e.jsxs(Yt,{className:"space-y-6 mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Fa,{entries:a.entries,emotions:a.emotions,sensoryInputs:a.sensoryInputs}),e.jsx(Qt,{entries:a.entries,emotions:a.emotions,sensoryInputs:a.sensoryInputs})]}),e.jsx(La,{entries:a.entries,emotions:a.emotions,sensoryInputs:a.sensoryInputs})]})]})]})]}),x?e.jsxs(D,{className:"bg-gradient-card border-0 shadow-soft",children:[e.jsx(E,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5 animate-pulse"}),"AI-genererte innsikter"]})}),e.jsx(T,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-3 bg-accent/20 rounded-lg animate-pulse h-12 w-full"}),e.jsx("div",{className:"p-3 bg-accent/20 rounded-lg animate-pulse h-12 w-full"})]})})]}):c&&c.suggestions&&c.suggestions.length>0&&e.jsxs(D,{className:"bg-gradient-card border-0 shadow-soft",children:[e.jsx(E,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),"AI-genererte innsikter"]})}),e.jsx(T,{children:e.jsx("div",{className:"space-y-3",children:c.suggestions.slice(0,3).map((p,m)=>e.jsx("div",{className:"p-3 bg-accent/20 rounded-lg",children:e.jsx("p",{className:"text-sm",children:p})},m))})})]}),a.entries.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Nylige økter"}),e.jsx(Kt,{sessions:a.entries})]})]})}const Ba=d.lazy(()=>vs(()=>import("./AnalyticsDashboard-D_6BNLBO.js").then(t=>t.a),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35])).then(t=>({default:t.AnalyticsDashboard}))),Ua=()=>{const{tAnalytics:t,tCommon:s}=Z();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(D,{children:[e.jsx(E,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(Ct,{className:"h-5 w-5"}),String(t("dashboard.titleLoading"))]})}),e.jsx(T,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(J,{className:"h-8 w-48"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(J,{className:"h-8 w-24"}),e.jsx(J,{className:"h-8 w-24"})]})]})})]}),e.jsxs(D,{children:[e.jsx(E,{children:e.jsx(J,{className:"h-6 w-48"})}),e.jsx(T,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(J,{className:"h-[300px] w-full"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(J,{className:"h-20 w-full"}),e.jsx(J,{className:"h-20 w-full"}),e.jsx(J,{className:"h-20 w-full"})]})]})})]})]})},Va=t=>e.jsx(d.Suspense,{fallback:e.jsx(Ua,{}),children:e.jsx(Ba,{...t})});function qa({student:t,trackingEntries:s,filteredData:a,insights:o,isLoadingInsights:r}){const{tAnalytics:c}=Z();if(d.useEffect(()=>{L.debug("[AnalyticsSection] Props received",{studentId:t?.id,trackingEntriesCount:s?.length,filteredDataEntriesCount:a?.entries?.length,hasInsights:!!o,isLoadingInsights:r})},[t,s,a,o,r]),!t||!a||!s)return e.jsx("div",{className:"space-y-6",children:e.jsx(D,{className:"bg-gradient-card border-0 shadow-soft",children:e.jsx(T,{className:"p-6",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(kt,{className:"h-8 w-8 mx-auto mb-2"}),e.jsx("p",{children:c("missingDataTitle")}),e.jsx("p",{className:"text-sm mt-2",children:c("missingDataMessage")})]})})})});const x={entries:a.entries||[],emotions:a.emotions||[],sensoryInputs:a.sensoryInputs||[]};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:c("section.title")}),e.jsx("p",{className:"text-muted-foreground",children:c("section.subtitle",{name:t.name})})]}),e.jsx(le,{showToast:!1,children:e.jsx(Va,{student:t,filteredData:x})})]})}function Wa({value:t,onChange:s,className:a}){const[o,r]=d.useState(t?{from:t.from,to:t.to}:void 0);d.useEffect(()=>{t&&r({from:t.from,to:t.to})},[t]);const c=x=>{r(x),s?.(x?{from:x.from,to:x.to}:void 0)};return e.jsx("div",{className:R("grid gap-2",a),children:e.jsxs(vt,{children:[e.jsx(Nt,{asChild:!0,children:e.jsxs(M,{id:"date",variant:"outline",className:R("w-full justify-start text-left font-normal",!o&&"text-muted-foreground"),children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),o?.from?o.to?e.jsxs(e.Fragment,{children:[V(o.from,"LLL dd, y")," -"," ",V(o.to,"LLL dd, y")]}):V(o.from,"LLL dd, y"):e.jsx("span",{children:"Pick a date range"})]})}),e.jsx(wt,{className:"w-auto p-0",align:"start",children:e.jsx(St,{initialFocus:!0,mode:"range",defaultMonth:o?.from,selected:o,onSelect:c,numberOfMonths:2,className:R("p-3 pointer-events-auto")})})]})})}const Ha=["happy","sad","angry","anxious","calm","frustrated","excited","confused"],Ya=["visual","auditory","tactile","vestibular","proprioceptive"],Ka=["active","achieved","paused","discontinued"],Qa=({students:t,trackingEntries:s,emotions:a,sensoryInputs:o,goals:r,onResultsChange:c})=>{const{tAnalytics:x,tCommon:g}=Z(),[n,l]=d.useState({query:"",emotions:[],sensoryTypes:[],dateRange:void 0,goalStatus:[],intensityRange:{min:1,max:5}}),[h,u]=d.useState(!1),[i,f]=d.useState(0),k=d.useMemo(()=>{let m=t,y=s,j=a,w=o,v=r;if(n.query.trim()){const b=n.query.toLowerCase(),S=new Set;m=m.filter(C=>{const P=C.name.toLowerCase().includes(b)||C.notes?.toLowerCase().includes(b);return P&&S.add(C.id),P}),y=y.filter(C=>S.has(C.studentId)),j=j.filter(C=>S.has(C.studentId)),w=w.filter(C=>S.has(C.studentId)),v=v.filter(C=>S.has(C.studentId))}if(n.dateRange?.from&&n.dateRange?.to){const b={start:n.dateRange.from,end:n.dateRange.to};y=y.filter(S=>de(S.timestamp,b)),j=j.filter(S=>de(S.timestamp,b)),w=w.filter(S=>de(S.timestamp,b))}if(n.emotions.length>0){const b=new Set;j=j.filter(S=>{const C=n.emotions.includes(S.emotion);return C&&S.studentId&&b.add(S.studentId),C}),m=m.filter(S=>b.has(S.id))}if(n.sensoryTypes.length>0){const b=new Set;w=w.filter(S=>{const C=n.sensoryTypes.includes(S.sensoryType);return C&&S.studentId&&b.add(S.studentId),C}),n.emotions.length===0&&(m=m.filter(S=>b.has(S.id)))}if(j=j.filter(b=>b.intensity>=n.intensityRange.min&&b.intensity<=n.intensityRange.max),n.goalStatus.length>0){const b=new Set;v=v.filter(S=>{const C=n.goalStatus.includes(S.status);return C&&S.studentId&&b.add(S.studentId),C}),n.emotions.length===0&&n.sensoryTypes.length===0&&(m=m.filter(S=>b.has(S.id)))}return{students:m,entries:y,emotions:j,sensoryInputs:w,goals:v}},[t,s,a,o,r,n]);gt.useEffect(()=>{let m=0;n.query.trim()&&m++,n.emotions.length>0&&m++,n.sensoryTypes.length>0&&m++,n.dateRange?.from&&n.dateRange?.to&&m++,n.goalStatus.length>0&&m++,(n.intensityRange.min>1||n.intensityRange.max<5)&&m++,f(m)},[n]),gt.useEffect(()=>{c(k)},[k,c]);const N=()=>{l({query:"",emotions:[],sensoryTypes:[],dateRange:void 0,goalStatus:[],intensityRange:{min:1,max:5}})},p=(m,y)=>{switch(m){case"query":l(j=>({...j,query:""}));break;case"emotion":l(j=>({...j,emotions:j.emotions.filter(w=>w!==y)}));break;case"sensory":l(j=>({...j,sensoryTypes:j.sensoryTypes.filter(w=>w!==y)}));break;case"date":l(j=>({...j,dateRange:void 0}));break;case"goal":l(j=>({...j,goalStatus:j.goalStatus.filter(w=>w!==y)}));break}};return e.jsxs(D,{className:"bg-gradient-card border-0 shadow-soft",children:[e.jsxs(E,{className:"pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"h-5 w-5 text-primary"}),String(x("interface.advancedSearchFiltering"))]}),e.jsx(rt,{open:h,onOpenChange:u,children:e.jsx(Ht,{asChild:!0,children:e.jsxs(M,{variant:"ghost",size:"sm",children:[e.jsx(ds,{className:"h-4 w-4 mr-2"}),String(g("interface.filters")),i>0&&e.jsx(I,{variant:"secondary",className:"ml-2 h-5 w-5 rounded-full p-0 text-xs",children:i}),e.jsx(lt,{className:"h-4 w-4 ml-2"})]})})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(oe,{placeholder:`${String(g("interface.search"))}...`,value:n.query,onChange:m=>l(y=>({...y,query:m.target.value})),className:"flex-1"})]}),i>0&&e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:[n.query&&e.jsxs(I,{variant:"secondary",className:"flex items-center gap-1",children:[String(g("interface.search")),': "',n.query,'"',e.jsx(fe,{className:"h-3 w-3 cursor-pointer",onClick:()=>p("query")})]}),n.emotions.map(m=>e.jsxs(I,{variant:"secondary",className:"flex items-center gap-1",children:[String(g("interface.emotion")),": ",m,e.jsx(fe,{className:"h-3 w-3 cursor-pointer",onClick:()=>p("emotion",m)})]},m)),n.sensoryTypes.map(m=>e.jsxs(I,{variant:"secondary",className:"flex items-center gap-1",children:[String(g("interface.sensory")),": ",m,e.jsx(fe,{className:"h-3 w-3 cursor-pointer",onClick:()=>p("sensory",m)})]},m)),n.dateRange?.from&&n.dateRange?.to&&e.jsxs(I,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(K,{className:"h-3 w-3"}),V(n.dateRange.from,"MMM dd")," - ",V(n.dateRange.to,"MMM dd"),e.jsx(fe,{className:"h-3 w-3 cursor-pointer",onClick:()=>p("date")})]}),n.goalStatus.map(m=>e.jsxs(I,{variant:"secondary",className:"flex items-center gap-1",children:[String(g("interface.goal")),": ",m,e.jsx(fe,{className:"h-3 w-3 cursor-pointer",onClick:()=>p("goal",m)})]},m)),e.jsx(M,{variant:"ghost",size:"sm",onClick:N,className:"h-6 px-2 text-xs",children:String(g("interface.clearAll"))})]})]}),e.jsx(rt,{open:h,onOpenChange:u,children:e.jsx(Yt,{children:e.jsxs(T,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:String(g("interface.dateRange"))}),e.jsx(Wa,{value:n.dateRange,onChange:m=>l(y=>({...y,dateRange:m}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:String(g("interface.emotionTypes"))}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Ha.map(m=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ue,{id:`emotion-${m}`,checked:n.emotions.includes(m),onCheckedChange:y=>{l(y?j=>({...j,emotions:[...j.emotions,m]}):j=>({...j,emotions:j.emotions.filter(w=>w!==m)}))}}),e.jsx("label",{htmlFor:`emotion-${m}`,className:"text-sm capitalize",children:m})]},m))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:String(g("interface.sensoryTypes"))}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Ya.map(m=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ue,{id:`sensory-${m}`,checked:n.sensoryTypes.includes(m),onCheckedChange:y=>{l(y?j=>({...j,sensoryTypes:[...j.sensoryTypes,m]}):j=>({...j,sensoryTypes:j.sensoryTypes.filter(w=>w!==m)}))}}),e.jsx("label",{htmlFor:`sensory-${m}`,className:"text-sm capitalize",children:m})]},m))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:String(g("interface.goalStatus"))}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Ka.map(m=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ue,{id:`goal-${m}`,checked:n.goalStatus.includes(m),onCheckedChange:y=>{l(y?j=>({...j,goalStatus:[...j.goalStatus,m]}):j=>({...j,goalStatus:j.goalStatus.filter(w=>w!==m)}))}}),e.jsx("label",{htmlFor:`goal-${m}`,className:"text-sm capitalize",children:m})]},m))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:String(g("interface.emotionIntensityRange"))}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(ue,{value:n.intensityRange.min.toString(),onValueChange:m=>l(y=>({...y,intensityRange:{...y.intensityRange,min:parseInt(m)}})),children:[e.jsx(ge,{className:"w-20",children:e.jsx(he,{})}),e.jsx(xe,{children:[1,2,3,4,5].map(m=>e.jsx(B,{value:m.toString(),children:m},m))})]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:String(g("interface.to"))}),e.jsxs(ue,{value:n.intensityRange.max.toString(),onValueChange:m=>l(y=>({...y,intensityRange:{...y.intensityRange,max:parseInt(m)}})),children:[e.jsx(ge,{className:"w-20",children:e.jsx(he,{})}),e.jsx(xe,{children:[1,2,3,4,5].map(m=>e.jsx(B,{value:m.toString(),children:m},m))})]})]})]})]}),e.jsx("div",{className:"pt-4 border-t border-border/50",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[e.jsxs("span",{children:[String(g("interface.results")),": ",k.students.length," students, ",k.emotions.length," emotions, ",k.sensoryInputs.length," sensory inputs, ",k.goals.length," goals"]}),i>0&&e.jsx(M,{variant:"ghost",size:"sm",onClick:N,children:String(g("interface.clearAllFilters"))})]})})]})})})]})},Ae=[{id:"morning-routine",name:"Morning Arrival",description:"Standard morning check-in for classroom entry",category:"morning",emotions:[{emotion:"calm",intensity:3},{emotion:"excited",intensity:2}],sensoryInputs:[{sensoryType:"visual",response:"neutral",intensity:2},{sensoryType:"auditory",response:"seeking",intensity:3}],isDefault:!0,usageCount:0},{id:"transition-stress",name:"Transition Difficulty",description:"Quick entry for challenging transitions",category:"transition",emotions:[{emotion:"anxious",intensity:4},{emotion:"angry",intensity:3}],sensoryInputs:[{sensoryType:"auditory",response:"avoiding",intensity:4},{sensoryType:"tactile",response:"seeking",intensity:4}],isDefault:!0,usageCount:0},{id:"focused-learning",name:"Engaged Learning",description:"Positive learning engagement state",category:"learning",emotions:[{emotion:"calm",intensity:4},{emotion:"excited",intensity:3}],sensoryInputs:[{sensoryType:"visual",response:"seeking",intensity:3},{sensoryType:"proprioceptive",response:"neutral",intensity:2}],isDefault:!0,usageCount:0},{id:"sensory-break",name:"Sensory Break",description:"During or after sensory regulation break",category:"break",emotions:[{emotion:"calm",intensity:4}],sensoryInputs:[{sensoryType:"proprioceptive",response:"seeking",intensity:4},{sensoryType:"vestibular",response:"seeking",intensity:3}],isDefault:!0,usageCount:0},{id:"afternoon-fatigue",name:"Afternoon Fatigue",description:"End-of-day tiredness and regulation",category:"afternoon",emotions:[{emotion:"sad",intensity:2},{emotion:"calm",intensity:2}],sensoryInputs:[{sensoryType:"auditory",response:"avoiding",intensity:3},{sensoryType:"visual",response:"avoiding",intensity:2}],isDefault:!0,usageCount:0}],Ja=({studentId:t,onApplyTemplate:s})=>{const[a,o]=d.useState(()=>{try{const p=localStorage.getItem(`quickTemplates_${t}`);if(!p)return Ae;const m=JSON.parse(p);if(!Array.isArray(m))return L.warn("Invalid template data in localStorage, using defaults",{studentId:t}),Ae;const y=w=>w&&typeof w.id=="string"&&typeof w.name=="string"&&Array.isArray(w.emotions)&&Array.isArray(w.sensoryInputs),j=m.filter(y);return j.length===0?(L.warn("No valid templates found in localStorage, using defaults",{studentId:t}),Ae):j}catch(p){return L.error("Failed to parse saved templates, using defaults",p),Ae}}),[r,c]=d.useState(!1),[x,g]=d.useState(null),[n,l]=d.useState({name:"",description:"",category:"custom",emotions:[],sensoryInputs:[],isDefault:!1,usageCount:0}),h=p=>{o(p);try{localStorage.setItem(`quickTemplates_${t}`,JSON.stringify(p))}catch(m){L.error("Failed to save templates to localStorage",m),z.error("Failed to save template changes. Storage may be full.")}},u=p=>{const m=p.emotions.map(w=>({...w,studentId:t,id:`temp_${Date.now()}_${Math.random()}`,timestamp:new Date})),y=p.sensoryInputs.map(w=>({...w,studentId:t,id:`temp_${Date.now()}_${Math.random()}`,timestamp:new Date})),j=a.map(w=>w.id===p.id?{...w,usageCount:w.usageCount+1,lastUsed:new Date}:w);h(j),s(m,y),z.success(`Applied template: ${p.name}`)},i=p=>{if(a.find(j=>j.id===p)?.isDefault){z.error("Cannot delete default templates");return}const y=a.filter(j=>j.id!==p);h(y),z.success("Template deleted")},f=()=>{if(!n.name?.trim()){z.error("Template name is required");return}const p={id:`custom_${Date.now()}`,name:n.name,description:n.description||"",category:n.category||"custom",emotions:n.emotions||[],sensoryInputs:n.sensoryInputs||[],isDefault:!1,usageCount:0},m=[...a,p];h(m),l({name:"",description:"",category:"custom",emotions:[],sensoryInputs:[],isDefault:!1,usageCount:0}),c(!1),z.success("Template created successfully")},k=p=>{switch(p){case"morning":return"bg-gradient-to-r from-yellow-400 to-orange-400";case"transition":return"bg-gradient-to-r from-red-400 to-pink-400";case"learning":return"bg-gradient-to-r from-blue-400 to-indigo-400";case"break":return"bg-gradient-to-r from-green-400 to-teal-400";case"afternoon":return"bg-gradient-to-r from-purple-400 to-indigo-400";default:return"bg-gradient-to-r from-gray-400 to-gray-500"}},N=[...a].sort((p,m)=>p.usageCount!==m.usageCount?m.usageCount-p.usageCount:p.lastUsed&&m.lastUsed?m.lastUsed.getTime()-p.lastUsed.getTime():p.isDefault!==m.isDefault?p.isDefault?-1:1:p.name.localeCompare(m.name));return e.jsxs(D,{className:"bg-gradient-card border-0 shadow-soft",children:[e.jsx(E,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-5 w-5 text-primary"}),"Quick Entry Templates"]}),e.jsxs(Dt,{open:r,onOpenChange:c,children:[e.jsx(Tt,{asChild:!0,children:e.jsxs(M,{size:"sm",variant:"outline","aria-label":"Create new template",title:"Create new template",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"New Template"})]})}),e.jsxs(Mt,{className:"max-w-md",children:[e.jsxs(Pt,{children:[e.jsx(It,{children:"Create Quick Entry Template"}),e.jsx(Rt,{children:"Define a name, optional description, category, and default values."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Template Name"}),e.jsx(oe,{placeholder:"e.g., Sensory Overload Response",value:n.name||"",onChange:p=>l(m=>({...m,name:p.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Description"}),e.jsx(Qe,{placeholder:"Brief description of when to use this template",value:n.description||"",onChange:p=>l(m=>({...m,description:p.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Category"}),e.jsxs(ue,{value:n.category,onValueChange:p=>l(m=>({...m,category:p})),children:[e.jsx(ge,{children:e.jsx(he,{})}),e.jsxs(xe,{children:[e.jsx(B,{value:"morning",children:"Morning"}),e.jsx(B,{value:"transition",children:"Transition"}),e.jsx(B,{value:"learning",children:"Learning"}),e.jsx(B,{value:"break",children:"Break"}),e.jsx(B,{value:"afternoon",children:"Afternoon"}),e.jsx(B,{value:"custom",children:"Custom"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(M,{variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsx(M,{onClick:f,children:"Create Template"})]})]})]})]})]})}),e.jsxs(T,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:N.map(p=>e.jsxs(D,{className:"relative overflow-hidden border-border/50 hover:shadow-md transition-shadow",children:[p.usageCount>0&&e.jsxs("div",{className:"absolute top-2 right-2 flex items-center gap-1",children:[e.jsx(Bs,{className:"h-3 w-3 text-yellow-500 fill-current"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:p.usageCount})]}),e.jsx("div",{className:`h-2 ${k(p.category)}`}),e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:p.name}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:p.description})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(pe,{className:"h-3 w-3"}),e.jsx(I,{variant:"outline",className:"text-xs capitalize",children:p.category})]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[p.emotions.slice(0,2).map((m,y)=>e.jsxs(I,{variant:"secondary",className:"text-xs",children:[m.emotion," (",m.intensity,")"]},y)),p.emotions.length>2&&e.jsxs(I,{variant:"secondary",className:"text-xs",children:["+",p.emotions.length-2," more"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsx(M,{size:"sm",onClick:()=>u(p),className:"flex-1 mr-2",children:"Apply Template"}),!p.isDefault&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx(M,{size:"icon",variant:"ghost","aria-label":"Edit template",title:"Edit template",onClick:()=>g(p),children:e.jsx(Et,{className:"h-3 w-3"})}),e.jsx(M,{size:"icon",variant:"ghost","aria-label":"Delete template",title:"Delete template",onClick:()=>i(p.id),children:e.jsx(At,{className:"h-3 w-3"})})]})]})]})})]},p.id))}),a.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Ke,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No quick entry templates yet"}),e.jsx("p",{className:"text-sm",children:"Create templates for common tracking scenarios"})]})]})]})},Za=({emotions:t,sensoryInputs:s,currentRange:a,className:o})=>{const{tAnalytics:r,tStudent:c}=Z(),[x,g]=d.useState("previous"),n=()=>{const m=a.start.getTime(),j=a.end.getTime()-m;switch(x){case"previous":return{start:new Date(m-j),end:new Date(m-1),label:"Previous period"};case"same-last-month":return{start:Le(a.start,1),end:Le(a.end,1),label:"Same period last month"};case"same-last-year":return{start:new Date(a.start.getFullYear()-1,a.start.getMonth(),a.start.getDate()),end:new Date(a.end.getFullYear()-1,a.end.getMonth(),a.end.getDate()),label:"Same period last year"};default:return a}},l=(m,y,j)=>{const w=m.filter(F=>de(F.timestamp,{start:j.start,end:j.end})),v=y.filter(F=>de(F.timestamp,{start:j.start,end:j.end})),b=w.length>0?w.reduce((F,_)=>F+_.intensity,0)/w.length:0,S=w.reduce((F,_)=>(F[_.emotion]=(F[_.emotion]||0)+1,F),{}),C=Object.entries(S).sort(([,F],[,_])=>_-F)[0]?.[0]||"None",P=v.filter(F=>F.response==="seeking").length,$=v.length>0?P/v.length:0;return{emotionsCount:w.length,sensoryCount:v.length,avgEmotionIntensity:b,mostCommonEmotion:C,seekingRatio:$,period:j.label}},h=n(),u=l(t,s,a),i=l(t,s,h),f=(m,y)=>m>y?e.jsx(te,{className:"h-4 w-4 text-emerald-500"}):m<y?e.jsx(Ns,{className:"h-4 w-4 text-red-500"}):e.jsx($s,{className:"h-4 w-4 text-muted-foreground"}),k=(m,y)=>m>y?"text-emerald-600":m<y?"text-red-600":"text-muted-foreground",N=(m,y)=>{if(y===0)return m>0?"+100%":"0%";const j=(m-y)/y*100;return`${j>0?"+":""}${j.toFixed(1)}%`},p=[{label:String(r("interface.totalEmotions")),current:u.emotionsCount,previous:i.emotionsCount},{label:String(c("interface.sensoryInputs")),current:u.sensoryCount,previous:i.sensoryCount},{label:String(r("interface.avgIntensity")),current:u.avgEmotionIntensity,previous:i.avgEmotionIntensity,format:m=>m.toFixed(1)},{label:String(r("interface.seekingRatio")),current:u.seekingRatio,previous:i.seekingRatio,format:m=>`${(m*100).toFixed(1)}%`}];return e.jsxs(D,{className:R("bg-gradient-card border-0 shadow-soft font-dyslexia",o),children:[e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"h-5 w-5"}),String(r("interface.periodComparison"))]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{variant:x==="previous"?"default":"outline",size:"sm",onClick:()=>g("previous"),className:"text-xs",children:String(r("interface.previous"))}),e.jsx(M,{variant:x==="same-last-month"?"default":"outline",size:"sm",onClick:()=>g("same-last-month"),className:"text-xs",children:String(r("interface.lastMonth"))}),e.jsx(M,{variant:x==="same-last-year"?"default":"outline",size:"sm",onClick:()=>g("same-last-year"),className:"text-xs",children:String(r("interface.lastYear"))})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:a.label}),e.jsx("span",{children:"vs"}),e.jsx("span",{children:h.label})]})]}),e.jsxs(T,{children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:p.map(m=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:m.label}),e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx("span",{className:"text-lg font-semibold",children:m.format?m.format(m.current):m.current}),f(m.current,m.previous)]}),e.jsx("div",{className:R("text-xs font-medium",k(m.current,m.previous)),children:N(m.current,m.previous)}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["vs ",m.format?m.format(m.previous):m.previous]})]},m.label))}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-border",children:[e.jsx("h4",{className:"text-sm font-medium mb-3",children:String(r("interface.keyChanges"))}),e.jsxs("div",{className:"space-y-2",children:[u.mostCommonEmotion!==i.mostCommonEmotion&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(I,{variant:"outline",className:"text-xs",children:"Emotion"}),e.jsxs("span",{className:"text-muted-foreground",children:["Most common changed from ",e.jsx("span",{className:"font-medium",children:i.mostCommonEmotion})," to"," ",e.jsx("span",{className:"font-medium",children:u.mostCommonEmotion})]})]}),Math.abs(u.avgEmotionIntensity-i.avgEmotionIntensity)>.5&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(I,{variant:"outline",className:"text-xs",children:"Intensity"}),e.jsxs("span",{className:"text-muted-foreground",children:["Average intensity"," ",u.avgEmotionIntensity>i.avgEmotionIntensity?"increased":"decreased"," by"," ",e.jsxs("span",{className:"font-medium",children:[Math.abs(u.avgEmotionIntensity-i.avgEmotionIntensity).toFixed(1)," points"]})]})]}),Math.abs(u.seekingRatio-i.seekingRatio)>.1&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(I,{variant:"outline",className:"text-xs",children:"Sensory"}),e.jsxs("span",{className:"text-muted-foreground",children:["Sensory seeking behavior"," ",u.seekingRatio>i.seekingRatio?"increased":"decreased"," by"," ",e.jsxs("span",{className:"font-medium",children:[Math.abs((u.seekingRatio-i.seekingRatio)*100).toFixed(1),"%"]})]})]})]})]})]})]})};function Xa({student:t,trackingEntries:s,emotions:a,sensoryInputs:o,goals:r,activeToolSection:c,onToolSectionChange:x,onSearchResults:g}){const{tStudent:n}=Z(),l=ot(),h=f=>{l(`/track/${t.id}`,{state:{prefilledData:f}})},u=[{id:"search",title:n("interface.advancedSearch"),icon:Ze,component:e.jsx(Qa,{students:[t],trackingEntries:s,emotions:a,sensoryInputs:o,goals:r,onResultsChange:g})},{id:"templates",title:n("interface.quickTemplates"),icon:Ke,component:e.jsx(Ja,{studentId:t.id,onApplyTemplate:h})},{id:"compare",title:"Periodesammenligning",icon:K,component:e.jsx(Za,{emotions:a,sensoryInputs:o,currentRange:{start:new Date,end:new Date,label:"Current"}})}],i=u.find(f=>f.id===c);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Verktøy"}),e.jsx("p",{className:"text-muted-foreground",children:"Avanserte verktøy for søk, maler og sammenligning"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:u.map(f=>e.jsxs("button",{onClick:()=>x(f.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg border transition-colors ${c===f.id?"bg-accent text-accent-foreground border-accent":"bg-background hover:bg-accent/50 border-border"}`,children:[e.jsx(f.icon,{className:"h-4 w-4"}),String(f.title)]},f.id))}),i&&e.jsxs(D,{className:"bg-gradient-card border-0 shadow-soft",children:[e.jsx(E,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(i.icon,{className:"h-5 w-5"}),String(i.title)]})}),e.jsx(T,{children:i.component})]})]})}const en=({student:t,onGoalUpdate:s})=>{const[a,o]=d.useState([]),[r,c]=d.useState(!1),[x,g]=d.useState(null),[n,l]=d.useState({title:"",description:"",category:"behavioral",measurableObjective:"",targetDate:"",targetValue:100,baselineValue:0}),h=d.useCallback(()=>{const b=q.getGoals().filter(S=>S.studentId===t.id);o(b)},[t.id]);d.useEffect(()=>{h()},[h]);const u=()=>{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID();const v=Date.now().toString(36),b=Math.random().toString(36).substring(2,11),S=Math.random().toString(36).substring(2,11);return`${v}-${b}-${S}`},i=()=>{if(!n.title.trim()||!n.description.trim()||!n.measurableObjective.trim()){z.error("Please fill in all required fields");return}if(!n.targetDate){z.error("Please select a target date");return}const v=new Date(n.targetDate);if(isNaN(v.getTime())){z.error("Invalid target date");return}const b=new Date;if(b.setHours(0,0,0,0),v<b){z.error("Target date must be in the future");return}if(n.targetValue<=n.baselineValue){z.error("Target value must be greater than baseline value");return}const S={id:u(),studentId:t.id,title:n.title,description:n.description,category:n.category,targetDate:v,createdDate:new Date,status:"active",measurableObjective:n.measurableObjective,currentProgress:0,milestones:[],interventions:[],baselineValue:n.baselineValue,targetValue:n.targetValue,dataPoints:[{id:u(),timestamp:new Date,value:n.baselineValue,notes:"Baseline measurement",collectedBy:"Teacher"}]};q.saveGoal(S),h(),y(),c(!1),z.success("Goal created successfully!"),s?.()},f=(v,b)=>{const S=a.find(P=>P.id===v);if(!S)return;const C={...S,...b};q.saveGoal(C),h(),s?.()},k=(v,b,S)=>{const C=a.find(_=>_.id===v);if(!C)return;const P={id:u(),timestamp:new Date,value:b,notes:S,collectedBy:"Teacher"},$=[...C.dataPoints,P],F=C.targetValue?(b-(C.baselineValue||0))/(C.targetValue-(C.baselineValue||0))*100:0;f(v,{dataPoints:$,currentProgress:Math.max(0,Math.min(100,F))}),z.success("Progress updated!")},N=(v,b,S,C)=>{const P=a.find(F=>F.id===v);if(!P)return;const $={id:u(),title:b,description:S,targetDate:C,isCompleted:!1};f(v,{milestones:[...P.milestones,$]}),z.success("Milestone added!")},p=(v,b)=>{const S=a.find(P=>P.id===v);if(!S)return;const C=S.milestones.map(P=>P.id===b?{...P,isCompleted:!0,completedDate:new Date}:P);f(v,{milestones:C}),z.success("Milestone completed! 🎉")},m=v=>{const b=a.find(S=>S.id===v);if(!b){L.warn("Attempted to delete non-existent goal",{goalId:v});return}try{if(window.confirm(`Are you sure you want to delete the goal "${b.title}"?`)){const C={...b,status:"discontinued",deletedAt:new Date};q.saveGoal(C),h(),z.success("Goal deleted"),s?.()}}catch(S){L.error("Failed to delete goal",S),z.error("Failed to delete goal. Please try again.")}},y=()=>{l({title:"",description:"",category:"behavioral",measurableObjective:"",targetDate:"",targetValue:100,baselineValue:0}),g(null)},j=v=>{switch(v){case"active":return"bg-blue-500";case"achieved":return"bg-green-500";case"modified":return"bg-yellow-500";case"discontinued":return"bg-red-500";default:return"bg-gray-500"}},w=v=>{switch(v){case"behavioral":return"🎯";case"academic":return"📚";case"social":return"👥";case"sensory":return"🎨";case"communication":return"💬";default:return"📋"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"IEP Goals"}),e.jsxs("p",{className:"text-muted-foreground",children:["Track and monitor ",t.name,"'s progress toward educational objectives"]})]}),e.jsxs(Dt,{open:r,onOpenChange:c,children:[e.jsx(Tt,{asChild:!0,children:e.jsxs(M,{className:"bg-gradient-primary hover:opacity-90 font-dyslexia",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"New Goal"]})}),e.jsxs(Mt,{className:"max-w-2xl",children:[e.jsxs(Pt,{children:[e.jsx(It,{children:"Create New IEP Goal"}),e.jsx(Rt,{children:"Enter goal details, targets, and measurable objectives."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(ie,{htmlFor:"title",children:"Goal Title *"}),e.jsx(oe,{id:"title",value:n.title,onChange:v=>l(b=>({...b,title:v.target.value})),placeholder:"e.g., Improve emotional regulation during transitions"})]}),e.jsxs("div",{children:[e.jsx(ie,{htmlFor:"category",children:"Category"}),e.jsxs(ue,{value:n.category,onValueChange:v=>l(b=>({...b,category:v})),children:[e.jsx(ge,{children:e.jsx(he,{})}),e.jsxs(xe,{children:[e.jsx(B,{value:"behavioral",children:"Behavioral"}),e.jsx(B,{value:"academic",children:"Academic"}),e.jsx(B,{value:"social",children:"Social"}),e.jsx(B,{value:"sensory",children:"Sensory"}),e.jsx(B,{value:"communication",children:"Communication"})]})]})]}),e.jsxs("div",{children:[e.jsx(ie,{htmlFor:"description",children:"Description *"}),e.jsx(Qe,{id:"description",value:n.description,onChange:v=>l(b=>({...b,description:v.target.value})),placeholder:"Detailed description of what the student will achieve..."})]}),e.jsxs("div",{children:[e.jsx(ie,{htmlFor:"measurable",children:"Measurable Objective *"}),e.jsx(Qe,{id:"measurable",value:n.measurableObjective,onChange:v=>l(b=>({...b,measurableObjective:v.target.value})),placeholder:"How will progress be measured? Include specific criteria..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(ie,{htmlFor:"baseline",children:"Baseline Value"}),e.jsx(oe,{id:"baseline",type:"number",value:n.baselineValue,onChange:v=>l(b=>({...b,baselineValue:Number(v.target.value)}))})]}),e.jsxs("div",{children:[e.jsx(ie,{htmlFor:"target",children:"Target Value"}),e.jsx(oe,{id:"target",type:"number",value:n.targetValue,onChange:v=>l(b=>({...b,targetValue:Number(v.target.value)}))})]})]}),e.jsxs("div",{children:[e.jsx(ie,{htmlFor:"targetDate",children:"Target Date"}),e.jsx(oe,{id:"targetDate",type:"date",value:n.targetDate,onChange:v=>l(b=>({...b,targetDate:v.target.value}))})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(M,{variant:"outline",onClick:()=>{y(),c(!1)},children:"Cancel"}),e.jsx(M,{onClick:i,children:"Create Goal"})]})]})]})]})]}),a.length===0?e.jsx(D,{className:"bg-gradient-card border-0 shadow-soft",children:e.jsxs(T,{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(Je,{className:"h-16 w-16 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-foreground mb-2",children:"No IEP Goals Yet"}),e.jsxs("p",{className:"text-muted-foreground text-center mb-6 max-w-md",children:["Start by creating your first IEP goal to track ",t.name,"'s educational progress."]}),e.jsxs(M,{onClick:()=>c(!0),className:"bg-gradient-primary hover:opacity-90 font-dyslexia",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Create First Goal"]})]})}):e.jsx("div",{className:"grid gap-6",children:a.map(v=>e.jsxs(D,{className:"bg-gradient-card border-0 shadow-soft",children:[e.jsx(E,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl",children:w(v.category)}),e.jsxs("div",{children:[e.jsxs(O,{className:"flex items-center gap-2",children:[v.title,e.jsx(I,{variant:"outline",className:`${j(v.status)} text-white border-0`,children:v.status})]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:v.description}),e.jsx(I,{variant:"secondary",className:"mt-2",children:v.category})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{variant:"ghost",size:"icon","aria-label":"Edit goal",title:"Edit goal",children:e.jsx(Et,{className:"h-4 w-4"})}),e.jsx(M,{variant:"ghost",size:"icon","aria-label":"Delete goal",title:"Delete goal",onClick:()=>m(v.id),children:e.jsx(At,{className:"h-4 w-4"})})]})]})}),e.jsxs(T,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Progress"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[Math.round(v.currentProgress),"%"]})]}),e.jsx(Q,{value:v.currentProgress,className:"h-3"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Measurable Objective"}),e.jsx("p",{className:"text-sm text-muted-foreground bg-muted/50 p-3 rounded-lg",children:v.measurableObjective})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(K,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:["Created: ",V(v.createdDate,"MMM dd, yyyy")]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Je,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:["Target: ",V(v.targetDate,"MMM dd, yyyy")]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium",children:"Milestones"}),e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>{const b=prompt("Milestone title:"),S=prompt("Milestone description:"),C=prompt("Target date (YYYY-MM-DD):");b&&S&&C&&N(v.id,b,S,new Date(C))},children:[e.jsx(we,{className:"h-3 w-3 mr-1"}),"Add"]})]}),v.milestones.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No milestones yet"}):e.jsx("div",{className:"space-y-2",children:v.milestones.map(b=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted/30 rounded",children:[e.jsx(M,{variant:"ghost",size:"icon","aria-label":b.isCompleted?"Milestone completed":"Mark milestone complete",title:b.isCompleted?"Milestone completed":"Mark milestone complete",onClick:()=>!b.isCompleted&&p(v.id,b.id),disabled:b.isCompleted,children:e.jsx(Y,{className:`h-4 w-4 ${b.isCompleted?"text-green-500":"text-muted-foreground"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-sm ${b.isCompleted?"line-through text-muted-foreground":""}`,children:b.title}),e.jsx("p",{className:"text-xs text-muted-foreground",children:b.description})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:V(b.targetDate,"MMM dd")})]},b.id))})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>{const b=prompt("Enter current progress value:"),S=prompt("Progress notes (optional):");b&&k(v.id,Number(b),S||void 0)},children:[e.jsx(te,{className:"h-4 w-4 mr-1"}),"Update Progress"]})})]})]},v.id))})]})},be=d.memo(({value:t,duration:s=.8,className:a})=>{const[o,r]=d.useState(0),c=d.useRef(),x=d.useRef(),g=d.useRef(0);return d.useEffect(()=>{c.current&&cancelAnimationFrame(c.current);const n=l=>{x.current||(x.current=l);const h=l-x.current,u=Math.min(h/(s*1e3),1),i=1-Math.pow(1-u,4),f=g.current+(t-g.current)*i;r(Math.round(f)),u<1?c.current=requestAnimationFrame(n):(r(t),g.current=t)};return x.current=void 0,c.current=requestAnimationFrame(n),()=>{c.current&&cancelAnimationFrame(c.current)}},[t,s]),e.jsx("span",{className:a,children:o.toLocaleString()})},(t,s)=>t.value===s.value&&t.duration===s.duration&&t.className===s.className);be.displayName="OptimizedAnimatedCounter";const He=typeof requestIdleCallback<"u"?requestIdleCallback:(t=>window.setTimeout(()=>t({didTimeout:!1,timeRemaining:()=>50}),0)),tn=typeof cancelIdleCallback<"u"?cancelIdleCallback:clearTimeout;function sn(t){const{emotions:s,sensoryInputs:a,entries:o,analyticsResults:r}=t,[c,x]=d.useState({emotionTrends:[],emotionDistribution:[],sensoryResponses:[]}),[g,n]=d.useState({isLoading:!0,steps:{emotionDistribution:!1,sensoryResponses:!1,emotionTrends:!1},error:null}),l=d.useRef([]),h=d.useRef([]),u=d.useRef(!0);d.useEffect(()=>()=>{u.current=!1,l.current.forEach(N=>{try{tn(N)}catch{}}),h.current.forEach(N=>clearTimeout(N)),l.current=[],h.current=[]},[]);const i=d.useCallback(()=>{x({emotionTrends:[],emotionDistribution:[],sensoryResponses:[]}),n({isLoading:!0,steps:{emotionDistribution:!1,sensoryResponses:!1,emotionTrends:!1},error:null})},[]),f=d.useCallback(N=>{u.current&&x(p=>N(p))},[]),k=d.useCallback(N=>{u.current&&n(p=>({...p,steps:{...p.steps,[N]:!0},isLoading:!(p.steps.emotionDistribution&&p.steps.sensoryResponses&&(N==="emotionTrends"||p.steps.emotionTrends))}))},[]);return d.useEffect(()=>{i();const N=He(()=>{try{const y=new Map;s.forEach(w=>{y.set(w.emotion,(y.get(w.emotion)||0)+1)});const j=Array.from(y.entries()).map(([w,v])=>({name:w,value:v}));f(w=>({...w,emotionDistribution:j})),k("emotionDistribution")}catch(y){L.error("[useProgressiveChartData] Failed computing emotion distribution",y),n(j=>({...j,error:y instanceof Error?y:new Error("Unknown error")}))}},{timeout:100});l.current.push(N);const p=window.setTimeout(()=>{const y=He(()=>{try{const j=new Map;a.forEach(v=>{const b=j.get(v.sensoryType)||{type:v.sensoryType,total:0};b[v.response]=(typeof b[v.response]=="number"?b[v.response]:0)+1,b.total=(b.total||0)+1,j.set(v.sensoryType,b)});const w=Array.from(j.values());f(v=>({...v,sensoryResponses:w})),k("sensoryResponses")}catch(j){L.error("[useProgressiveChartData] Failed computing sensory responses",j),n(w=>({...w,error:j instanceof Error?j:new Error("Unknown error")}))}},{timeout:200});l.current.push(y)},50);h.current.push(p);const m=window.setTimeout(()=>{const y=He(()=>{try{const j=Array.from(new Set(s.map(S=>S.emotion))),w=new Map;s.forEach(S=>{const C=S.timestamp instanceof Date?S.timestamp.toLocaleDateString():new Date(S.timestamp).toLocaleDateString();if(!w.has(C)){const F={date:C,count:0};j.forEach(_=>{F[_]=0}),w.set(C,F)}const P=w.get(C),$=P[S.emotion];P[S.emotion]=(typeof $=="number"?$:0)+S.intensity,P.count=(P.count||0)+1});const v=S=>new Date(S),b=Array.from(w.values()).sort((S,C)=>v(S.date).getTime()-v(C.date).getTime());f(S=>({...S,emotionTrends:b})),k("emotionTrends")}catch(j){L.error("[useProgressiveChartData] Failed computing emotion trends",j),n(w=>({...w,error:j instanceof Error?j:new Error("Unknown error")}))}},{timeout:400});l.current.push(y)},100);if(h.current.push(m),r)try{L.debug("[useProgressiveChartData] analyticsResults available",{patterns:r.patterns?.length||0,correlations:r.correlations?.length||0})}catch{}},[s,a,o,r,i,f,k]),{data:c,state:g,reset:i}}const an={happy:"#10B981",calm:"#06B6D4",excited:"#8B5CF6",sad:"#3B82F6",anxious:"#F59E0B",angry:"#EF4444"},nn=d.memo(({emotions:t,sensoryInputs:s,studentName:a,showTimeFilter:o=!1,selectedRange:r})=>{const{data:c,state:x}=sn({emotions:t,sensoryInputs:s,entries:[],analyticsResults:null});return t.length===0&&s.length===0?e.jsx(D,{className:"font-dyslexia bg-gradient-card border-0",children:e.jsx(T,{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(re,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg",children:"No data to display yet"}),e.jsx("p",{className:"text-sm",children:"Start tracking emotions and sensory inputs to see visualizations"})]})})}):e.jsxs("div",{className:"space-y-6 font-dyslexia",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("h2",{className:"text-2xl font-semibold text-foreground mb-2",children:["Data Insights for ",a]}),e.jsxs("p",{className:"text-muted-foreground",children:[r&&`${r} • `,"Tracking ",t.length," emotions and ",s.length," sensory inputs"]})]}),(x.steps.emotionTrends||c.emotionTrends.length>0)&&e.jsxs(D,{className:"bg-gradient-card border-0",children:[e.jsx(E,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),"Emotion Trends Over Time"]})}),e.jsx(T,{children:e.jsx(le,{children:x.isLoading&&!x.steps.emotionTrends?e.jsx("div",{"aria-label":"Loading emotion trends",className:"h-[300px] w-full",children:e.jsx("div",{className:"h-full w-full animate-pulse rounded-md border border-border/50 bg-muted/20"})}):(()=>{const g=new Map;for(const h of t){const u=h.timestamp instanceof Date?h.timestamp:new Date(h.timestamp);if(Number.isNaN(u.getTime()))continue;const i=u.toISOString().slice(0,10);g.has(i)||g.set(i,{date:i,avgEmotionIntensity:0,positiveEmotions:0,negativeEmotions:0,totalSensoryInputs:0,count:0});const f=g.get(i),k=typeof h.intensity=="number"?h.intensity:Number(h.intensity)||0;f.avgEmotionIntensity=(f.avgEmotionIntensity*f.count+k)/(f.count+1),f.count+=1;const N=String(h.emotion||"").toLowerCase();["happy","calm","focused","excited","proud"].includes(N)&&(f.positiveEmotions+=1),["sad","angry","anxious","frustrated","overwhelmed"].includes(N)&&(f.negativeEmotions+=1)}for(const h of s){const u=h.timestamp instanceof Date?h.timestamp:new Date(h.timestamp);if(Number.isNaN(u.getTime()))continue;const i=u.toISOString().slice(0,10);g.has(i)||g.set(i,{date:i,avgEmotionIntensity:0,positiveEmotions:0,negativeEmotions:0,totalSensoryInputs:0,count:0});const f=g.get(i);f.totalSensoryInputs+=1}const n=Array.from(g.values()).sort((h,u)=>h.date.localeCompare(u.date)).map(({count:h,...u})=>u),l=ws(n,{title:void 0,showMovingAverage:!0,movingAverageWindow:7,useDualYAxis:!0,thresholds:{emotion:7,sensory:5}});return e.jsx(me,{option:l,height:300,"aria-label":"Emotion trends line chart",exportRegistration:{id:"emotion-trends",type:"trends",title:"Emotion Trends"}})})()})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(c.emotionDistribution.length>0||x.isLoading)&&e.jsxs(D,{className:"bg-gradient-card border-0",children:[e.jsx(E,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(Os,{className:"h-5 w-5"}),"Emotion Distribution"]})}),e.jsx(T,{children:e.jsx(le,{children:x.isLoading&&!x.steps.emotionDistribution?e.jsx("div",{"aria-label":"Loading emotion distribution",className:"h-[250px] w-full",children:e.jsx("div",{className:"h-full w-full animate-pulse rounded-md border border-border/50 bg-muted/20"})}):(()=>{const g={dataset:{source:c.emotionDistribution.map(n=>({name:n.name,value:n.value}))},tooltip:{trigger:"item"},legend:{bottom:0,type:"scroll"},series:[{type:"pie",radius:["45%","70%"],label:{formatter:"{b}: {@value} ({d}%)"},encode:{itemName:"name",value:"value"},itemStyle:{color:n=>{const l=n?.name||"";return an[l]||"#8884d8"}}}]};return e.jsx(me,{option:g,height:250,"aria-label":"Emotion distribution donut chart",exportRegistration:{id:"emotion-distribution",type:"distribution",title:"Emotion Distribution"}})})()})})]}),(c.sensoryResponses.length>0||x.isLoading)&&e.jsxs(D,{className:"bg-gradient-card border-0",children:[e.jsx(E,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5"}),"Sensory Response Patterns"]})}),e.jsx(T,{children:e.jsx(le,{children:x.isLoading&&!x.steps.sensoryResponses?e.jsx("div",{"aria-label":"Loading sensory responses",className:"h-[250px] w-full",children:e.jsx("div",{className:"h-full w-full animate-pulse rounded-md border border-border/50 bg-muted/20"})}):(()=>{const g={dataset:{source:c.sensoryResponses},grid:{top:24,right:16,bottom:32,left:40},xAxis:{type:"category",name:"Type",nameGap:24},yAxis:{type:"value",name:"Count",nameGap:28,minInterval:1},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{top:0},series:[{type:"bar",name:"Seeking",encode:{x:"type",y:"seeking"},itemStyle:{color:"#10B981"}},{type:"bar",name:"Avoiding",encode:{x:"type",y:"avoiding"},itemStyle:{color:"#EF4444"}},{type:"bar",name:"Neutral",encode:{x:"type",y:"neutral"},itemStyle:{color:"#6B7280"}}]};return e.jsx(me,{option:g,height:250,"aria-label":"Sensory response patterns stacked bars",exportRegistration:{id:"sensory-responses",type:"distribution",title:"Sensory Response Patterns"}})})()})})]})]})]})},(t,s)=>t.studentName===s.studentName&&t.selectedRange===s.selectedRange&&t.showTimeFilter===s.showTimeFilter&&t.emotions.length===s.emotions.length&&t.sensoryInputs.length===s.sensoryInputs.length&&(t.emotions.length===0||t.emotions[0]?.timestamp===s.emotions[0]?.timestamp)&&(t.sensoryInputs.length===0||t.sensoryInputs[0]?.timestamp===s.sensoryInputs[0]?.timestamp));nn.displayName="OptimizedDataVisualization";const rn=d.memo(({student:t,onView:s,onTrack:a})=>{const o=r=>r.split(" ").map(c=>c[0]).join("").toUpperCase();return e.jsx(D,{className:"overflow-hidden hover:shadow-lg transition-shadow duration-200",children:e.jsxs(T,{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx("span",{className:"text-primary font-semibold",children:o(t.name)})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-foreground",children:t.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Grade ",t.grade]})]})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(M,{variant:"default",size:"sm",onClick:()=>s(t),className:"flex-1",children:[e.jsx(fs,{className:"h-4 w-4 mr-2"}),"View Profile"]}),e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>a(t),className:"flex-1",children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),"Track"]})]})]})})},(t,s)=>t.student.id===s.student.id&&t.student.name===s.student.name&&t.student.grade===s.student.grade&&t.onView===s.onView&&t.onTrack===s.onTrack);rn.displayName="OptimizedStudentCard";const on=({student:t,goals:s})=>{const[a,o]=d.useState("month"),[r,c]=d.useState(!1),x=d.useMemo(()=>{const u=s.filter(p=>p.status==="active"),i=s.filter(p=>p.status==="achieved"),f=s.length>0?s.reduce((p,m)=>p+m.currentProgress,0)/s.length:0,k=u.filter(p=>{const m=ne(p.targetDate,new Date),y=m>0?Math.max(0,100-m/ne(p.targetDate,p.createdDate)*100):100;return p.currentProgress>=y*.8}),N=u.filter(p=>{const m=ne(p.targetDate,new Date),y=m>0?Math.max(0,100-m/ne(p.targetDate,p.createdDate)*100):100;return p.currentProgress<y*.6});return{totalGoals:s.length,activeGoals:u.length,achievedGoals:i.length,overallProgress:f,onTrackGoals:k.length,atRiskGoals:N.length}},[s]),g=d.useMemo(()=>{const u=[];s.forEach(m=>{m.dataPoints.forEach(y=>{u.push({date:y.timestamp,goalId:m.id,goalTitle:m.title,value:y.value,category:m.category})})});const i=new Date,f=gs(new Date(i.getFullYear(),i.getMonth()-2,1)),k=hs(i);return xs({start:f,end:k}).map(m=>{const y=ps(m),j=u.filter(v=>v.date>=m&&v.date<=y),w=j.length>0?j.reduce((v,b)=>v+b.value,0)/j.length:0;return{week:V(m,"MMM dd"),progress:Math.round(w),dataPoints:j.length}})},[s]);d.useEffect(()=>{c(!0);const u=setTimeout(()=>{c(!1)},300);return()=>{clearTimeout(u),c(!1)}},[s]);const n=d.useMemo(()=>["behavioral","academic","social","sensory","communication"].map(i=>{const f=s.filter(N=>N.category===i),k=f.length>0?f.reduce((N,p)=>N+p.currentProgress,0)/f.length:0;return{category:i.charAt(0).toUpperCase()+i.slice(1),progress:Math.round(k),count:f.length,achieved:f.filter(N=>N.status==="achieved").length}}).filter(i=>i.count>0),[s]),l=u=>{switch(u){case"active":return"text-info";case"achieved":return"text-success";case"modified":return"text-warning";case"discontinued":return"text-destructive";default:return"text-gray-600"}},h=()=>{const u=new Date;return s.filter(i=>i.status==="active").map(i=>({...i,daysUntilTarget:ne(i.targetDate,u),urgencyScore:(100-i.currentProgress)/Math.max(1,ne(i.targetDate,u))})).sort((i,f)=>f.urgencyScore-i.urgencyScore).slice(0,5)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(D,{className:"bg-gradient-card border-0 shadow-soft",children:[e.jsxs(E,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(O,{className:"text-sm font-medium",children:"Total Goals"}),e.jsx(Je,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(T,{children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:e.jsx(be,{value:x.totalGoals})}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[x.activeGoals," active, ",x.achievedGoals," achieved"]})]})]}),e.jsxs(D,{className:"bg-gradient-card border-0 shadow-soft",children:[e.jsxs(E,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(O,{className:"text-sm font-medium",children:"Overall Progress"}),e.jsx(te,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(T,{children:[e.jsxs("div",{className:"text-2xl font-bold text-primary",children:[e.jsx(be,{value:Math.round(x.overallProgress)}),"%"]}),e.jsx(Q,{value:x.overallProgress,className:"mt-2"})]})]}),e.jsxs(D,{className:"bg-gradient-card border-0 shadow-soft",children:[e.jsxs(E,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(O,{className:"text-sm font-medium",children:"On Track"}),e.jsx(Y,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(T,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:e.jsx(be,{value:x.onTrackGoals})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"goals meeting expectations"})]})]}),e.jsxs(D,{className:"bg-gradient-card border-0 shadow-soft",children:[e.jsxs(E,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(O,{className:"text-sm font-medium",children:"At Risk"}),e.jsx(pe,{className:"h-4 w-4 text-red-500"})]}),e.jsxs(T,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:e.jsx(be,{value:x.atRiskGoals})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"goals needing attention"})]})]})]}),e.jsxs(ys,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs(bs,{className:"grid w-full grid-cols-4",children:[e.jsx(Me,{value:"overview",children:"Overview"}),e.jsx(Me,{value:"trends",children:"Trends"}),e.jsx(Me,{value:"categories",children:"Categories"}),e.jsx(Me,{value:"priorities",children:"Priorities"})]}),e.jsxs(Pe,{value:"overview",className:"space-y-4",children:[e.jsxs(D,{className:"bg-gradient-card border-0 shadow-soft",children:[e.jsx(E,{children:e.jsx(O,{children:"Progress Trends (Last 3 Months)"})}),e.jsx(T,{children:r?e.jsx("div",{"aria-label":"Loading trends chart",className:"h-[300px] w-full",children:e.jsx("div",{className:"h-full w-full animate-pulse rounded-md border border-border/50 bg-muted/20"})}):(()=>{const u={dataset:{source:g},grid:{top:24,right:16,bottom:32,left:40},xAxis:{type:"category",name:"Week",nameGap:24},yAxis:{type:"value",name:"Progress (%)",nameGap:28,min:0,max:100},tooltip:{trigger:"axis",axisPointer:{type:"line"},valueFormatter:i=>typeof i=="number"?`${Math.round(i)}%`:String(i)},legend:{show:!1},series:[{type:"line",smooth:!0,showSymbol:!0,symbolSize:6,encode:{x:"week",y:"progress"},lineStyle:{width:2},areaStyle:{opacity:.08}}]};return e.jsx(me,{option:u,height:300,"aria-label":"Progress trends line chart",exportRegistration:{id:"progress-trends",type:"progress",title:"Progress Trends (Last 3 Months)"}})})()})]}),e.jsxs(D,{className:"bg-gradient-card border-0 shadow-soft",children:[e.jsx(E,{children:e.jsx(O,{children:"Recent Goal Updates"})}),e.jsx(T,{children:e.jsx("div",{className:"space-y-3",children:s.filter(u=>u.dataPoints.length>1).sort((u,i)=>{const f=Math.max(...u.dataPoints.map(N=>N.timestamp.getTime()));return Math.max(...i.dataPoints.map(N=>N.timestamp.getTime()))-f}).slice(0,5).map(u=>{const i=u.dataPoints.sort((f,k)=>k.timestamp.getTime()-f.timestamp.getTime())[0];return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:u.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Updated ",V(i.timestamp,"MMM dd, yyyy")]})]}),e.jsx("div",{className:"text-right",children:e.jsxs(I,{variant:"outline",className:l(u.status),children:[Math.round(u.currentProgress),"%"]})})]},u.id)})})})]})]}),e.jsx(Pe,{value:"trends",className:"space-y-4",children:e.jsxs(D,{className:"bg-gradient-card border-0 shadow-soft",children:[e.jsx(E,{children:e.jsx(O,{children:"Goal Completion Trends"})}),e.jsx(T,{children:(()=>{const u={dataset:{source:n},grid:{top:24,right:16,bottom:32,left:40},xAxis:{type:"category",name:"Category",nameGap:24},yAxis:{type:"value",name:"Progress (%)",nameGap:28,min:0,max:100},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},valueFormatter:i=>typeof i=="number"?`${Math.round(i)}%`:String(i)},legend:{show:!1},series:[{type:"bar",encode:{x:"category",y:"progress"},barWidth:"50%",itemStyle:{borderRadius:[4,4,0,0]}}]};return e.jsx(me,{option:u,height:300,"aria-label":"Goal completion by category bar chart",exportRegistration:{id:"goal-completion-by-category",type:"progress",title:"Goal Completion by Category"}})})()})]})}),e.jsx(Pe,{value:"categories",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(D,{className:"bg-gradient-card border-0 shadow-soft",children:[e.jsx(E,{children:e.jsx(O,{children:"Progress by Category"})}),e.jsx(T,{children:(()=>{const u={dataset:{source:n.map(i=>({name:i.category,value:i.progress}))},tooltip:{trigger:"item",valueFormatter:i=>typeof i=="number"?`${Math.round(i)}%`:String(i)},legend:{bottom:0,type:"scroll"},series:[{type:"pie",radius:["50%","70%"],avoidLabelOverlap:!0,label:{show:!0,formatter:"{b}: {c}%"},encode:{itemName:"name",value:"value"}}]};return e.jsx(me,{option:u,height:250,"aria-label":"Progress by category donut chart",exportRegistration:{id:"progress-by-category",type:"progress",title:"Progress by Category"}})})()})]}),e.jsxs(D,{className:"bg-gradient-card border-0 shadow-soft",children:[e.jsx(E,{children:e.jsx(O,{children:"Category Breakdown"})}),e.jsx(T,{children:e.jsx("div",{className:"space-y-4",children:n.map((u,i)=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:u.category}),e.jsxs(I,{variant:"outline",children:[u.count," goals"]})]}),e.jsx(Q,{value:u.progress,className:"h-2"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:[u.progress,"% average progress"]}),e.jsxs("span",{children:[u.achieved," achieved"]})]})]},u.category))})})]})]})}),e.jsx(Pe,{value:"priorities",className:"space-y-4",children:e.jsxs(D,{className:"bg-gradient-card border-0 shadow-soft",children:[e.jsx(E,{children:e.jsx(O,{children:"Priority Goals Requiring Attention"})}),e.jsx(T,{children:e.jsxs("div",{className:"space-y-4",children:[h().map((u,i)=>e.jsxs("div",{className:"p-4 border border-border rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:u.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:u.category})]}),e.jsx("div",{className:"text-right",children:e.jsx(I,{variant:u.daysUntilTarget<30?"destructive":"outline",children:u.daysUntilTarget>0?`${u.daysUntilTarget} days left`:"Overdue"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[Math.round(u.currentProgress),"%"]})]}),e.jsx(Q,{value:u.currentProgress,className:"h-2"})]}),u.daysUntilTarget<0&&e.jsx("div",{className:"p-2 bg-destructive/10 border border-destructive/20 rounded text-sm text-destructive-foreground",children:"⚠️ This goal is past its target date and may need review or extension."}),u.urgencyScore>2&&u.daysUntilTarget>0&&e.jsx("div",{className:"p-2 bg-warning/10 border border-warning/20 rounded text-sm text-warning-foreground",children:"📈 Consider increasing intervention intensity to meet target date."})]},u.id)),h().length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_s,{className:"h-12 w-12 text-success mx-auto mb-2"}),e.jsx("p",{className:"text-lg font-medium text-success-foreground",children:"All goals are on track!"}),e.jsxs("p",{className:"text-muted-foreground",children:["Great work keeping ",t.name,"'s progress moving forward."]})]})]})})]})})]})]})},ln=(t,s,a)=>{const[o,r]=d.useState({start:ae(ve(new Date,29)),end:se(new Date),label:"Last 30 days"}),c=d.useMemo(()=>{const g=t||[],n=s||[],l=a||[];if(g.length===0&&n.length===0&&l.length===0)return{entries:[],emotions:[],sensoryInputs:[]};const{start:h,end:u}=o,i=g.filter(N=>{const p=N.timestamp instanceof Date?N.timestamp:new Date(N.timestamp);return p>=h&&p<=u}),f=n.filter(N=>{const p=N.timestamp instanceof Date?N.timestamp:new Date(N.timestamp);return p>=h&&p<=u}),k=l.filter(N=>{const p=N.timestamp instanceof Date?N.timestamp:new Date(N.timestamp);return p>=h&&p<=u});return{entries:i,emotions:f,sensoryInputs:k}},[t,s,a,o]),x=d.useCallback(g=>{r(g)},[]);return{selectedRange:o,filteredData:c,handleRangeChange:x}};function cn(t,s,a){const o=Ds({maxSize:50,ttl:6e5,enableStats:!1}),r=d.useMemo(()=>{const l={emotions:t?.length??0,sensory:s?.length??0,entries:a?.length??0},h={emotions:t&&t.length?new Date(Math.max(...t.map(u=>new Date(u.timestamp).getTime()))).toISOString():null,sensory:s&&s.length?new Date(Math.max(...s.map(u=>new Date(u.timestamp).getTime()))).toISOString():null,entries:a&&a.length?new Date(Math.max(...a.map(u=>new Date(u.timestamp).getTime()))).toISOString():null};return ks({namespace:"insights-local",input:{counts:l,latest:h},normalizeArrayOrder:!0})},[t,s,a]),c=d.useCallback(async()=>{const l=`insights_${r}`,h=o.get(l);if(h)return h;const[u,i]=await Promise.all([Promise.resolve(Cs.analyzeEmotionPatterns(t)),Promise.resolve(Ve.generatePredictiveInsights(t,s,a,[]))]),f={basic:u,predictive:i,generatedAt:new Date().toISOString()};return o.set(l,f),f},[r,o,t,s,a]),x=d.useCallback(()=>{const l=`correlations_${r}`,h=o.get(l);if(h)return h;if(a.length<10)return null;const u=Ve.generateCorrelationMatrix(a);return o.set(l,u),u},[r,o,a]),g=d.useCallback(()=>{const l=`anomalies_${r}`,h=o.get(l);if(h)return h;const u=Ve.detectAnomalies(t,s,a);return o.set(l,u),u},[r,o,t,s,a]),n=d.useCallback(()=>{o.clear()},[o]);return{getInsights:c,getCorrelationMatrix:x,getAnomalies:g,clearCache:n,cacheStats:o.stats}}const dn=t=>{const[s,a]=d.useState(null),[o,r]=d.useState([]),[c,x]=d.useState([]),[g,n]=d.useState([]),[l,h]=d.useState([]),[u,i]=d.useState(!0),[f,k]=d.useState(null),N=d.useCallback(()=>{if(!t){i(!1),k("No student ID provided.");return}i(!0),k(null);try{const m=q.getStudentById(t);if(m){a(m);const y=q.getEntriesForStudent(t);r(y);const j=y.flatMap(S=>S.emotions),w=y.flatMap(S=>S.sensoryInputs);x(j),n(w);const b=q.getGoals().filter(S=>S.studentId===t);h(b)}else k("Student not found.")}catch(m){k("Failed to load student data."),L.error("Failed to load student data:",m)}finally{i(!1)}},[t]);d.useEffect(()=>{N()},[N]);const p=d.useCallback(()=>{if(t){const y=q.getGoals().filter(j=>j.studentId===t);h(y)}},[t]);return{student:s,trackingEntries:o,allEmotions:c,allSensoryInputs:g,goals:l,isLoading:u,error:f,reloadGoals:p,reloadData:N}},mn={days:30,entriesPerDayRange:[1,3],includeEnvironmental:!0,weekendPatterns:!0},un={Happy:["Joyful","Playful","Proud"],Calm:["Relaxed","Peaceful"],Excited:["Energetic","Anticipating"],Anxious:["Worried","Restless"],Frustrated:["Irritated","Stuck"],Focused:["Engaged","Attentive"],Tired:["Sleepy","Low-energy"],Overwhelmed:["Overstimulated","Flooded"],Content:["Satisfied","At-ease"],Curious:["Interested","Exploring"]},gn=["Visual","Auditory","Tactile","Vestibular","Proprioceptive","Olfactory","Gustatory"],hn={Visual:["Looked closely","Avoided gaze","Tracked movement"],Auditory:["Covered ears","Hummed","Asked to lower volume"],Tactile:["Touched texture","Avoided touch","Squeezed stress ball"],Vestibular:["Rocked in chair","Spun briefly","Sought swinging"],Proprioceptive:["Pushed against wall","Squeezed putty","Carried heavy books"],Olfactory:["Noticed smell","Avoided odor","Sought scented object"],Gustatory:["Chewed gum","Sipped water","Tasted snack"]},Jt=["classroom","playground","lunchroom","hallway","home","therapy","library"],xn=["instruction","transition","free-time","testing","group-work"],Be=(()=>{let t=1337;return{setSeed:a=>{t=a},rand:()=>(t^=t<<13,t^=t>>>17,t^=t<<5,(t>>>0)/4294967295)}})();function G(t,s){const a=$e?Be.rand():Math.random();return Math.floor(a*(s-t+1))+t}function pn(t,s){return($e?Be.rand():Math.random())*(s-t)+t}function ee(t){const s=$e?Be.rand():Math.random();return t[Math.floor(s*t.length)]}function ze(t,s){const[a,o]=s,r=G(a,o),c=[...t],x=[];for(;x.length<r&&c.length>0;){const g=G(0,c.length-1);x.push(c[g]),c.splice(g,1)}return x}function it(t,s,a){return Math.max(s,Math.min(a,t))}function fn(t){const s=new Date(t);s.setHours(9,G(0,59),0,0);const a=new Date(t);a.setHours(13,G(0,59),0,0);const o=new Date(t);return o.setHours(16,G(0,59),0,0),{morning:s,afternoon:a,evening:o}}function jn(t){switch(t){case"morning":return["Calm","Curious","Happy","Focused"];case"afternoon":return["Excited","Anxious","Focused","Frustrated"];case"evening":default:return["Tired","Content","Calm","Overwhelmed"]}}function yn(t,s,a){let o=3;return t==="afternoon"&&(o+=.5),t==="evening"&&(o-=.5),(s==="lunchroom"||s==="playground")&&(o+=.5),a&&(o-=.3),it(Math.round(o+pn(-1,1)),1,5)}function bn(t,s,a){const o=s==="lunchroom"||s==="playground"?G(6,9):s==="library"?G(1,3):G(3,6),r=s==="classroom"?a==="morning"?"natural":"fluorescent":s==="playground"?"sunlight":"mixed",c=s==="classroom"?ee(xn):void 0,x=a,g=["sunny","cloudy","rainy","stormy","snowy"],n=G(18,27);return{timestamp:t,location:s,socialContext:s==="playground"?"peers":s==="home"?"family":"class",roomConditions:{temperature:n,humidity:G(30,60),lighting:r,noiseLevel:o},weather:{condition:ee(g),temperature:n,pressure:G(990,1025)},classroom:c?{activity:c,studentCount:c==="testing"?G(15,20):G(20,30),timeOfDay:x}:void 0}}function vn(t,s,a,o,r){const c=un[a]||[],x=c.length?ee(c):void 0,g=["sudden","gradual","unknown"];return{id:t,studentId:s,emotion:a,subEmotion:x,intensity:r,duration:G(3,20),timestamp:o,triggers:ze(["noise","transition","reward","task-change","peer-interaction","hunger","fatigue"],[0,2]),context:"observed during routine activity",escalationPattern:ee(g)}}function Nn(t,s,a,o,r){const c=ee(hn[a]);return{id:t,studentId:s,sensoryType:a,type:a,input:a,response:c,intensity:r,location:ee(["hands","ears","eyes","whole-body"]),timestamp:o,notes:"auto-generated demo",environment:ee(Jt),context:"session observation",copingStrategies:ze(["deep-breathing","quiet-space","movement-break","fidget-tool","noise-cancelling"],[0,2])}}const wn=async(t,s)=>{try{const a={...mn,...s||{}},o=new Date;if($e){const g=Array.from(t).reduce((n,l)=>n*31+l.charCodeAt(0)|0,0)^o.getFullYear();Be.setSeed(3735928559^g)}const r={id:t,name:t.replace(/^mock_?/,"").split(/[_-]/).map(g=>g.charAt(0).toUpperCase()+g.slice(1)).join(" ")||"Demo Student",dateOfBirth:"2015-01-01",grade:"3",createdAt:o,lastUpdated:o,version:1};q.saveStudent(r);let c=0;for(let g=0;g<a.days;g++){const n=new Date(o.getFullYear(),o.getMonth(),o.getDate());n.setDate(n.getDate()-g);const l=[0,6].includes(n.getDay()),h=fn(n),u=G(a.entriesPerDayRange[0],a.entriesPerDayRange[1]),i=["morning","afternoon","evening"];for(let f=0;f<u;f++){const k=ee(i),N=new Date(h[k]);N.setMinutes(N.getMinutes()+G(-15,15));const p=ee(Jt),m=yn(k,p,a.weekendPatterns&&l),y=jn(k),w=ze(y,[1,2]).map(($,F)=>vn(`${t}_e_${g}_${f}_${F}`,r.id,$,N,it(m+G(-1,1),1,5))),S=ze(gn,[1,2]).map(($,F)=>Nn(`${t}_s_${g}_${f}_${F}`,r.id,$,N,it(m+G(-1,1),1,5))),C=a.includeEnvironmental?bn(N,p,k):void 0,P={id:`${t}_entry_${c++}`,studentId:r.id,timestamp:N,emotions:w,sensoryInputs:S,environmentalData:C,generalNotes:`Observed during ${k} in ${p}`,notes:w.map($=>$.emotion).join(", "),version:1};q.saveTrackingEntry(P)}}const x=q.getEntriesForStudent(t).length;L.info("seedMinimalDemoData: seeded enhanced demo data",{studentId:t,studentName:r.name,entriesCount:x})}catch(a){throw L.error("seedMinimalDemoData: failed to seed demo data",{studentId:t,error:a}),a}},ft="h-screen w-full flex items-center justify-center",jt="flex items-center gap-2",je="text-muted-foreground",Sn="text-destructive",kn="min-h-screen w-full bg-background font-dyslexia flex",Cn="flex-1 overflow-auto relative z-0",Dn="border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 sticky top-0 z-30",Tn="flex h-14 items-center justify-between px-6",yt="flex items-center gap-3",Mn="ghost",Ee="outline",Pn="sm",ye="h-4 w-4 mr-2",In="p-6",_e="space-y-6",Oe="text-2xl font-bold",Rn="text-center py-8 text-muted-foreground",An="h-5 w-5 animate-spin",En="flex flex-wrap gap-3 p-4 bg-gradient-card rounded-lg border-0 shadow-soft",_n=d.memo(Ga),On=d.memo(qa),Fn=d.memo(Xa),Ln=d.memo(en),zn=d.memo(on),$n=d.memo(Ss),Br=()=>{const{studentId:t}=Xt(),s=ot(),{tCommon:a,t:o}=Z(),{student:r,trackingEntries:c,allEmotions:x,allSensoryInputs:g,goals:n,isLoading:l,error:h,reloadGoals:u,reloadData:i}=dn(t),[f,k]=d.useState("dashboard"),N=d.useCallback(_=>{try{L.debug("[UI] Active section change",{from:f,to:_})}catch{}k(_)},[f]),p=d.useRef(!1),[,m]=d.useState(!1),{selectedRange:y,filteredData:j,handleRangeChange:w}=ln(c,x,g),{getInsights:v}=cn(j.emotions,j.sensoryInputs,j.entries),[b,S]=d.useState(null),[C,P]=d.useState(!1);d.useEffect(()=>{(async()=>{if(!t?.startsWith("mock_")||p.current)return;const H=q.getStudents().length>0,A=!!q.getStudentById(t),X=q.getEntriesForStudent(t)||[];if(!H||A&&X.length<8){p.current=!0,m(!0);try{L.info("Auto-seeding minimal demo data for mock route",{studentId:t}),await wn(t),window.dispatchEvent(new CustomEvent("mockDataLoaded")),z.success("Demo data created successfully",{description:"Sample data has been generated for demonstration purposes"}),i&&i()}catch(Zt){L.error("Failed to auto-seed mock data",{error:Zt,studentId:t}),z.error("Failed to create demo data",{description:"Please try loading mock data manually"})}finally{m(!1)}}})()},[t,i]),d.useEffect(()=>{h&&(z.error(h),s("/"))},[h,s]),d.useEffect(()=>{const _=new AbortController,{signal:U}=_;(async()=>{if(!r||j.emotions.length===0&&j.sensoryInputs.length===0&&j.entries.length===0){S(null);return}P(!0);try{const A=await v();U.aborted||S(A)}catch(A){U.aborted||(L.error("Error generating insights",{error:A}),S(null),z.error("Failed to generate insights"))}finally{U.aborted||P(!1)}})();try{if(r)Promise.resolve(Ne.triggerAnalyticsForStudent(r)).then(()=>{}).catch(A=>{L.error("[SAFE] analyticsManager.triggerAnalyticsForStudent failed",{error:A,studentId:r.id})});else if(t)try{Ne.initializeStudentAnalytics(t)}catch(A){L.error("[SAFE] analyticsManager.initializeStudentAnalytics failed",{error:A,studentId:t})}}catch(A){L.error("[SAFE] analyticsManager outer try/catch caught error",{error:A})}return()=>{_.abort()}},[j,v,r,t]);const $=d.useCallback(async _=>{if(r)try{const U=`${r.name.replace(/\s+/g,"_")}_${new Date().toISOString().split("T")[0]}`;let H,A;const X={trackingEntries:j.entries,emotions:j.emotions,sensoryInputs:j.sensoryInputs,goals:n};switch(_){case"pdf":{H=await Ie.generatePDFReport(r,X,{format:"pdf",includeFields:["all"],includeCharts:!0}),A=`${U}_report.html`;break}case"csv":{const Te=Ie.generateCSVExport([r],X,{format:"csv",includeFields:["all"]});H=new Blob([Te],{type:"text/csv"}),A=`${U}_data.csv`;break}case"json":{const Te=Ie.generateJSONExport([r],X,{format:"json",includeFields:["students","trackingEntries","emotions","sensoryInputs","goals"]});H=new Blob([Te],{type:"application/json"}),A=`${U}_data.json`;break}}ht(H,A),z.success(`Data exported successfully as ${_.toUpperCase()}`)}catch(U){L.error("Export error",{error:U});const H=U instanceof Error?U.message:"Please try again.";z.error(`Export failed: ${H}`)}},[r,j,n]),F=d.useCallback(async()=>{if(r)try{const _=Ie.createFullBackup([r],{trackingEntries:c,emotions:x,sensoryInputs:g,goals:n}),U=new Blob([JSON.stringify(_,null,2)],{type:"application/json"}),H=`sensory_tracker_backup_${new Date().toISOString().replace(/[:.]/g,"-")}.json`;ht(U,H),z.success("Backup created successfully")}catch(_){L.error("Backup error",{error:_}),z.error("Backup failed. Please try again.")}},[r,c,x,g,n]);return l?e.jsx("div",{className:ft,children:e.jsxs("div",{className:jt,children:[e.jsx(zs,{className:An}),e.jsx("p",{className:je,children:o("loading_student_data")})]})}):r?e.jsx(Ot,{children:e.jsxs("div",{className:kn,children:[e.jsx(da,{student:r,activeSection:f,onSectionChange:N}),e.jsxs("main",{className:Cn,children:[e.jsx("header",{className:Dn,children:e.jsxs("div",{className:Tn,children:[e.jsxs("div",{className:yt,children:[e.jsx(Lt,{}),e.jsxs(M,{variant:Mn,size:Pn,onClick:()=>s("/"),"aria-label":a("aria.go_back_to_dashboard"),children:[e.jsx(Ps,{className:ye}),String(a("buttons.back"))]})]}),e.jsxs("div",{className:yt,children:[e.jsx(Ms,{}),e.jsx(Ts,{})]})]})}),e.jsx("div",{className:In,children:e.jsxs(le,{children:[f==="dashboard"&&e.jsx(_n,{student:r,trackingEntries:c,filteredData:j,selectedRange:y,onRangeChange:w,insights:b,isLoadingInsights:C}),f==="analytics"&&e.jsx(le,{showToast:!0,children:e.jsx(On,{student:r,trackingEntries:c??[],filteredData:j,insights:b,isLoadingInsights:C})}),f==="goals"&&e.jsxs("div",{className:_e,children:[e.jsxs("div",{children:[e.jsx("h2",{className:Oe,children:o("goals_title")}),e.jsx("p",{className:je,children:o("goals_description",{name:r.name})})]}),e.jsx(Ln,{student:r,onGoalUpdate:u})]}),f==="progress"&&e.jsxs("div",{className:_e,children:[e.jsxs("div",{children:[e.jsx("h2",{className:Oe,children:o("progress_title")}),e.jsx("p",{className:je,children:o("progress_description",{name:r.name})})]}),e.jsx(zn,{student:r,goals:n})]}),f==="reports"&&e.jsxs("div",{className:_e,children:[e.jsxs("div",{children:[e.jsx("h2",{className:Oe,children:o("reports_title")}),e.jsx("p",{className:je,children:o("reports_description",{name:r.name})})]}),e.jsxs("div",{className:En,children:[e.jsxs(M,{variant:Ee,onClick:()=>$("pdf"),children:[e.jsx(Is,{className:ye}),o("export_pdf")]}),e.jsxs(M,{variant:Ee,onClick:()=>$("csv"),children:[e.jsx(K,{className:ye}),o("export_csv")]}),e.jsxs(M,{variant:Ee,onClick:()=>$("json"),children:[e.jsx(Rs,{className:ye}),o("export_json")]}),e.jsxs(M,{variant:Ee,onClick:F,children:[e.jsx(As,{className:ye}),o("create_backup")]})]}),e.jsx(le,{children:e.jsx($n,{student:r,goals:n,trackingEntries:j.entries,emotions:j.emotions,sensoryInputs:j.sensoryInputs})})]}),(f==="search"||f==="templates"||f==="compare")&&e.jsx(Fn,{student:r,trackingEntries:c,emotions:x,sensoryInputs:g,goals:n,activeToolSection:f,onToolSectionChange:k,onSearchResults:()=>{}}),f==="enhanced-tracking"&&e.jsxs("div",{className:_e,children:[e.jsxs("div",{children:[e.jsx("h2",{className:Oe,children:o("enhanced_tracking_title")}),e.jsx("p",{className:je,children:o("enhanced_tracking_description",{name:r.name})})]}),e.jsx("div",{className:Rn,children:e.jsx("p",{children:o("enhanced_tracking_coming_soon")})})]})]})})]})]})}):e.jsx("div",{className:ft,children:e.jsx("div",{className:jt,children:e.jsx("p",{className:Sn,children:o("student_not_found")})})})};export{Br as StudentProfile};
