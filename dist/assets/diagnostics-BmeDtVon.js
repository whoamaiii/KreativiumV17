import{D as u,a as l}from"./analyticsConfig-Di1mAdDI.js";import{l as n}from"./logger-Bi5o39IC.js";function m(a){if(!a||typeof a!="object")return!1;const e=a,t=["patternAnalysis","enhancedAnalysis","timeWindows","alertSensitivity","cache","insights","confidence","healthScore","analytics","taxonomy"];for(const s of t)if(!(s in e))return!1;return!![e.patternAnalysis?.minDataPoints,e.patternAnalysis?.correlationThreshold,e.enhancedAnalysis?.anomalyThreshold,e.cache?.ttl,e.cache?.maxSize,e.insights?.MAX_PATTERNS_TO_SHOW,e.confidence?.WEIGHTS?.EMOTION].every(s=>typeof s=="number"&&Number.isFinite(s))}function f(a){try{if(m(a))return{config:a,meta:{isValid:!0,errors:[]}}}catch{}try{n.error("[analyticsConfigValidation] Invalid analytics configuration detected. Falling back to defaults.")}catch{}return{config:u,meta:{isValid:!1,errors:["invalid-shape-or-values"]}}}function T(){try{const a=l.getConfig();return f(a).config}catch{return u}}class r{static instance;activeTimers=new Set;activeListeners=new Map;diagnosticMode=!1;constructor(){if(typeof window<"u")try{const e=new URLSearchParams(window.location.search).get("diag")==="1",t=(window.localStorage.getItem("diagnostics")||"").toLowerCase()==="on";this.diagnosticMode=!!(e||t)}catch{this.diagnosticMode=!1}this.diagnosticMode&&typeof window<"u"&&"performance"in window&&this.startPerformanceMonitoring()}static getInstance(){return r.instance||(r.instance=new r),r.instance}startPerformanceMonitoring(){setInterval(()=>{if(this.diagnosticMode&&performance.memory){const e=performance.memory,t=(e.usedJSHeapSize/1048576).toFixed(2),i=(e.totalJSHeapSize/1048576).toFixed(2);n.info(`[DIAGNOSTIC] Memory Usage: ${t}MB / ${i}MB`),e.usedJSHeapSize/e.jsHeapSizeLimit>.9&&n.warn("[DIAGNOSTIC] High memory usage detected!",{used:t,limit:(e.jsHeapSizeLimit/1048576).toFixed(2)})}},5e3)}isEnabled(){return this.diagnosticMode}logComponentMount(e){if(!this.diagnosticMode)return;const t={timestamp:new Date,componentName:e,action:"MOUNT",activeTimers:this.activeTimers.size,activeListeners:Array.from(this.activeListeners.values()).reduce((i,s)=>i+s,0)};n.debug("[DIAGNOSTIC] Component Mounted",t)}logComponentUnmount(e){if(!this.diagnosticMode)return;const t={timestamp:new Date,componentName:e,action:"UNMOUNT",activeTimers:this.activeTimers.size,activeListeners:Array.from(this.activeListeners.values()).reduce((i,s)=>i+s,0)};n.debug("[DIAGNOSTIC] Component Unmounted",t)}logUseEffectCleanup(e,t){this.diagnosticMode&&(n.debug("[DIAGNOSTIC] UseEffect Cleanup",{componentName:e,hasCleanup:t,timestamp:new Date}),t||n.warn("[DIAGNOSTIC] Missing cleanup in useEffect!",{componentName:e}))}logWorkerMessage(e,t,i){this.diagnosticMode&&n.debug("[DIAGNOSTIC] Worker Message",{workerName:e,messageType:t,timestamp:new Date,dataSize:i?JSON.stringify(i).length:0})}logWorkerTimeout(e,t){this.diagnosticMode&&n.error("[DIAGNOSTIC] Worker Timeout!",{workerName:e,timeout:t,timestamp:new Date})}trackTimer(e){this.diagnosticMode&&(this.activeTimers.add(e),n.debug("[DIAGNOSTIC] Timer Created",{timerId:e,activeCount:this.activeTimers.size}))}untrackTimer(e){this.diagnosticMode&&(this.activeTimers.delete(e),n.debug("[DIAGNOSTIC] Timer Cleared",{timerId:e,activeCount:this.activeTimers.size}))}trackEventListener(e,t){if(!this.diagnosticMode)return;const i=`${e}-${t}`,s=this.activeListeners.get(i)||0;this.activeListeners.set(i,s+1),n.debug("[DIAGNOSTIC] Event Listener Added",{element:e,event:t,totalListeners:Array.from(this.activeListeners.values()).reduce((o,c)=>o+c,0)})}untrackEventListener(e,t){if(!this.diagnosticMode)return;const i=`${e}-${t}`,s=this.activeListeners.get(i)||0;s>0&&this.activeListeners.set(i,s-1),n.debug("[DIAGNOSTIC] Event Listener Removed",{element:e,event:t,totalListeners:Array.from(this.activeListeners.values()).reduce((o,c)=>o+c,0)})}logAsyncOperation(e,t,i){if(!this.diagnosticMode)return;const s={operationName:e,duration:t,success:i,timestamp:new Date};t>3e3?n.warn("[DIAGNOSTIC] Slow async operation detected!",s):n.debug("[DIAGNOSTIC] Async operation completed",s)}checkForLeaks(){if(!this.diagnosticMode)return;const e={activeTimers:this.activeTimers.size,activeListeners:Array.from(this.activeListeners.values()).reduce((t,i)=>t+i,0),timestamp:new Date};return e.activeTimers>10&&n.warn("[DIAGNOSTIC] Potential timer leak detected!",e),e.activeListeners>50&&n.warn("[DIAGNOSTIC] Potential event listener leak detected!",e),e}setDiagnosticMode(e){this.diagnosticMode=e,n.info(`[DIAGNOSTIC] Diagnostic mode ${e?"enabled":"disabled"}`)}}const d=r.getInstance();if(typeof window<"u"&&d.isEnabled()){const a=window.setTimeout,e=window.clearTimeout;window.setTimeout=function(...t){const i=a.apply(window,t);return d.trackTimer(Number(i)),i},window.clearTimeout=function(t){return d.untrackTimer(Number(t)),e.call(window,t)}}export{d,T as g,f as v};
