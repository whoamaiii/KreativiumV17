import{a as n}from"./vendor-react-BiKKw5Rc.js";function U(k={}){const{maxSize:b=100,ttl:h=300*1e3,enableStats:g=!1,versioning:l=!1}=k,a=n.useRef(new Map),f=n.useRef(new Map),m=n.useRef(Date.now().toString()),T=n.useRef(0),[d,S]=n.useState({hits:0,misses:0,sets:0,evictions:0,invalidations:0}),i=n.useCallback(()=>{T.current+=1},[]),u=n.useCallback(e=>{g&&(S(t=>({...t,[e]:t[e]+1})),i())},[g,i]),v=n.useCallback(e=>Date.now()-e.timestamp>h,[h]),o=n.useCallback((e,t)=>{t.forEach(s=>{const r=f.current.get(s);r&&(r.delete(e),r.size===0&&f.current.delete(s))})},[]),E=n.useCallback((e,t)=>{t.forEach(s=>{f.current.has(s)||f.current.set(s,new Set),f.current.get(s).add(e)})},[]),w=n.useCallback(()=>{let e="",t=Date.now();if(a.current.forEach((s,r)=>{s.timestamp<t&&(t=s.timestamp,e=r)}),e){const s=a.current.get(e);s?.tags&&o(e,s.tags),a.current.delete(e),u("evictions"),i()}},[u,i,o]),z=n.useCallback(e=>{const t=a.current.get(e);if(!t){u("misses");return}if(v(t)){t.tags&&o(e,t.tags),a.current.delete(e),u("misses"),i();return}if(l&&t.version!==m.current){t.tags&&o(e,t.tags),a.current.delete(e),u("misses"),i();return}return t.hits++,t.timestamp=Date.now(),u("hits"),t.data},[v,u,l,o,i]),M=n.useCallback((e,t,s=[])=>{a.current.size>=b&&!a.current.has(e)&&w();const r=a.current.get(e);r?.tags&&o(e,r.tags),a.current.set(e,{data:t,timestamp:Date.now(),hits:0,tags:s,version:l?m.current:void 0}),s.length>0&&E(e,s),u("sets"),i()},[b,w,u,l,o,E,i]),R=n.useCallback(e=>{const t=a.current.get(e);return t?v(t)||l&&t.version!==m.current?(t.tags&&o(e,t.tags),a.current.delete(e),i(),!1):!0:!1},[v,l,o,i]),O=n.useCallback(()=>{a.current.clear(),f.current.clear(),S({hits:0,misses:0,sets:0,evictions:0,invalidations:0}),i()},[i]),y=n.useCallback(e=>{const t=f.current.get(e);if(!t)return 0;let s=0;return t.forEach(r=>{a.current.get(r)&&(a.current.delete(r),s++,u("invalidations"))}),f.current.delete(e),s>0&&i(),s},[u,i]),A=n.useCallback(e=>{let t=0;const s=[];return a.current.forEach((r,c)=>{e.test(c)&&(s.push(c),r.tags&&o(c,r.tags))}),s.forEach(r=>{a.current.delete(r),t++,u("invalidations")}),t>0&&i(),t},[u,o,i]),I=n.useCallback(()=>{l&&(m.current=Date.now().toString())},[l]),P=n.useCallback((e,t)=>{const s=Object.keys(t).sort().map(r=>`${r}:${JSON.stringify(t[r])}`).join(":");return`${e}:${s}`},[]),B=n.useCallback(e=>{const t=c=>{if(c==null)return"null";if(typeof c!="object")return String(c);if(Array.isArray(c))return`[${c.map(t).join(",")}]`;const C=c;return`{${Object.keys(C).sort().map($=>`${$}:${t(C[$])}`).join(",")}}`},s=t(e);let r=0;for(let c=0;c<s.length;c++){const C=s.charCodeAt(c);r=(r<<5)-r+C,r=r&r}return Math.abs(r).toString(36)},[]),p=a.current.size,D=n.useMemo(()=>{const e=d.hits+d.misses;return e>0?d.hits/e*100:0},[d.hits,d.misses]),x=n.useMemo(()=>{if(!g)return;let e=0;return a.current.forEach(t=>{e+=JSON.stringify(t).length*2}),e},[g]),F=n.useCallback(()=>{const e=Date.now(),t=[];a.current.forEach((s,r)=>{(e-s.timestamp>h||l&&s.version!==m.current)&&(t.push(r),s.tags&&o(r,s.tags))}),t.length>0&&(t.forEach(s=>a.current.delete(s)),i())},[h,l,o,i]),J=n.useCallback(()=>({...d,hitRate:D,size:p,memoryUsage:x}),[d,D,p,x]);return{get:z,set:M,has:R,clear:O,cleanup:F,size:p,invalidateByTag:y,invalidateByPattern:A,invalidateVersion:I,createKey:P,getDataFingerprint:B,stats:g?J():null}}export{U as u};
