import{j as e}from"./vendor-ui-BGGfvU-n.js";import{a as o}from"./vendor-react-BiKKw5Rc.js";import{C as ee,O as se,T as k,u as te,H as X,a as ne,V as ie}from"./3d-DUDogAyU.js";import{C as ae,d as oe,e as re,b as le,u as ce,B as de}from"./index-p40y1I9K.js";import{B as me}from"./badge-XQGYYPGp.js";import{S as E,a as M,b as A,c as P,d as h}from"./select-Df25Jq5p.js";import{S as ue,R as xe}from"./slider-BzqSx8sm.js";import{E as he}from"./eye-CGa4_C8K.js";import"./vendor-utils-BNQKEpbf.js";import"./logger-Bi5o39IC.js";import"./i18n-DNqVcHxj.js";import"./check-JkTn6zF0.js";function je(n,i="#ffffff"){try{if(typeof window>"u"||!n)return i;if(!n.includes("var("))return n;const a=document.documentElement,j=getComputedStyle(a),m=n.match(/var\((--[a-zA-Z0-9-_]+)\)/)?.[1];if(!m)return i;const d=j.getPropertyValue(m).trim();return d?/^hsl\(/.test(n)?`hsl(${d})`:`hsl(${d})`:i}catch{return i}}function I(){return je("hsl(var(--foreground))","#ffffff")}function ge(){const[n,i]=o.useState(()=>window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches??!1);return o.useEffect(()=>{const a=window.matchMedia?.("(prefers-reduced-motion: reduce)"),j=d=>{i(d.matches)},c=()=>{document.documentElement.getAttribute("data-reduce-motion")==="true"&&i(!0)};c(),a?.addEventListener?.("change",j);const m=new MutationObserver(()=>{c()});return m.observe(document.documentElement,{attributes:!0,attributeFilter:["data-reduce-motion"]}),()=>{a?.removeEventListener?.("change",j),m.disconnect()}},[]),n}const O=({point:n,onClose:i})=>{const{tAnalytics:a}=ce();return e.jsx(X,{children:e.jsxs("div",{className:"bg-background border rounded-lg shadow-lg p-3 min-w-[200px]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(me,{variant:"outline",className:"capitalize",children:n.category}),e.jsx("button",{onClick:i,className:"text-muted-foreground hover:text-foreground transition-colors motion-reduce:transition-none",children:"Ã—"})]}),e.jsx("p",{className:"font-medium",children:n.label}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1 space-y-1",children:[e.jsxs("p",{children:[a("visualization3d.tooltip.xAxis"),": ",n.x.toFixed(2)]}),e.jsxs("p",{children:[a("visualization3d.tooltip.yAxis"),": ",n.y.toFixed(2)]}),e.jsxs("p",{children:[a("visualization3d.tooltip.zAxis"),": ",n.z.toFixed(2)]}),n.intensity&&e.jsxs("p",{children:[a("visualization3d.tooltip.intensity"),": ",n.intensity]})]})]})})},fe=({position:n,color:i,size:a,point:j,onHover:c,isHighlighted:m,reducedMotion:d=!1})=>{const u=o.useRef(null),[p,x]=o.useState(!1);return te(v=>{if(u.current){const r=p||m?1.5:1;d?u.current.scale.set(r,r,r):(u.current.scale.lerp(new ie(r,r,r),.1),p&&(u.current.rotation.y+=.02))}}),e.jsxs("mesh",{ref:u,position:n,onPointerOver:v=>{v.stopPropagation(),x(!0),c(j)},onPointerOut:v=>{v.stopPropagation(),x(!1),c(null)},children:[e.jsx("sphereGeometry",{args:[a,32,16]}),e.jsx("meshStandardMaterial",{color:i,emissive:i,emissiveIntensity:p||m?.5:.2,metalness:.3,roughness:.4})]})},pe=({xLabel:n,yLabel:i,zLabel:a})=>e.jsxs(e.Fragment,{children:[e.jsx(k,{position:[5+.5,0,0],fontSize:.5,color:I(),anchorX:"left",children:n}),e.jsxs("mesh",{position:[5/2,0,0],rotation:[0,0,Math.PI/2],children:[e.jsx("boxGeometry",{args:[.02,5,.02]}),e.jsx("meshBasicMaterial",{color:"#ff0000"})]}),e.jsx(k,{position:[0,5+.5,0],fontSize:.5,color:I(),anchorX:"center",children:i}),e.jsxs("mesh",{position:[0,5/2,0],children:[e.jsx("boxGeometry",{args:[.02,5,.02]}),e.jsx("meshBasicMaterial",{color:"#00ff00"})]}),e.jsx(k,{position:[0,0,5+.5],fontSize:.5,color:I(),anchorX:"center",children:a}),e.jsxs("mesh",{position:[0,0,5/2],rotation:[Math.PI/2,0,0],children:[e.jsx("boxGeometry",{args:[.02,5,.02]}),e.jsx("meshBasicMaterial",{color:"#0000ff"})]})]}),ve=({onReset:n})=>{const{camera:i}=ne();return e.jsx(X,{fullscreen:!0,children:e.jsx("div",{className:"absolute bottom-4 right-4 flex flex-col gap-2 pointer-events-auto",children:e.jsx(de,{size:"sm",variant:"outline",onClick:()=>{i.position.set(10,10,10),i.lookAt(0,0,0),n()},children:e.jsx(xe,{className:"h-4 w-4"})})})})},Re=({emotions:n,sensoryInputs:i,trackingEntries:a,correlationData:j})=>{const c=ge(),[m,d]=o.useState(null),[u,p]=o.useState(null),[x,v]=o.useState("emotionIntensity"),[r,$]=o.useState("sensoryResponse"),[b,G]=o.useState("time"),[z,Q]=o.useState("category"),[V,Z]=o.useState(.2),[B,Y]=o.useState("all"),D=o.useMemo(()=>{const s=[],N=new Map;a.forEach(t=>{const l=t.timestamp.toISOString(),g=n.filter(f=>Math.abs(f.timestamp.getTime()-t.timestamp.getTime())<36e5),w=i.filter(f=>Math.abs(f.timestamp.getTime()-t.timestamp.getTime())<36e5);N.set(l,{emotions:g,sensory:w,tracking:t})}),N.forEach((t,l)=>{const g=t.emotions.length>0?t.emotions.reduce((C,W)=>C+W.intensity,0)/t.emotions.length:5,w=t.sensory.filter(C=>C.response.includes("seeking")).length,f=t.sensory.filter(C=>C.response.includes("avoiding")).length,R=w-f,T=new Date(l).getTime()/1e3/3600;s.push({id:`tracking-${l}`,x:x==="emotionIntensity"?g:x==="sensoryResponse"?R:x==="time"?T:0,y:r==="emotionIntensity"?g:r==="sensoryResponse"?R:r==="time"?T:0,z:b==="emotionIntensity"?g:b==="sensoryResponse"?R:b==="time"?T:0,label:`Session ${new Date(l).toLocaleDateString()}`,category:"environmental",intensity:g,timestamp:new Date(l),metadata:{emotions:t.emotions.length,sensory:t.sensory.length,avgIntensity:g,sensoryScore:R}})});const S=t=>{const l=Math.min(...t),w=Math.max(...t)-l||1;return t.map(f=>(f-l)/w*10-5)},F=s.map(t=>t.x),L=s.map(t=>t.y),q=s.map(t=>t.z),J=S(F),K=S(L),U=S(q);return s.forEach((t,l)=>{t.x=J[l],t.y=K[l],t.z=U[l]}),s},[n,i,a,x,r,b]),H=o.useMemo(()=>B==="all"?D:D.filter(s=>s.category===B),[D,B]),_=s=>{if(z==="category")switch(s.category){case"emotion":return"#10B981";case"sensory":return"#3B82F6";case"environmental":return"#F59E0B";default:return"#6B7280"}else if(z==="intensity"&&s.intensity)return`hsl(${120-s.intensity/10*120}, 70%, 50%)`;return"#6B7280"},y=[{value:"emotionIntensity",label:"Emotion Intensity"},{value:"sensoryResponse",label:"Sensory Response"},{value:"time",label:"Time"}];return e.jsxs(ae,{className:"w-full",children:[e.jsx(oe,{children:e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5"}),"3D Correlation Visualization"]})}),e.jsxs(le,{children:[e.jsxs("div",{className:"mb-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"X Axis"}),e.jsxs(E,{value:x,onValueChange:v,children:[e.jsx(M,{children:e.jsx(A,{})}),e.jsx(P,{children:y.map(s=>e.jsx(h,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Y Axis"}),e.jsxs(E,{value:r,onValueChange:$,children:[e.jsx(M,{children:e.jsx(A,{})}),e.jsx(P,{children:y.map(s=>e.jsx(h,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Z Axis"}),e.jsxs(E,{value:b,onValueChange:G,children:[e.jsx(M,{children:e.jsx(A,{})}),e.jsx(P,{children:y.map(s=>e.jsx(h,{value:s.value,children:s.label},s.value))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Color By"}),e.jsxs(E,{value:z,onValueChange:Q,children:[e.jsx(M,{children:e.jsx(A,{})}),e.jsxs(P,{children:[e.jsx(h,{value:"category",children:"Category"}),e.jsx(h,{value:"intensity",children:"Intensity"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Filter Category"}),e.jsxs(E,{value:B,onValueChange:Y,children:[e.jsx(M,{children:e.jsx(A,{})}),e.jsxs(P,{children:[e.jsx(h,{value:"all",children:"All"}),e.jsx(h,{value:"emotion",children:"Emotions"}),e.jsx(h,{value:"sensory",children:"Sensory"}),e.jsx(h,{value:"environmental",children:"Environmental"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-1 block",children:["Point Size: ",V.toFixed(2)]}),e.jsx(ue,{value:[V],onValueChange:([s])=>Z(s),min:.1,max:.5,step:.05,className:"mt-2"})]})]})]}),e.jsxs("div",{className:"relative w-full h-[600px] bg-gray-50 rounded-lg overflow-hidden",children:[c&&e.jsx("div",{className:"absolute top-4 right-4 z-10 bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-200 px-3 py-1 rounded-md text-sm",children:"Reduced motion enabled"}),e.jsxs(ee,{camera:{position:[10,10,10],fov:50},className:"w-full h-full",onCreated:({gl:s})=>{const N=s.domElement,S=L=>{L.preventDefault()},F=()=>{};N.addEventListener("webglcontextlost",S,{passive:!1}),N.addEventListener("webglcontextrestored",F)},children:[e.jsx("ambientLight",{intensity:.5}),e.jsx("pointLight",{position:[10,10,10]}),e.jsx("pointLight",{position:[-10,-10,-10],intensity:.5}),e.jsx("gridHelper",{args:[20,20,8947848,13421772]}),e.jsx(pe,{xLabel:y.find(s=>s.value===x)?.label||"",yLabel:y.find(s=>s.value===r)?.label||"",zLabel:y.find(s=>s.value===b)?.label||""}),H.map(s=>e.jsx(fe,{position:[s.x,s.y,s.z],color:_(s),size:V,point:s,onHover:d,isHighlighted:u?.id===s.id,reducedMotion:c},s.id)),m&&!u&&e.jsx(O,{point:m,onClose:()=>d(null)}),u&&e.jsx(O,{point:u,onClose:()=>p(null)}),e.jsx(se,{enableDamping:!c,dampingFactor:c?0:.05,enablePan:!0,panSpeed:.5,rotateSpeed:c?.3:.5,zoomSpeed:.5,minDistance:5,maxDistance:50}),e.jsx(ve,{onReset:()=>{d(null),p(null)}})]}),e.jsxs("div",{className:"absolute top-4 left-4 bg-background/90 backdrop-blur-sm rounded-lg p-3 shadow-lg",children:[e.jsx("h4",{className:"font-medium text-sm mb-2",children:"Legend"}),e.jsxs("div",{className:"space-y-1",children:[z==="category"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-[#10B981]"}),e.jsx("span",{className:"text-xs",children:"Emotions"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-[#3B82F6]"}),e.jsx("span",{className:"text-xs",children:"Sensory"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-[#F59E0B]"}),e.jsx("span",{className:"text-xs",children:"Environmental"})]})]}),z==="intensity"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-20 h-3 bg-gradient-to-r from-green-500 via-yellow-500 to-red-500 rounded"}),e.jsx("span",{className:"text-xs",children:"Low â†’ High"})]})]})]}),e.jsx("div",{className:"absolute bottom-4 left-4 bg-background/90 backdrop-blur-sm rounded-lg p-3 shadow-lg",children:e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("p",{children:["Points: ",H.length]}),e.jsxs("p",{children:["Total Sessions: ",a.length]})]})})]})]})]})};export{Re as Visualization3D};
