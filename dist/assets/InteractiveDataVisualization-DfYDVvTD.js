const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Visualization3D-CRZaWo-N.js","assets/vendor-ui-BGGfvU-n.js","assets/vendor-react-BiKKw5Rc.js","assets/3d-DUDogAyU.js","assets/index-p40y1I9K.js","assets/vendor-utils-BNQKEpbf.js","assets/logger-Bi5o39IC.js","assets/i18n-DNqVcHxj.js","assets/index-uIufv1TD.css","assets/badge-XQGYYPGp.js","assets/select-Df25Jq5p.js","assets/check-JkTn6zF0.js","assets/slider-BzqSx8sm.js","assets/eye-CGa4_C8K.js"])))=>i.map(i=>d[i]);
import{j as e,e as Te,g as ge,h as Ke,c as ys,d as js,P as tt,u as vs,m as nt,ae as at,n as it}from"./vendor-ui-BGGfvU-n.js";import{a as o,d as J}from"./vendor-react-BiKKw5Rc.js";import{c as K,C as Z,d as fe,e as ye,b as q,j as be,B as _,a as X,f as rt,u as Ns,R as ot,P as Fe,T as lt,g as ct,h as dt,i as mt,J as Re,E as ut}from"./index-p40y1I9K.js";import{B as $}from"./badge-XQGYYPGp.js";import{T as Ce}from"./trending-up-B9AG_QY6.js";import{T as Ye,C as ht,F as Ve,b as Ae,P as os,c as ls,d as cs,e as ds,S as xt,f as pt,a as gt,g as ft,h as yt,i as jt}from"./popover-CvKzu0vF.js";import{_ as vt}from"./3d-DUDogAyU.js";import{S as ce}from"./skeleton-Cw78M60-.js";import{E as pe}from"./eye-CGa4_C8K.js";import{R as ws,S as Ne}from"./slider-BzqSx8sm.js";import{l as je}from"./logger-Bi5o39IC.js";import{C as we}from"./clock-3bmf-fze.js";import{C as Nt,D as Me,a as De,b as Pe,c as G,d as ze}from"./dropdown-menu-7gruBPiX.js";import{B as ke}from"./brain-BaLNfPwJ.js";import{C as wt}from"./circle-alert-C4zRNhqb.js";import{n as re,j as Le,f as se,U as ms,V as us,q as hs,l as bt,k as Ct}from"./vendor-utils-BNQKEpbf.js";import{p as xs,e as _e}from"./enhancedPatternAnalysis-BSzs8ls5.js";import{C as St,S as $e,a as He,b as Be,c as Ue,d as Y}from"./select-Df25Jq5p.js";import{C as ie}from"./checkbox-wCMB9JkF.js";import{L as W}from"./label-DPtwVyR_.js";import{S as ps,a as Tt,F as kt,b as Et,c as It,d as Rt}from"./analyticsExport-NqB-BhO_.js";import{T as bs,a as Cs,b as te,c as ne,I as At}from"./tabs-Ctr851dG.js";import{T as Ss}from"./thermometer-D8LnDntt.js";import{S as Mt}from"./save-C79c2pc2.js";import{T as Dt}from"./trash-2-J27CM5os.js";import{A as ae,Z as Ts}from"./zap-DStDXklo.js";import{D as Pt}from"./download-B5AHGw6a.js";import{F as zt}from"./file-text-x8qZG1DU.js";import{b as Lt,a as _t,c as Ot,d as Ft,E as Qe,e as Vt}from"./ChartKit-BStub1tR.js";import{C as $t}from"./chart-column-RudVS-6d.js";import{C as Ht}from"./circle-check-big-DUkzVwRO.js";import{T as Bt}from"./trending-down-8q66-3MU.js";import"./i18n-DNqVcHxj.js";import"./x-CtjkR7Fw.js";import"./check-JkTn6zF0.js";import"./analyticsConfig-Di1mAdDI.js";import"./ml-BTt1mEdE.js";import"./charts-B1guaMDk.js";import"./chartRegistry-BLFZNPaW.js";/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=K("Columns2",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]]);/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=K("Focus",[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]);/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=K("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=K("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=K("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=K("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=K("PictureInPicture2",[["path",{d:"M21 9V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v10c0 1.1.9 2 2 2h4",key:"daa4of"}],["rect",{width:"10",height:"7",x:"12",y:"13",rx:"2",key:"1nb8gs"}]]);/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=K("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=K("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=K("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=K("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),Kt=s=>{if(!s&&s!==0)return e.jsx($,{variant:"outline",children:"n/a"});const n=Math.round(s*100),d=s>=.7?"default":s>=.4?"secondary":"destructive";return e.jsxs($,{variant:d,children:[n,"%"]})},Yt=({student:s,filteredData:n,analysis:d,activePreset:r,onCreateGoal:u,onAddIntervention:i,onScheduleBreak:l,onJumpToTracking:c,className:m=""})=>{const t=n?.entries?.length??0,p=n?.emotions?.length??0,h=t<10||new Set(n.entries.map(N=>N.timestamp.toDateString())).size<7,T=(d.correlationMatrix?.significantPairs||[])[0],k=(d.patterns||[]).sort((N,O)=>(O.confidence??0)-(N.confidence??0))[0],E=(d.anomalies||[])[0];return e.jsxs(Z,{className:`w-full md:w-[360px] lg:w-[400px] bg-card/60 border border-border/60 ${m}`,children:[e.jsx(fe,{children:e.jsxs(ye,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ge,{className:"h-5 w-5"}),"Insights for ",s.name]})}),e.jsxs(q,{className:"space-y-4",children:[r&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["You’re viewing: ",e.jsx("span",{className:"font-medium",children:r.replaceAll("_"," ")})]}),h&&e.jsx("div",{className:"p-3 rounded-lg bg-muted/40 text-sm",children:"Limited data — results may change as more sessions are recorded. Try tracking for at least 7 days and 10 sessions for stronger findings."}),k&&e.jsxs("div",{className:"p-3 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),"Pattern detected"]}),Kt(k.confidence)]}),e.jsx("div",{className:"text-sm mt-1",children:k.description||k.pattern})]}),T&&e.jsxs("div",{className:"p-3 rounded-lg border",children:[e.jsx("div",{className:"font-medium",children:"Correlation"}),e.jsxs("div",{className:"text-sm mt-1",children:[T.factor1," ↔ ",T.factor2]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["r = ",T.correlation.toFixed(2)," (",T.significance,")"]})]}),E&&e.jsxs("div",{className:"p-3 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-2 font-medium",children:[e.jsx(be,{className:"h-4 w-4 text-amber-600"})," Recent Anomaly"]}),e.jsx("div",{className:"text-sm mt-1",children:E.description})]}),e.jsxs("div",{className:"pt-2 grid grid-cols-2 gap-2",children:[e.jsxs(_,{variant:"outline",size:"sm",onClick:u,children:[e.jsx(Ye,{className:"h-4 w-4 mr-1"}),"Create Goal"]}),e.jsx(_,{variant:"outline",size:"sm",onClick:i,children:"Add Intervention"}),e.jsx(_,{variant:"outline",size:"sm",onClick:l,children:"Schedule Break"}),e.jsx(_,{variant:"outline",size:"sm",onClick:c,children:"Track Now"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground pt-2",children:["Data: ",t," sessions, ",p," emotions"]})]})]})},Qt=o.lazy(()=>vt(()=>import("./Visualization3D-CRZaWo-N.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13])).then(s=>({default:s.Visualization3D}))),en=()=>e.jsxs(Z,{className:"w-full",children:[e.jsx(fe,{children:e.jsxs(ye,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-5 w-5"}),"3D Correlation Visualization"]})}),e.jsx(q,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ce,{className:"h-4 w-16"}),e.jsx(ce,{className:"h-10 w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ce,{className:"h-4 w-16"}),e.jsx(ce,{className:"h-10 w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ce,{className:"h-4 w-16"}),e.jsx(ce,{className:"h-10 w-full"})]})]}),e.jsx("div",{className:"relative w-full h-[600px] bg-muted/50 rounded-lg overflow-hidden flex items-center justify-center",role:"status","aria-live":"polite",children:e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-primary border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading 3D visualization..."})]})})]})})]}),sn=s=>e.jsx(o.Suspense,{fallback:e.jsx(en,{}),children:e.jsx(Qt,{...s})});var tn="Toggle",ks=o.forwardRef((s,n)=>{const{pressed:d,defaultPressed:r=!1,onPressedChange:u,...i}=s,[l=!1,c]=Te({prop:d,onChange:u,defaultProp:r});return e.jsx(ge.button,{type:"button","aria-pressed":l,"data-state":l?"on":"off","data-disabled":s.disabled?"":void 0,...i,ref:n,onClick:Ke(s.onClick,()=>{s.disabled||c(!l)})})});ks.displayName=tn;var Es=ks;const nn=rt("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3",sm:"h-9 px-2.5",lg:"h-11 px-5"}},defaultVariants:{variant:"default",size:"default"}}),xe=o.forwardRef(({className:s,variant:n,size:d,...r},u)=>e.jsx(Es,{ref:u,className:X(nn({variant:n,size:d,className:s})),...r}));xe.displayName=Es.displayName;const an=({emotions:s,sensoryInputs:n,trackingEntries:d,anomalies:r=[],onTimeRangeChange:u,realtime:i=!1})=>{const l=o.useRef(null),c=o.useRef(null),[m,t]=o.useState({width:800,height:400}),[p,h]=o.useState(()=>{const g=new Date;return[re(g,7),g]}),[v,T]=o.useState(1),[k,E]=o.useState(0),[N,O]=o.useState(null),[C,f]=o.useState(!1),[x,b]=o.useState(1),[D,V]=o.useState(null),[a,w]=o.useState(!1),A=o.useRef(null),[S,y]=o.useState({emotions:!0,sensory:!0,anomalies:!0});o.useEffect(()=>{let g=null;const j=()=>{if(c.current){const{width:R,height:I}=c.current.getBoundingClientRect();t({width:R-40,height:I-200})}},M=()=>{g&&clearTimeout(g),g=setTimeout(j,100)};return j(),window.addEventListener("resize",M,{passive:!0}),()=>{window.removeEventListener("resize",M),g&&clearTimeout(g)}},[]);const L=o.useMemo(()=>{const g=[];return S.emotions&&s.forEach((j,M)=>{g.push({id:`emotion-${M}`,timestamp:j.timestamp,type:"emotion",label:j.emotion,value:j.intensity,color:"#10B981",metadata:{intensity:j.intensity,triggers:j.triggers?.join(", ")||"None"}})}),S.sensory&&n.forEach((j,M)=>{g.push({id:`sensory-${M}`,timestamp:j.timestamp,type:"sensory",label:`${j.sensoryType}: ${j.response}`,color:"#3B82F6",metadata:{type:j.sensoryType,response:j.response}})}),S.anomalies&&r.forEach((j,M)=>{g.push({id:`anomaly-${M}`,timestamp:j.timestamp,type:"anomaly",label:j.type,color:j.severity==="high"?"#EF4444":j.severity==="medium"?"#F59E0B":"#FCD34D"})}),g.filter(j=>Le(j.timestamp,{start:p[0],end:p[1]}))},[s,n,r,p,S]),P=o.useMemo(()=>{const g=[],j=s.filter(I=>Le(I.timestamp,{start:p[0],end:p[1]})).map(I=>({timestamp:I.timestamp,value:I.intensity})).sort((I,z)=>I.timestamp.getTime()-z.timestamp.getTime());j.length>0&&g.push({id:"emotion-intensity",label:"Emotion Intensity",color:"#10B981",data:j,visible:S.emotions,yScale:[0,10]});const M=new Map;n.filter(I=>Le(I.timestamp,{start:p[0],end:p[1]})).forEach(I=>{const z=se(I.timestamp,"yyyy-MM-dd HH:00");M.has(z)||M.set(z,{seeking:0,avoiding:0,neutral:0});const F=M.get(z);if(!F){je.warn("Unexpected missing hour data",{hourKey:z});return}I.response?.includes("seeking")?F.seeking++:I.response?.includes("avoiding")?F.avoiding++:F.neutral++});const R=Array.from(M.entries()).map(([I,z])=>({timestamp:new Date(I),value:z.seeking-z.avoiding})).sort((I,z)=>I.timestamp.getTime()-z.timestamp.getTime());if(R.length>0){const I=Math.min(...R.map(F=>F.value)),z=Math.max(...R.map(F=>F.value));g.push({id:"sensory-response",label:"Sensory Response (Seeking - Avoiding)",color:"#3B82F6",data:R,visible:S.sensory,yScale:[I-1,z+1]})}return g},[s,n,p,S]),H=o.useCallback(g=>{const j=p[1].getTime()-p[0].getTime();return(g.getTime()-p[0].getTime())/j*m.width*v+k},[p,m.width,v,k]),B=o.useCallback(g=>{const j=(g-k)/v,M=p[1].getTime()-p[0].getTime(),R=j/m.width*M;return new Date(p[0].getTime()+R)},[p,m.width,v,k]),ee=g=>{const j=Math.max(.5,Math.min(10,v+g));T(j)},U=g=>{E(j=>j+g)},oe=o.useCallback(g=>{if(!l.current)return;const j=l.current.getBoundingClientRect(),M=g.clientX-j.left,R=B(M);A.current=R,w(!0)},[B]);o.useEffect(()=>{if(!a||!A.current||!l.current)return;const g=l.current.getBoundingClientRect(),j=A.current,M=I=>{const z=I.clientX-g.left,F=B(z);O([j<F?j:F,j<F?F:j])},R=()=>{N&&u&&u(N[0],N[1]),w(!1),A.current=null};return document.addEventListener("mousemove",M),document.addEventListener("mouseup",R),()=>{document.removeEventListener("mousemove",M),document.removeEventListener("mouseup",R)}},[a,N,u,B]),o.useEffect(()=>{if(!C)return;const g=setInterval(()=>{h(j=>{const R=(j[1].getTime()-j[0].getTime())/100*x;return[new Date(j[0].getTime()+R),new Date(j[1].getTime()+R)]})},100);return()=>clearInterval(g)},[C,x]),o.useEffect(()=>{if(!i)return;const g=setInterval(()=>{const j=new Date;h(M=>{const R=M[1].getTime()-M[0].getTime();return[new Date(j.getTime()-R),j]})},5e3);return()=>clearInterval(g)},[i]);const Js=()=>{const g=[],j=[],M=p[0].getTime(),R=p[1].getTime(),I=R-M;let z,F;I<36e5?(z=3e5,F="HH:mm"):I<864e5?(z=36e5,F="HH:mm"):I<6048e5?(z=864e5,F="MMM dd"):(z=6048e5,F="MMM dd");for(let le=M;le<=R;le+=z){const ve=H(new Date(le));ve>=0&&ve<=m.width&&(g.push(e.jsx("line",{x1:ve,y1:0,x2:ve,y2:m.height,stroke:"#e5e7eb",strokeDasharray:"2,2"},`grid-${le}`)),j.push(e.jsx("text",{x:ve,y:m.height-5,textAnchor:"middle",fontSize:"12",fill:"#6b7280",children:se(new Date(le),F)},`label-${le}`)))}return{gridLines:g,labels:j}},Xs=()=>P.filter(g=>g.visible).map(g=>{const j=R=>{const[I,z]=g.yScale,F=(R-I)/(z-I);return m.height*.8-F*(m.height*.6)},M=g.data.map((R,I)=>{const z=H(R.timestamp),F=j(R.value);return`${I===0?"M":"L"} ${z} ${F}`}).join(" ");return e.jsxs("g",{children:[e.jsx("path",{d:M,fill:"none",stroke:g.color,strokeWidth:"2",opacity:"0.8"}),g.data.map((R,I)=>{const z=H(R.timestamp),F=j(R.value);return z>=0&&z<=m.width?e.jsx("circle",{cx:z,cy:F,r:"3",fill:g.color,className:"cursor-pointer hover:r-5",onMouseEnter:()=>V({id:`${g.id}-${I}`,timestamp:R.timestamp,type:"tracking",label:`${g.label}: ${R.value.toFixed(1)}`,value:R.value,color:g.color}),onMouseLeave:()=>V(null)},`${g.id}-${I}`):null})]},g.id)}),Ks=()=>L.map(g=>{const j=H(g.timestamp);return j<0||j>m.width?null:e.jsxs("g",{children:[e.jsx("line",{x1:j,y1:m.height*.2,x2:j,y2:m.height*.8,stroke:g.color,strokeWidth:"1",opacity:"0.3"}),e.jsx("circle",{cx:j,cy:m.height*.2,r:"8",fill:g.color,className:"cursor-pointer",onMouseEnter:()=>V(g),onMouseLeave:()=>V(null)})]},g.id)}),Ys=()=>{if(!N)return null;const g=H(N[0]),j=H(N[1]);return e.jsx("rect",{x:Math.min(g,j),y:0,width:Math.abs(j-g),height:m.height,fill:"hsl(var(--primary))",opacity:"0.1",stroke:"hsl(var(--primary))",strokeWidth:"2",strokeDasharray:"4,2"})},{gridLines:Qs,labels:et}=o.useMemo(Js,[H,m.width,m.height]),st=o.useMemo(Xs,[P,H,m.height]);return e.jsxs(Z,{className:"w-full",children:[e.jsx(fe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ye,{className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-5 w-5"}),"Timeline Visualization"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[i&&e.jsx($,{variant:"default",className:"animate-pulse",children:"Live"}),e.jsx(_,{size:"icon",variant:"ghost","aria-label":"Reset view",title:"Reset view",onClick:()=>{T(1),E(0),O(null)},children:e.jsx(ws,{className:"h-4 w-4"})})]})]})}),e.jsxs(q,{children:[e.jsxs("div",{className:"mb-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{size:"icon",variant:"ghost","aria-label":"Zoom out",title:"Zoom out",onClick:()=>ee(-.5),disabled:v<=.5,children:e.jsx(Xt,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm font-medium w-16 text-center",children:[Math.round(v*100),"%"]}),e.jsx(_,{size:"icon",variant:"ghost","aria-label":"Zoom in",title:"Zoom in",onClick:()=>ee(.5),disabled:v>=10,children:e.jsx(Jt,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{size:"icon",variant:"ghost","aria-label":"Pan left",title:"Pan left",onClick:()=>U(50),children:e.jsx(ht,{className:"h-4 w-4"})}),e.jsx(_,{size:"icon",variant:"ghost","aria-label":"Pan right",title:"Pan right",onClick:()=>U(-50),children:e.jsx(Nt,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{size:"icon",variant:C?"default":"ghost","aria-label":C?"Pause playback":"Start playback",title:C?"Pause playback":"Start playback",onClick:()=>f(!C),children:C?e.jsx(Zt,{className:"h-4 w-4"}):e.jsx(Gt,{className:"h-4 w-4"})}),e.jsx(Ne,{value:[x],onValueChange:([g])=>b(g),min:.25,max:4,step:.25,className:"w-24"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[x,"x"]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[e.jsxs(xe,{size:"sm",pressed:S.emotions,onPressedChange:g=>y(j=>({...j,emotions:g})),children:[e.jsx(ke,{className:"h-4 w-4 mr-1"}),"Emotions"]}),e.jsxs(xe,{size:"sm",pressed:S.sensory,onPressedChange:g=>y(j=>({...j,sensory:g})),children:[e.jsx(pe,{className:"h-4 w-4 mr-1"}),"Sensory"]}),e.jsxs(xe,{size:"sm",pressed:S.anomalies,onPressedChange:g=>y(j=>({...j,anomalies:g})),children:[e.jsx(wt,{className:"h-4 w-4 mr-1"}),"Anomalies"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:se(p[0],"MMM dd, yyyy HH:mm")}),e.jsxs("span",{className:"font-medium",children:[ms(p[1],p[0])," minutes"]}),e.jsx("span",{children:se(p[1],"MMM dd, yyyy HH:mm")})]})]}),e.jsxs("div",{ref:c,className:"relative bg-gray-50 rounded-lg overflow-hidden",children:[e.jsxs("svg",{ref:l,width:m.width,height:m.height,className:"cursor-crosshair",onMouseDown:oe,children:[Qs,st,Ks(),Ys(),et,i&&e.jsx("line",{x1:H(new Date),y1:0,x2:H(new Date),y2:m.height,stroke:"#ef4444",strokeWidth:"2",strokeDasharray:"4,2"})]}),D&&e.jsxs("div",{className:X("absolute bg-background border rounded-lg shadow-lg p-3 pointer-events-none","top-5"),style:{left:`${Math.min(H(D.timestamp),m.width-200)}px`},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:X("w-3 h-3 rounded-full"),style:{backgroundColor:D.color}}),e.jsx("span",{className:"font-medium capitalize",children:D.type})]}),e.jsx("p",{className:"text-sm",children:D.label}),e.jsx("p",{className:"text-xs text-muted-foreground",children:se(D.timestamp,"MMM dd, yyyy HH:mm:ss")}),D.metadata&&e.jsx("div",{className:"mt-1 pt-1 border-t",children:Object.entries(D.metadata).map(([g,j])=>e.jsxs("p",{className:"text-xs text-muted-foreground",children:[g,": ",j]},g))})]}),e.jsxs("div",{className:"absolute bottom-4 left-4 bg-background/90 backdrop-blur-sm rounded-lg p-3 shadow-lg",children:[e.jsx("h4",{className:"font-medium text-sm mb-2",children:"Data Streams"}),e.jsx("div",{className:"space-y-1",children:P.filter(g=>g.visible).map(g=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:X("w-3 h-3 rounded-full"),style:{backgroundColor:g.color}}),e.jsx("span",{className:"text-xs",children:g.label})]},g.id))})]}),e.jsx("div",{className:"absolute top-4 right-4 bg-background/90 backdrop-blur-sm rounded-lg p-3 shadow-lg",children:e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("p",{children:["Events: ",L.length]}),e.jsxs("p",{children:["Zoom: ",Math.round(v*100),"%"]}),N&&e.jsxs("p",{children:["Selection: ",ms(N[1],N[0])," min"]})]})})]})]})]})},rn=(s,n)=>{switch(n.type){case"START_STREAM":return{...s,isLive:!0,connectionStatus:"connecting"};case"STOP_STREAM":return{...s,isLive:!1,connectionStatus:"disconnected"};case"SET_CONNECTION_STATUS":return{...s,connectionStatus:n.payload};case"INSERT_DATA":return{...s,lastUpdate:new Date,newDataCount:s.newDataCount+1,emotions:n.payload.emotion?[...s.emotions,n.payload.emotion].slice(-1e3):s.emotions,sensoryInputs:n.payload.sensory?[...s.sensoryInputs,n.payload.sensory].slice(-1e3):s.sensoryInputs,trackingEntries:n.payload.tracking?[...s.trackingEntries,n.payload.tracking].slice(-1e3):s.trackingEntries};case"SET_HISTORICAL_DATA":return{...s,emotions:[...n.payload.emotions,...s.emotions],sensoryInputs:[...n.payload.sensoryInputs,...s.sensoryInputs],trackingEntries:[...n.payload.trackingEntries,...s.trackingEntries],connectionStatus:s.isLive?"connected":"disconnected"};case"CLEAR_NEW_DATA_INDICATOR":return{...s,newDataCount:0};case"RESET_STATE":return n.payload;default:return s}},We=()=>{const s=["happy","calm","anxious","frustrated","excited","sad"],n=["noise","crowd","task","transition","social"];return{id:`emotion-${Date.now()}-${Math.random()}`,timestamp:new Date,emotion:s[Math.floor(Math.random()*s.length)],intensity:Math.floor(Math.random()*8)+3,triggers:Math.random()>.5?[n[Math.floor(Math.random()*n.length)]]:[],notes:""}},Je=()=>{const s=["visual","auditory","tactile","vestibular","proprioceptive"],n=["seeking","avoiding","neutral"];return{id:`sensory-${Date.now()}-${Math.random()}`,timestamp:new Date,sensoryType:s[Math.floor(Math.random()*s.length)],response:n[Math.floor(Math.random()*n.length)],intensity:Math.floor(Math.random()*8)+3,notes:""}},on=()=>({id:`env-${Date.now()}-${Math.random()}`,timestamp:new Date,location:"classroom",socialContext:Math.random()>.5?"group":"individual",roomConditions:{temperature:20+Math.floor(Math.random()*5),humidity:40+Math.floor(Math.random()*20),lighting:Math.random()>.5?"bright":"dim",noiseLevel:Math.floor(Math.random()*10)},weather:{condition:["sunny","cloudy","rainy"][Math.floor(Math.random()*3)],temperature:15+Math.floor(Math.random()*15)},classroom:{activity:["instruction","transition","free-time"][Math.floor(Math.random()*3)],studentCount:15+Math.floor(Math.random()*10),timeOfDay:"morning"}}),fs=()=>({id:`tracking-${Date.now()}-${Math.random()}`,studentId:"current-student",timestamp:new Date,emotions:[We()],sensoryInputs:[Je()],environmentalData:on(),notes:""}),ln=(s,n)=>{const d=o.useMemo(()=>({emotions:s.emotions,sensoryInputs:s.sensoryInputs,trackingEntries:s.trackingEntries,isLive:!1,lastUpdate:null,connectionStatus:"disconnected",newDataCount:0}),[s]),[r,u]=o.useReducer(rn,d),i=o.useRef(null),l=o.useRef(null),c=o.useRef(new Set),m=5e3,t=o.useMemo(()=>{if(!n.enabled||n.windowSize===0)return r;const f=us(new Date,n.windowSize);return{...r,emotions:r.emotions.filter(x=>x.timestamp>=f),sensoryInputs:r.sensoryInputs.filter(x=>x.timestamp>=f),trackingEntries:r.trackingEntries.filter(x=>x.timestamp>=f)}},[r,n.enabled,n.windowSize]),p=o.useCallback((f,x,b)=>{l.current&&cancelAnimationFrame(l.current);const D=()=>{const V=new Set(c.current);V.add(new Date().getTime());const a=Date.now()-m;V.forEach(w=>{w<a&&V.delete(w)}),c.current=V,u({type:"INSERT_DATA",payload:{emotion:f,sensory:x,tracking:b}})};n.smoothTransitions?l.current=requestAnimationFrame(D):D()},[n.smoothTransitions,m]),h=o.useCallback(()=>{const f=Math.random();f<.4?p(We(),void 0,void 0):f<.7?p(void 0,Je(),void 0):f<.9&&p(void 0,void 0,fs())},[p]),v=o.useRef(null),T=o.useCallback(()=>{u({type:"START_STREAM"}),v.current&&(clearTimeout(v.current),v.current=null),v.current=setTimeout(()=>{u({type:"SET_CONNECTION_STATUS",payload:"connected"}),n.simulateData?(i.current&&clearInterval(i.current),i.current=setInterval(h,n.updateInterval)):je.info("Real-time data connection would be established here"),v.current=null},1e3)},[n.simulateData,n.updateInterval,h]),k=o.useCallback(()=>{v.current&&(clearTimeout(v.current),v.current=null),i.current&&(clearInterval(i.current),i.current=null),l.current&&(cancelAnimationFrame(l.current),l.current=null),u({type:"STOP_STREAM"})},[]),E=o.useCallback(()=>{u({type:"CLEAR_NEW_DATA_INDICATOR"})},[]),N=o.useRef(null),O=o.useCallback(f=>{u({type:"SET_CONNECTION_STATUS",payload:"connecting"}),N.current&&(clearTimeout(N.current),N.current=null),N.current=setTimeout(()=>{const x=new Date,b=[],D=[],V=[];for(let a=0;a<f;a+=5){const w=us(x,a);Math.random()>.3&&b.push({...We(),timestamp:w}),Math.random()>.4&&D.push({...Je(),timestamp:w}),Math.random()>.5&&V.push({...fs(),timestamp:w})}u({type:"SET_HISTORICAL_DATA",payload:{emotions:b.reverse(),sensoryInputs:D.reverse(),trackingEntries:V.reverse()}}),N.current=null},500)},[]),C=o.useCallback(f=>new Date().getTime()-new Date(f).getTime()<m,[m]);return o.useEffect(()=>(n.enabled&&!r.isLive?T():!n.enabled&&r.isLive&&k(),()=>{r.isLive&&k()}),[n.enabled,r.isLive,T,k]),o.useEffect(()=>{let f=null;return r.connectionStatus==="connected"&&Math.random()<.01&&(u({type:"SET_CONNECTION_STATUS",payload:"error"}),f=setTimeout(()=>{r.isLive&&T()},3e3)),()=>{f&&clearTimeout(f)}},[r.connectionStatus,r.isLive,T]),o.useEffect(()=>()=>{v.current&&(clearTimeout(v.current),v.current=null),N.current&&(clearTimeout(N.current),N.current=null),i.current&&(clearInterval(i.current),i.current=null),l.current&&(cancelAnimationFrame(l.current),l.current=null)},[]),{...t,isLive:r.isLive,lastUpdate:r.lastUpdate,connectionStatus:r.connectionStatus,newDataCount:r.newDataCount,startStream:T,stopStream:k,clearNewDataIndicator:E,getHistoricalData:O,isDataLive:C}},cn=s=>{const[n,d]=o.useState("line"),[r,u]=o.useState("30d"),[i,l]=o.useState(s),[c,m]=o.useState("dashboard"),[t,p]=o.useState(null),[h,v]=o.useState(!1),[T,k]=o.useState(!1),[E,N]=o.useState(!1),[O,C]=o.useState(["trends","patterns"]),[f,x]=o.useState({type:null,id:null,relatedIds:[]}),[b,D]=o.useState({dateRange:{start:null,end:null},emotions:{types:[],intensityRange:[0,10],includeTriggers:[],excludeTriggers:[]},sensory:{types:[],responses:[],intensityRange:[0,10]},environmental:{locations:[],activities:[],conditions:{noiseLevel:[0,10],temperature:[15,30],lighting:[]},weather:[],timeOfDay:[]},patterns:{anomaliesOnly:!1,minConfidence:0,patternTypes:[]},realtime:!1}),[V,a]=o.useState("3d"),[w,A]=o.useState("xy"),[S,y]=o.useState(!1),[L,P]=o.useState(null);return{selectedChartType:n,setSelectedChartType:d,selectedTimeRange:r,setSelectedTimeRange:u,selectedEmotions:i,setSelectedEmotions:l,layoutMode:c,setLayoutMode:m,focusedVisualization:t,setFocusedVisualization:p,isFullscreen:h,setIsFullscreen:v,isPictureInPicture:T,setIsPictureInPicture:k,showFilterPanel:E,setShowFilterPanel:N,selectedVisualizations:O,setSelectedVisualizations:C,highlightState:f,setHighlightState:x,filterCriteria:b,setFilterCriteria:D,projectionMode:V,setProjectionMode:a,projectionPlane:w,setProjectionPlane:A,motionSafe:S,setMotionSafe:y,activePreset:L,setActivePreset:P}},dn=[{name:"High Intensity Events",description:"Focus on high-intensity emotions and sensory responses",criteria:{emotions:{types:[],intensityRange:[4,5],includeTriggers:[],excludeTriggers:[]},sensory:{types:[],responses:[],intensityRange:[4,5]}}},{name:"Challenging Environments",description:"Filter for difficult environmental conditions",criteria:{environmental:{locations:[],activities:[],conditions:{noiseLevel:[7,10],temperature:[25,40],lighting:[]},weather:["stormy","rainy"],timeOfDay:[]}}},{name:"Positive Patterns",description:"Show only positive emotions and seeking behaviors",criteria:{emotions:{types:["happy","calm","excited","proud","focused"],intensityRange:[0,10],includeTriggers:[],excludeTriggers:[]},sensory:{types:[],responses:["seeking"],intensityRange:[0,10]}}},{name:"Recent Activity",description:"Last 24 hours of data",criteria:{dateRange:{start:re(new Date,1),end:new Date}}}],Oe=(s,n,d,r,u)=>s.filter(i=>{if(n.dateRange.start||n.dateRange.end){const l=n.dateRange.start?hs(n.dateRange.start):new Date(0),c=n.dateRange.end?bt(hs(n.dateRange.end),1):new Date(864e13),m=i.timestamp;if(!(m>=l&&m<c))return!1}if(d){const l=d(i);if(l&&(n.emotions.types.length>0&&!n.emotions.types.includes(l.emotion)||l.intensity<n.emotions.intensityRange[0]||l.intensity>n.emotions.intensityRange[1]||n.emotions.includeTriggers.length>0&&!l.triggers?.some(c=>n.emotions.includeTriggers.includes(c))||n.emotions.excludeTriggers.length>0&&l.triggers?.some(c=>n.emotions.excludeTriggers.includes(c))))return!1}if(r){const l=r(i);if(l){const c=l.sensoryType||l.type||"";if(n.sensory.types.length>0&&!n.sensory.types.includes(c)||n.sensory.responses.length>0&&!n.sensory.responses.includes(l.response)||l.intensity&&(l.intensity<n.sensory.intensityRange[0]||l.intensity>n.sensory.intensityRange[1]))return!1}}if(u){const l=u(i);if(l&&(n.environmental.locations.length>0&&l.location&&!n.environmental.locations.includes(l.location)||n.environmental.activities.length>0&&l.classroom?.activity&&!n.environmental.activities.includes(l.classroom.activity)||n.environmental.weather.length>0&&l.weather?.condition&&!n.environmental.weather.includes(l.weather.condition)||l.roomConditions?.noiseLevel&&(l.roomConditions.noiseLevel<n.environmental.conditions.noiseLevel[0]||l.roomConditions.noiseLevel>n.environmental.conditions.noiseLevel[1])))return!1}return!0}),de=s=>{if(s.timestamp instanceof Date)return s.timestamp;if(typeof s.timestamp=="string"){const n=new Date(s.timestamp);return isNaN(n.getTime())?null:n}return null},mn=(s,n,d,r,u,i)=>o.useMemo(()=>{try{const c=new Date,m=r==="7d"?re(c,7):r==="30d"?re(c,30):r==="90d"?re(c,90):null;let t=Array.isArray(s)?m?s.filter(f=>{const x=de(f);return x&&x>=m}):s:[],p=Array.isArray(n)?m?n.filter(f=>{const x=de(f);return x&&x>=m}):n:[],h=Array.isArray(d)?m?d.filter(f=>{const x=de(f);return x&&x>=m}):d:[];const v=(f,x,b)=>Array.isArray(x)?x:x&&typeof x=="object"&&Array.isArray(x[b])?x[b]:f,T=Oe(t,u,f=>f,void 0,void 0);t=v(t,T,"emotions");const k=Oe(p,u,void 0,f=>f,void 0);p=v(p,k,"sensoryInputs");const E=Oe(h,u,f=>f?.emotions?.[0]||null,f=>f?.sensoryInputs?.[0]||null,f=>f?.environmentalData||null);if(h=v(h,E,"trackingEntries"),i.type&&i.id){const f=new Set(i.relatedIds);t=t.filter(x=>x?.id===i.id||f.has(x?.id)),p=p.filter(x=>x?.id===i.id||f.has(x?.id)),h=h.filter(x=>x?.id===i.id||f.has(x?.id))}const N=t.map(f=>{const x=de(f);return x?{...f,timestamp:x}:null}).filter(f=>f!==null),O=p.map(f=>{const x=de(f);return x?{...f,timestamp:x}:null}).filter(f=>f!==null),C=h.map(f=>{const x=de(f);return x?{...f,timestamp:x}:null}).filter(f=>f!==null);return{emotions:N,sensoryInputs:O,trackingEntries:C}}catch(c){return je.error("useFilteredData failed",{error:c}),{emotions:[],sensoryInputs:[],trackingEntries:[]}}},[s,n,d,r,u,i]),un=s=>{const[n,d]=o.useState(null),[r,u]=o.useState([]),[i,l]=o.useState([]),[c,m]=o.useState([]),[t,p]=o.useState(!1);return o.useEffect(()=>{(async()=>{if(!(s.emotions.length===0&&s.sensoryInputs.length===0)){p(!0);try{const v=xs.analyzeEmotionPatterns(s.emotions),T=xs.analyzeSensoryPatterns(s.sensoryInputs),k=[...v,...T];if(u(k),s.trackingEntries.length>=5){const E=await _e.generatePredictiveInsights(s.emotions,s.sensoryInputs,s.trackingEntries,[]);l(E);const N=_e.detectAnomalies(s.emotions,s.sensoryInputs,s.trackingEntries);m(N)}if(s.trackingEntries.length>=10){const E=_e.generateCorrelationMatrix(s.trackingEntries);d(E)}}catch(v){je.error("Pattern analysis failed in useDataAnalysis hook",{error:v})}finally{p(!1)}}})()},[s]),{correlationMatrix:n,patterns:r,predictiveInsights:i,anomalies:c,isAnalyzing:t}};var es="Collapsible",[hn,Is]=ys(es),[xn,ss]=hn(es),Rs=o.forwardRef((s,n)=>{const{__scopeCollapsible:d,open:r,defaultOpen:u,disabled:i,onOpenChange:l,...c}=s,[m=!1,t]=Te({prop:r,defaultProp:u,onChange:l});return e.jsx(xn,{scope:d,disabled:i,contentId:js(),open:m,onOpenToggle:o.useCallback(()=>t(p=>!p),[t]),children:e.jsx(ge.div,{"data-state":ns(m),"data-disabled":i?"":void 0,...c,ref:n})})});Rs.displayName=es;var As="CollapsibleTrigger",Ms=o.forwardRef((s,n)=>{const{__scopeCollapsible:d,...r}=s,u=ss(As,d);return e.jsx(ge.button,{type:"button","aria-controls":u.contentId,"aria-expanded":u.open||!1,"data-state":ns(u.open),"data-disabled":u.disabled?"":void 0,disabled:u.disabled,...r,ref:n,onClick:Ke(s.onClick,u.onOpenToggle)})});Ms.displayName=As;var ts="CollapsibleContent",Ds=o.forwardRef((s,n)=>{const{forceMount:d,...r}=s,u=ss(ts,s.__scopeCollapsible);return e.jsx(tt,{present:d||u.open,children:({present:i})=>e.jsx(pn,{...r,ref:n,present:i})})});Ds.displayName=ts;var pn=o.forwardRef((s,n)=>{const{__scopeCollapsible:d,present:r,children:u,...i}=s,l=ss(ts,d),[c,m]=o.useState(r),t=o.useRef(null),p=vs(n,t),h=o.useRef(0),v=h.current,T=o.useRef(0),k=T.current,E=l.open||c,N=o.useRef(E),O=o.useRef();return o.useEffect(()=>{const C=requestAnimationFrame(()=>N.current=!1);return()=>cancelAnimationFrame(C)},[]),nt(()=>{const C=t.current;if(C){O.current=O.current||{transitionDuration:C.style.transitionDuration,animationName:C.style.animationName},C.style.transitionDuration="0s",C.style.animationName="none";const f=C.getBoundingClientRect();h.current=f.height,T.current=f.width,N.current||(C.style.transitionDuration=O.current.transitionDuration,C.style.animationName=O.current.animationName),m(r)}},[l.open,r]),e.jsx(ge.div,{"data-state":ns(l.open),"data-disabled":l.disabled?"":void 0,id:l.contentId,hidden:!E,...i,ref:p,style:{"--radix-collapsible-content-height":v?`${v}px`:void 0,"--radix-collapsible-content-width":k?`${k}px`:void 0,...s.style},children:E&&u})});function ns(s){return s?"open":"closed"}var gn=Rs,fn=Ms,yn=Ds,Q="Accordion",jn=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[as,vn,Nn]=at(Q),[Ee,Ea]=ys(Q,[Nn,Is]),is=Is(),Ps=J.forwardRef((s,n)=>{const{type:d,...r}=s,u=r,i=r;return e.jsx(as.Provider,{scope:s.__scopeAccordion,children:d==="multiple"?e.jsx(Sn,{...i,ref:n}):e.jsx(Cn,{...u,ref:n})})});Ps.displayName=Q;var[zs,wn]=Ee(Q),[Ls,bn]=Ee(Q,{collapsible:!1}),Cn=J.forwardRef((s,n)=>{const{value:d,defaultValue:r,onValueChange:u=()=>{},collapsible:i=!1,...l}=s,[c,m]=Te({prop:d,defaultProp:r,onChange:u});return e.jsx(zs,{scope:s.__scopeAccordion,value:c?[c]:[],onItemOpen:m,onItemClose:J.useCallback(()=>i&&m(""),[i,m]),children:e.jsx(Ls,{scope:s.__scopeAccordion,collapsible:i,children:e.jsx(_s,{...l,ref:n})})})}),Sn=J.forwardRef((s,n)=>{const{value:d,defaultValue:r,onValueChange:u=()=>{},...i}=s,[l=[],c]=Te({prop:d,defaultProp:r,onChange:u}),m=J.useCallback(p=>c((h=[])=>[...h,p]),[c]),t=J.useCallback(p=>c((h=[])=>h.filter(v=>v!==p)),[c]);return e.jsx(zs,{scope:s.__scopeAccordion,value:l,onItemOpen:m,onItemClose:t,children:e.jsx(Ls,{scope:s.__scopeAccordion,collapsible:!0,children:e.jsx(_s,{...i,ref:n})})})}),[Tn,Ie]=Ee(Q),_s=J.forwardRef((s,n)=>{const{__scopeAccordion:d,disabled:r,dir:u,orientation:i="vertical",...l}=s,c=J.useRef(null),m=vs(c,n),t=vn(d),h=it(u)==="ltr",v=Ke(s.onKeyDown,T=>{if(!jn.includes(T.key))return;const k=T.target,E=t().filter(a=>!a.ref.current?.disabled),N=E.findIndex(a=>a.ref.current===k),O=E.length;if(N===-1)return;T.preventDefault();let C=N;const f=0,x=O-1,b=()=>{C=N+1,C>x&&(C=f)},D=()=>{C=N-1,C<f&&(C=x)};switch(T.key){case"Home":C=f;break;case"End":C=x;break;case"ArrowRight":i==="horizontal"&&(h?b():D());break;case"ArrowDown":i==="vertical"&&b();break;case"ArrowLeft":i==="horizontal"&&(h?D():b());break;case"ArrowUp":i==="vertical"&&D();break}const V=C%O;E[V].ref.current?.focus()});return e.jsx(Tn,{scope:d,disabled:r,direction:u,orientation:i,children:e.jsx(as.Slot,{scope:d,children:e.jsx(ge.div,{...l,"data-orientation":i,ref:m,onKeyDown:r?void 0:v})})})}),Se="AccordionItem",[kn,rs]=Ee(Se),Os=J.forwardRef((s,n)=>{const{__scopeAccordion:d,value:r,...u}=s,i=Ie(Se,d),l=wn(Se,d),c=is(d),m=js(),t=r&&l.value.includes(r)||!1,p=i.disabled||s.disabled;return e.jsx(kn,{scope:d,open:t,disabled:p,triggerId:m,children:e.jsx(gn,{"data-orientation":i.orientation,"data-state":Us(t),...c,...u,ref:n,disabled:p,open:t,onOpenChange:h=>{h?l.onItemOpen(r):l.onItemClose(r)}})})});Os.displayName=Se;var Fs="AccordionHeader",Vs=J.forwardRef((s,n)=>{const{__scopeAccordion:d,...r}=s,u=Ie(Q,d),i=rs(Fs,d);return e.jsx(ge.h3,{"data-orientation":u.orientation,"data-state":Us(i.open),"data-disabled":i.disabled?"":void 0,...r,ref:n})});Vs.displayName=Fs;var Xe="AccordionTrigger",$s=J.forwardRef((s,n)=>{const{__scopeAccordion:d,...r}=s,u=Ie(Q,d),i=rs(Xe,d),l=bn(Xe,d),c=is(d);return e.jsx(as.ItemSlot,{scope:d,children:e.jsx(fn,{"aria-disabled":i.open&&!l.collapsible||void 0,"data-orientation":u.orientation,id:i.triggerId,...c,...r,ref:n})})});$s.displayName=Xe;var Hs="AccordionContent",Bs=J.forwardRef((s,n)=>{const{__scopeAccordion:d,...r}=s,u=Ie(Q,d),i=rs(Hs,d),l=is(d);return e.jsx(yn,{role:"region","aria-labelledby":i.triggerId,"data-orientation":u.orientation,...l,...r,ref:n,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...s.style}})});Bs.displayName=Hs;function Us(s){return s?"open":"closed"}var En=Ps,In=Os,Rn=Vs,Zs=$s,qs=Bs;const An=En,me=o.forwardRef(({className:s,...n},d)=>e.jsx(In,{ref:d,className:X("border-b",s),...n}));me.displayName="AccordionItem";const ue=o.forwardRef(({className:s,children:n,...d},r)=>e.jsx(Rn,{className:"flex",children:e.jsxs(Zs,{ref:r,className:X("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",s),...d,children:[n,e.jsx(St,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));ue.displayName=Zs.displayName;const he=o.forwardRef(({className:s,children:n,...d},r)=>e.jsx(qs,{ref:r,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...d,children:e.jsx("div",{className:X("pb-4 pt-0",s),children:n})}));he.displayName=qs.displayName;const Mn=({emotions:s,sensoryInputs:n,trackingEntries:d,onFilterChange:r,savedFilters:u=[],onSaveFilter:i,onDeleteFilter:l})=>{const{tAnalytics:c,tCommon:m}=Ns(),[t,p]=o.useState({dateRange:{start:null,end:null},emotions:{types:[],intensityRange:[0,10],includeTriggers:[],excludeTriggers:[]},sensory:{types:[],responses:[],intensityRange:[0,10]},environmental:{locations:[],activities:[],conditions:{noiseLevel:[0,10],temperature:[15,30],lighting:[]},weather:[],timeOfDay:[]},patterns:{anomaliesOnly:!1,minConfidence:0,patternTypes:[]},realtime:!1}),[h,v]=o.useState(""),[T,k]=o.useState(0),E=[...new Set(s.map(a=>a.emotion))],N=[...new Set(s.flatMap(a=>a.triggers||[]))],O=[...new Set(n.map(a=>a.sensoryType||a.type||"").filter(Boolean))],C=[...new Set(n.map(a=>a.response))],f=[...new Set(d.map(a=>a.environmentalData?.location).filter(Boolean))];o.useEffect(()=>{let a=0;(t.dateRange.start||t.dateRange.end)&&a++,t.emotions.types.length>0&&a++,(t.emotions.intensityRange[0]>0||t.emotions.intensityRange[1]<10)&&a++,t.emotions.includeTriggers.length>0&&a++,t.emotions.excludeTriggers.length>0&&a++,t.sensory.types.length>0&&a++,t.sensory.responses.length>0&&a++,(t.sensory.intensityRange[0]>0||t.sensory.intensityRange[1]<10)&&a++,t.environmental.locations.length>0&&a++,t.environmental.activities.length>0&&a++,t.environmental.weather.length>0&&a++,t.environmental.timeOfDay.length>0&&a++,t.patterns.anomaliesOnly&&a++,t.patterns.minConfidence>0&&a++,t.patterns.patternTypes.length>0&&a++,k(a)},[t]);const x=o.useCallback(a=>{p(w=>({...w,...a,emotions:{...w.emotions,...a.emotions},sensory:{...w.sensory,...a.sensory},environmental:{...w.environmental,...a.environmental,conditions:{...w.environmental.conditions,...a.environmental?.conditions}},patterns:{...w.patterns,...a.patterns}}))},[]),b=o.useCallback(a=>{const w={...t,...a,emotions:{...t.emotions,...a.emotions},sensory:{...t.sensory,...a.sensory},environmental:{...t.environmental,...a.environmental,conditions:{...t.environmental.conditions,...a.environmental?.conditions}},patterns:{...t.patterns,...a.patterns}};p(w),r(w)},[t,r]),D=o.useCallback(()=>{const a={dateRange:{start:null,end:null},emotions:{types:[],intensityRange:[0,10],includeTriggers:[],excludeTriggers:[]},sensory:{types:[],responses:[],intensityRange:[0,10]},environmental:{locations:[],activities:[],conditions:{noiseLevel:[0,10],temperature:[15,30],lighting:[]},weather:[],timeOfDay:[]},patterns:{anomaliesOnly:!1,minConfidence:0,patternTypes:[]},realtime:!1};p(a),r(a)},[r]),V=o.useCallback(()=>{h&&i&&(i(h,t),v(""))},[h,t,i]);return e.jsxs(Z,{className:"w-full",children:[e.jsx(fe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ye,{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"h-5 w-5"}),String(c("filters.title")),T>0&&e.jsxs($,{variant:"default",children:[T," ",String(m("active"))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(_,{size:"sm",variant:"outline",onClick:D,disabled:T===0,children:[e.jsx(ws,{className:"h-4 w-4 mr-1"}),String(m("reset"))]}),t.realtime&&e.jsx($,{variant:"default",className:"animate-pulse",children:String(m("realtime"))})]})]})}),e.jsx(q,{children:e.jsxs(bs,{defaultValue:"filters",className:"w-full",children:[e.jsxs(Cs,{className:"grid w-full grid-cols-3",children:[e.jsx(te,{value:"filters",children:String(m("filters"))}),e.jsx(te,{value:"presets",children:String(m("presets"))}),e.jsxs(te,{value:"saved",children:[String(m("saved"))," (",u.length,")"]})]}),e.jsxs(ne,{value:"filters",className:"space-y-4",children:[e.jsxs(An,{type:"multiple",className:"w-full",children:[e.jsxs(me,{value:"date",children:[e.jsx(ue,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"h-4 w-4"}),String(c("filters.dateRange")),(t.dateRange.start||t.dateRange.end)&&e.jsx($,{variant:"secondary",children:String(m("active"))})]})}),e.jsxs(he,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(W,{children:String(m("startDate"))}),e.jsxs(os,{children:[e.jsx(ls,{asChild:!0,children:e.jsxs(_,{variant:"outline",className:X("w-full justify-start text-left font-normal",!t.dateRange.start&&"text-muted-foreground"),children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"}),t.dateRange.start?se(t.dateRange.start,"PPP"):e.jsx("span",{children:String(m("pickADate"))})]})}),e.jsx(cs,{className:"w-auto p-0",children:e.jsx(ds,{mode:"single",selected:t.dateRange.start||void 0,onSelect:a=>b({dateRange:{...t.dateRange,start:a||null}}),initialFocus:!0})})]})]}),e.jsxs("div",{children:[e.jsx(W,{children:String(m("endDate"))}),e.jsxs(os,{children:[e.jsx(ls,{asChild:!0,children:e.jsxs(_,{variant:"outline",className:X("w-full justify-start text-left font-normal",!t.dateRange.end&&"text-muted-foreground"),children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"}),t.dateRange.end?se(t.dateRange.end,"PPP"):e.jsx("span",{children:String(m("pickADate"))})]})}),e.jsx(cs,{className:"w-auto p-0",children:e.jsx(ds,{mode:"single",selected:t.dateRange.end||void 0,onSelect:a=>b({dateRange:{...t.dateRange,end:a||null}}),initialFocus:!0})})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{size:"sm",variant:"outline",onClick:()=>b({dateRange:{start:re(new Date,7),end:new Date}}),children:String(m("last7Days"))}),e.jsx(_,{size:"sm",variant:"outline",onClick:()=>b({dateRange:{start:re(new Date,30),end:new Date}}),children:String(m("last30Days"))})]})]})]}),e.jsxs(me,{value:"emotions",children:[e.jsx(ue,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-4 w-4"}),String(c("filters.emotions")),(t.emotions.types.length>0||t.emotions.intensityRange[0]>0||t.emotions.intensityRange[1]<10)&&e.jsx($,{variant:"secondary",children:String(m("active"))})]})}),e.jsxs(he,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(W,{children:String(c("filters.emotionTypes"))}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:E.map(a=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ie,{id:a,checked:t.emotions.types.includes(a),onCheckedChange:w=>{const A=w?[...t.emotions.types,a]:t.emotions.types.filter(S=>S!==a);b({emotions:{...t.emotions,types:A}})}}),e.jsx("label",{htmlFor:a,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:a})]},a))})]}),e.jsxs("div",{children:[e.jsxs(W,{children:[String(c("filters.intensityRange")),": ",t.emotions.intensityRange[0]," - ",t.emotions.intensityRange[1]]}),e.jsx(Ne,{value:t.emotions.intensityRange,onValueChange:a=>b({emotions:{...t.emotions,intensityRange:a}}),min:0,max:10,step:1,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(W,{children:String(c("filters.includeTriggers"))}),e.jsxs($e,{value:t.emotions.includeTriggers.join(","),onValueChange:a=>{const w=a?a.split(","):[];b({emotions:{...t.emotions,includeTriggers:w}})},children:[e.jsx(He,{"aria-label":"Select triggers to include",children:e.jsx(Be,{placeholder:"Select triggers to include"})}),e.jsx(Ue,{children:N.map(a=>e.jsx(Y,{value:a,children:a},a))})]})]})]})]}),e.jsxs(me,{value:"sensory",children:[e.jsx(ue,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4"}),String(c("filters.sensory")),(t.sensory.types.length>0||t.sensory.responses.length>0)&&e.jsx($,{variant:"secondary",children:String(m("active"))})]})}),e.jsxs(he,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(W,{children:String(c("filters.sensoryTypes"))}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:O.map(a=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ie,{id:`sensory-${a}`,checked:t.sensory.types.includes(a),onCheckedChange:w=>{const A=w?[...t.sensory.types,a]:t.sensory.types.filter(S=>S!==a);b({sensory:{...t.sensory,types:A}})}}),e.jsx("label",{htmlFor:`sensory-${a}`,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:a})]},a))})]}),e.jsxs("div",{children:[e.jsx(W,{children:String(c("filters.responses"))}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:C.map(a=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ie,{id:`response-${a}`,checked:t.sensory.responses.includes(a),onCheckedChange:w=>{const A=w?[...t.sensory.responses,a]:t.sensory.responses.filter(S=>S!==a);b({sensory:{...t.sensory,responses:A}})}}),e.jsx("label",{htmlFor:`response-${a}`,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:a})]},a))})]}),e.jsxs("div",{children:[e.jsxs(W,{children:[String(c("filters.intensityRange")),": ",t.sensory.intensityRange[0]," - ",t.sensory.intensityRange[1]]}),e.jsx(Ne,{value:t.sensory.intensityRange,onValueChange:a=>b({sensory:{...t.sensory,intensityRange:a}}),min:0,max:10,step:1,className:"mt-2"})]})]})]}),e.jsxs(me,{value:"environmental",children:[e.jsx(ue,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ss,{className:"h-4 w-4"}),String(c("filters.environmental")),(t.environmental.locations.length>0||t.environmental.activities.length>0)&&e.jsx($,{variant:"secondary",children:String(m("active"))})]})}),e.jsxs(he,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(W,{children:String(c("filters.locations"))}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:f.map(a=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ie,{id:`location-${a}`,checked:t.environmental.locations.includes(a),onCheckedChange:w=>{const A=w?[...t.environmental.locations,a]:t.environmental.locations.filter(S=>S!==a);b({environmental:{...t.environmental,locations:A}})}}),e.jsx("label",{htmlFor:`location-${a}`,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:a})]},a))})]}),e.jsxs("div",{children:[e.jsx(W,{children:String(c("filters.weatherConditions"))}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:["sunny","cloudy","rainy","stormy","snowy"].map(a=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ie,{id:`weather-${a}`,checked:t.environmental.weather.includes(a),onCheckedChange:w=>{const A=w?[...t.environmental.weather,a]:t.environmental.weather.filter(S=>S!==a);b({environmental:{...t.environmental,weather:A}})}}),e.jsx("label",{htmlFor:`weather-${a}`,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 capitalize",children:a})]},a))})]}),e.jsxs("div",{children:[e.jsxs(W,{children:[String(c("filters.noiseLevel")),": ",t.environmental.conditions.noiseLevel[0]," - ",t.environmental.conditions.noiseLevel[1]]}),e.jsx(Ne,{value:t.environmental.conditions.noiseLevel,onValueChange:a=>b({environmental:{...t.environmental,conditions:{...t.environmental.conditions,noiseLevel:a}}}),min:0,max:10,step:1,className:"mt-2"})]})]})]}),e.jsxs(me,{value:"patterns",children:[e.jsx(ue,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),String(c("filters.patternsAndAnalysis")),(t.patterns.anomaliesOnly||t.patterns.minConfidence>0)&&e.jsx($,{variant:"secondary",children:String(m("active"))})]})}),e.jsxs(he,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ps,{id:"anomalies",checked:t.patterns.anomaliesOnly,onCheckedChange:a=>b({patterns:{...t.patterns,anomaliesOnly:a}})}),e.jsx(W,{htmlFor:"anomalies",children:String(c("filters.showAnomaliesOnly"))})]}),e.jsxs("div",{children:[e.jsxs(W,{children:[String(c("filters.minimumConfidence")),": ",t.patterns.minConfidence,"%"]}),e.jsx(Ne,{value:[t.patterns.minConfidence],onValueChange:([a])=>b({patterns:{...t.patterns,minConfidence:a}}),min:0,max:100,step:5,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(W,{children:String(c("filters.patternTypes"))}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:["emotion","sensory","environmental","correlation"].map(a=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ie,{id:`pattern-${a}`,checked:t.patterns.patternTypes.includes(a),onCheckedChange:w=>{const A=w?[...t.patterns.patternTypes,a]:t.patterns.patternTypes.filter(S=>S!==a);b({patterns:{...t.patterns,patternTypes:A}})}}),e.jsx("label",{htmlFor:`pattern-${a}`,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 capitalize",children:a})]},a))})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx(W,{htmlFor:"realtime",children:String(c("filters.realtimeUpdates"))})]}),e.jsx(ps,{id:"realtime",checked:t.realtime,onCheckedChange:a=>b({realtime:a})})]})]}),e.jsx(ne,{value:"presets",className:"space-y-4",children:e.jsx("div",{className:"grid gap-4",children:dn.map(a=>e.jsx(Z,{className:"cursor-pointer hover:bg-accent",onClick:()=>x(a.criteria),children:e.jsx(q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.description})]}),e.jsx(_,{size:"sm",variant:"ghost",children:e.jsx(Check,{className:"h-4 w-4"})})]})})},a.name))})}),e.jsxs(ne,{value:"saved",className:"space-y-4",children:[i&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("label",{htmlFor:"saved-filter-name",className:"sr-only",children:String(m("filterName"))}),e.jsx("input",{id:"saved-filter-name",type:"text",placeholder:String(m("filterNamePlaceholder")),"aria-label":"Filter name",value:h,onChange:a=>v(a.target.value),className:"flex-1 px-3 py-2 border rounded-md"}),e.jsxs(_,{"aria-label":String(c("filters.saveCurrentAria")),onClick:V,disabled:!h,children:[e.jsx(Mt,{className:"h-4 w-4 mr-1"}),String(c("filters.saveCurrent"))]})]}),u.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Ve,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:String(c("filters.noSaved"))}),e.jsx("p",{className:"text-sm",children:String(c("filters.saveHint"))})]}):e.jsx("div",{className:"grid gap-4",children:u.map(a=>e.jsx(Z,{children:e.jsx(q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:a.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[Object.keys(a.criteria).filter(w=>JSON.stringify(a.criteria[w])!==JSON.stringify(t[w])).length," ",String(c("filters.configuredSuffix"))]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{size:"sm",variant:"outline",onClick:()=>{p(a.criteria),r(a.criteria)},children:String(m("apply"))}),l&&e.jsx(_,{size:"icon",variant:"ghost","aria-label":"Delete saved filter",title:"Delete saved filter",onClick:()=>l(a.id),children:e.jsx(Dt,{className:"h-4 w-4"})})]})]})})},a.id))})]})]})})]})},Dn=({studentName:s,isExporting:n,availableEmotions:d,filteredData:r,realtimeData:u,visualizationState:i,toggleFullscreen:l,togglePictureInPicture:c,handleExport:m})=>{const{selectedChartType:t,setSelectedChartType:p,selectedTimeRange:h,setSelectedTimeRange:v,selectedEmotions:T,setSelectedEmotions:k,layoutMode:E,setLayoutMode:N,focusedVisualization:O,setFocusedVisualization:C,isFullscreen:f,showFilterPanel:x,setShowFilterPanel:b,selectedVisualizations:D,setSelectedVisualizations:V,setHighlightState:a,filterCriteria:w,setFilterCriteria:A}=i;return typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches&&!i.motionSafe&&(i.setMotionSafe(!0),i.setProjectionMode("2d")),e.jsxs(Z,{children:[e.jsxs(fe,{className:"flex flex-row items-center justify-between",children:[e.jsxs(ye,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5"}),"Interactive Data Analysis - ",s,w.realtime&&e.jsxs($,{variant:"default",className:"animate-pulse ml-2",children:[e.jsx(Wt,{className:"h-3 w-3 mr-1"}),"Live"]})]}),e.jsxs("div",{className:"flex items-center gap-2","aria-label":"Visualization controls",children:[e.jsx("div",{className:"hidden md:flex items-center gap-2 mr-2",children:[{id:"peaks",label:"When do peaks happen?"},{id:"load_by_activity",label:"Which activities raise load?"},{id:"calming",label:"What calms fastest?"}].map(y=>e.jsx(_,{variant:i.activePreset===y.id?"default":"outline",size:"sm",onClick:()=>{i.setActivePreset(y.id),y.id==="peaks"?(v("30d"),p("scatter"),A({...w,patterns:{...w.patterns,minConfidence:.6}}),C("trends")):y.id==="calming"&&(v("7d"),p("line"),C("timeline"))},children:y.label},y.id))}),e.jsxs(xt,{open:x,onOpenChange:b,children:[e.jsx(pt,{asChild:!0,children:e.jsxs(_,{variant:"outline",size:"sm","aria-label":"Open filters panel",title:"Open filters panel",children:[e.jsx(Ve,{className:"h-4 w-4 mr-2"}),"Filters",Object.keys(w).filter(y=>JSON.stringify(w[y])!==JSON.stringify({dateRange:{start:null,end:null},emotions:{types:[],intensityRange:[0,10],includeTriggers:[],excludeTriggers:[]},sensory:{types:[],responses:[],intensityRange:[0,10]},environmental:{locations:[],activities:[],conditions:{noiseLevel:[0,10],temperature:[15,30],lighting:[]},weather:[],timeOfDay:[]},patterns:{anomaliesOnly:!1,minConfidence:0,patternTypes:[]},realtime:!1}[y])).length>0&&e.jsx($,{variant:"default",className:"ml-1",children:"Active"})]})}),e.jsxs(gt,{side:"right",className:"w-[400px] sm:w-[540px]",children:[e.jsxs(ft,{children:[e.jsx(yt,{children:"Advanced Filters"}),e.jsx(jt,{children:"Configure multi-dimensional filters for your data analysis"})]}),e.jsx("div",{className:"mt-6",children:e.jsx(Mn,{emotions:r.emotions,sensoryInputs:r.sensoryInputs,trackingEntries:r.trackingEntries,onFilterChange:A})})]})]}),e.jsxs(Me,{children:[e.jsx(De,{asChild:!0,children:e.jsxs(_,{variant:"outline",size:"sm","aria-label":"Select layout mode",title:"Select layout mode","data-testid":"layout-mode-trigger",children:[E==="grid"&&e.jsx(qe,{className:"h-4 w-4 mr-2"}),E==="focus"&&e.jsx(Ze,{className:"h-4 w-4 mr-2"}),E==="comparison"&&e.jsx(gs,{className:"h-4 w-4 mr-2"}),E==="dashboard"&&e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Layout"]})}),e.jsxs(Pe,{align:"end",children:[e.jsxs(G,{onClick:()=>N("dashboard"),children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Dashboard"]}),e.jsxs(G,{onClick:()=>N("grid"),children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Grid View"]}),e.jsxs(G,{onClick:()=>N("focus"),children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),"Focus Mode"]}),e.jsxs(G,{onClick:()=>N("comparison"),children:[e.jsx(gs,{className:"h-4 w-4 mr-2"}),"Comparison"]})]})]}),e.jsxs(Me,{children:[e.jsx(De,{asChild:!0,children:e.jsxs(_,{variant:"outline",size:"sm","aria-label":"View options",title:"View options",children:[e.jsx(Tt,{className:"h-4 w-4 mr-2"}),"View"]})}),e.jsxs(Pe,{align:"end",children:[e.jsx(G,{onClick:()=>i.setProjectionMode(i.projectionMode==="3d"?"2d":"3d"),children:i.projectionMode==="3d"?"Switch to 2D":"Switch to 3D"}),i.projectionMode==="2d"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{}),e.jsx(G,{onClick:()=>i.setProjectionPlane("xy"),children:"2D: Emotional energy vs Sensory load (XY)"}),e.jsx(G,{onClick:()=>i.setProjectionPlane("xz"),children:"2D: Emotional energy vs Time (XZ)"}),e.jsx(G,{onClick:()=>i.setProjectionPlane("yz"),children:"2D: Sensory load vs Time (YZ)"})]}),e.jsx(ze,{}),e.jsx(G,{onClick:()=>i.setMotionSafe(!i.motionSafe),children:i.motionSafe?"Disable motion-safe":"Enable motion-safe"}),e.jsxs(G,{onClick:l,children:[e.jsx(Ut,{className:"h-4 w-4 mr-2"}),f?"Exit Fullscreen":"Fullscreen"]}),e.jsxs(G,{onClick:c,children:[e.jsx(qt,{className:"h-4 w-4 mr-2"}),"Picture-in-Picture"]}),e.jsx(ze,{}),e.jsxs(G,{onClick:()=>{a({type:null,id:null,relatedIds:[]})},children:[e.jsx(ot,{className:"h-4 w-4 mr-2"}),"Clear Highlights"]})]})]}),e.jsxs(Me,{children:[e.jsx(De,{asChild:!0,children:e.jsxs(_,{variant:"outline",size:"sm",disabled:n,"aria-label":"Export analytics",title:"Export analytics",children:[e.jsx(Pt,{className:"h-4 w-4 mr-2"}),n?"Exporting...":"Export"]})}),e.jsxs(Pe,{align:"end",children:[e.jsxs(G,{onClick:()=>m("pdf"),disabled:n,children:[e.jsx(zt,{className:"h-4 w-4 mr-2"}),"Export as PDF"]}),e.jsxs(G,{onClick:()=>m("csv"),disabled:n,children:[e.jsx(kt,{className:"h-4 w-4 mr-2"}),"Export as CSV"]}),e.jsxs(G,{onClick:()=>m("json"),disabled:n,children:[e.jsx(Et,{className:"h-4 w-4 mr-2"}),"Export as JSON"]})]})]})]})]}),e.jsxs(q,{children:[e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Chart Type"}),e.jsxs($e,{value:t,onValueChange:y=>p(y),children:[e.jsx(He,{className:"w-32",children:e.jsx(Be,{})}),e.jsxs(Ue,{children:[e.jsx(Y,{value:"line",children:"Line Chart"}),e.jsx(Y,{value:"area",children:"Area Chart"}),e.jsx(Y,{value:"scatter",children:"Scatter Plot"}),e.jsx(Y,{value:"composed",children:"Combined"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Select Emotions"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 w-64 p-2 border rounded-md",children:d.map(y=>{const L=T.includes(y);return e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ie,{checked:L,onCheckedChange:P=>{const H=!!P;k(B=>H?[...B,y]:B.filter(ee=>ee!==y))},"aria-label":`Toggle ${y}`}),e.jsx("span",{className:"capitalize",children:y})]},y)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Time Range"}),e.jsxs($e,{value:h,onValueChange:y=>v(y),children:[e.jsx(He,{className:"w-32",children:e.jsx(Be,{})}),e.jsxs(Ue,{children:[e.jsx(Y,{value:"7d",children:"Last 7 days"}),e.jsx(Y,{value:"30d",children:"Last 30 days"}),e.jsx(Y,{value:"90d",children:"Last 90 days"}),e.jsx(Y,{value:"all",children:"All time"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-8","aria-label":"Data counts",children:[e.jsxs($,{variant:"outline",className:"bg-success/10 text-success border-success/20",children:[r.emotions.length," emotions"]}),e.jsxs($,{variant:"outline",className:"bg-info/10 text-info border-info/20",children:[r.sensoryInputs.length," sensory inputs"]}),e.jsxs($,{variant:"outline",className:"bg-primary/10 text-primary border-primary/20",children:[r.trackingEntries.length," sessions"]}),w.realtime&&e.jsxs($,{variant:"default",className:"bg-warning/80 text-warning-foreground",children:[u.newDataCount," new"]})]})]}),E==="focus"&&e.jsx("div",{className:"mt-4 flex gap-2",children:["trends","correlations","patterns","3d","timeline"].map(y=>e.jsx(xe,{size:"sm",pressed:O===y,onPressedChange:()=>C(O===y?null:y),className:"capitalize",children:y==="3d"?"3D View":y},y))}),(E==="grid"||E==="comparison")&&e.jsx("div",{className:"mt-4 flex gap-2",children:["trends","correlations","patterns","3d","timeline"].map(y=>e.jsx(xe,{size:"sm",pressed:D.includes(y),onPressedChange:L=>{V(L?[...D,y]:D.filter(P=>P!==y))},className:"capitalize",children:y==="3d"?"3D View":y},y))})]})]})},Pn=({renderTrendsChart:s,renderCorrelationHeatmap:n,renderPatternAnalysis:d,render3dVisualization:r,renderTimeline:u,filteredData:i,correlationMatrix:l})=>e.jsxs(bs,{defaultValue:"trends",className:"w-full",children:[e.jsxs(Cs,{className:"grid w-full grid-cols-5","aria-label":"Visualization tabs",children:[e.jsxs(te,{value:"trends",className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),"Trends"]}),e.jsxs(te,{value:"correlations",className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"h-4 w-4"}),"Correlations"]}),e.jsxs(te,{value:"patterns",className:"flex items-center gap-2",children:[e.jsx(Ts,{className:"h-4 w-4"}),"Patterns"]}),!Fe&&e.jsxs(te,{value:"3d",className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4"}),"3D View"]}),e.jsxs(te,{value:"timeline",className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),"Timeline"]})]}),e.jsxs(ne,{value:"trends",className:"space-y-6",children:[s(),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(Z,{children:e.jsx(q,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Avg Emotion Intensity"}),e.jsx("p",{className:"text-2xl font-bold",children:i.emotions.length>0?(i.emotions.reduce((c,m)=>c+m.intensity,0)/i.emotions.length).toFixed(1):"0"})]}),e.jsx(ke,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(Z,{children:e.jsx(q,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Positive Emotion Rate"}),e.jsxs("p",{className:"text-2xl font-bold",children:[i.emotions.length>0?Math.round(i.emotions.filter(c=>["happy","calm","focused","excited","proud"].includes(c.emotion.toLowerCase())).length/i.emotions.length*100):0,"%"]})]}),e.jsx(pe,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(Z,{children:e.jsx(q,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Sensory Seeking Rate"}),e.jsxs("p",{className:"text-2xl font-bold",children:[i.sensoryInputs.length>0?Math.round(i.sensoryInputs.filter(c=>c.response?.toLowerCase().includes("seeking")).length/i.sensoryInputs.length*100):0,"%"]})]}),e.jsx(ae,{className:"h-8 w-8 text-muted-foreground"})]})})})]})]}),e.jsxs(ne,{value:"correlations",className:"space-y-6",children:[n(),l&&l.significantPairs.length>0&&e.jsxs(Z,{children:[e.jsx(fe,{children:e.jsx(ye,{children:"Significant Correlations"})}),e.jsx(q,{children:e.jsx("div",{className:"space-y-3",children:l.significantPairs.slice(0,5).map((c,m)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-medium",children:[c.factor1.replace(/([A-Z])/g," $1").replace(/^./,t=>t.toUpperCase())," ↔"," ",c.factor2.replace(/([A-Z])/g," $1").replace(/^./,t=>t.toUpperCase())]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[c.correlation>0?"Positive":"Negative"," correlation (r = ",c.correlation.toFixed(3),")"]})]}),e.jsx($,{variant:c.significance==="high"?"default":"outline",children:c.significance})]},m))})})]})]}),e.jsx(ne,{value:"patterns",className:"space-y-6",children:d()}),!Fe&&e.jsx(ne,{value:"3d",children:r()}),e.jsx(ne,{value:"timeline",children:u()})]}),Gs=({selectedVisualizations:s,renderVisualization:n})=>s.length===0?e.jsx(Z,{className:"col-span-full",children:e.jsx(q,{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(qe,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg",children:"Select visualizations to display"}),e.jsx("p",{className:"text-sm",children:"Choose from the options above"})]})})}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:s.map(d=>e.jsx("div",{children:n(d)},d))}),zn=({focusedVisualization:s,renderVisualization:n})=>s?e.jsx("div",{className:"space-y-6",children:n(s)}):e.jsx(Z,{children:e.jsx(q,{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(Ze,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg",children:"Select a visualization to focus on"}),e.jsx("p",{className:"text-sm",children:"Choose from the options above"})]})})}),Ln=Gs,_n=({chartData:s,selectedChartType:n})=>{try{if(s.length===0)return e.jsx("div",{className:"flex items-center justify-center h-64 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ae,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No data available for selected time range"}),e.jsx("p",{className:"text-xs mt-1",children:"Try expanding the time range or adjusting filters"})]})});const d=s.map(u=>({date:u.date,avgEmotionIntensity:Number(u.avgEmotionIntensity)||0,positiveEmotions:Number(u.positiveEmotions)||0,negativeEmotions:Number(u.negativeEmotions)||0,totalSensoryInputs:Number(u.totalSensoryInputs)||0}));let r;switch(n){case"area":r=Ft(d);break;case"scatter":r=Ot(d);break;case"composed":r=_t(d);break;default:r=Lt(d,{title:"Emotion Trends Over Time",showMovingAverage:!0,movingAverageWindow:7,useDualYAxis:!0,thresholds:{emotion:7,sensory:5}});break}return e.jsx(Qe,{option:r,height:400,exportRegistration:{id:"trends-main",type:"trends",title:"Emotion & Sensory Trends"}})}catch(d){return je.error("TrendsChart.renderChart failed",{error:d}),e.jsx("div",{className:"flex items-center justify-center h-64 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ae,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Could not render chart"}),e.jsx("p",{className:"text-xs mt-1",children:"An internal error occurred while building the chart"})]})})}},On=({correlationMatrix:s,onRetry:n,onShowAllTime:d})=>{if(!s)return e.jsx("div",{className:"flex items-center justify-center h-64 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx($t,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Insufficient data for correlation analysis"}),e.jsx("p",{className:"text-sm",children:"At least 10 tracking entries needed"}),e.jsxs("div",{className:"mt-3 flex items-center justify-center gap-2",children:[e.jsx(_,{size:"sm",variant:"outline","aria-label":"Retry correlation analysis",title:"Retry correlation analysis",onClick:n,children:"Retry"}),e.jsx(_,{size:"sm",variant:"ghost","aria-label":"Show all time range",title:"Show all time range",onClick:d,children:"Show all time"})]})]})});const r=Vt(s);return e.jsx(Qe,{option:r,height:420})},Ws=o.memo(({confidence:s,dataPoints:n=0,timeSpanDays:d=0,rSquared:r=0,className:u=""})=>{const{tAnalytics:i}=Ns(),l=()=>s>=.7?"high":s>=.4?"medium":"low",c=()=>{switch(l()){case"high":return"text-emerald-600";case"medium":return"text-amber-600";case"low":return"text-orange-600"}},m=()=>{const h=[];return n<10&&h.push(String(i("confidence.explanations.insufficientData",{count:n,minimum:10}))),d<14&&h.push(String(i("confidence.explanations.shortTimespan",{days:d,recommended:21}))),r<.3?h.push(String(i("confidence.explanations.weakPattern",{rsquared:r.toFixed(3)}))):r>.7?h.push(String(i("confidence.explanations.strongPattern",{rsquared:r.toFixed(3)}))):r>.4&&h.push(String(i("confidence.explanations.moderatePattern"))),h.length===0&&(s>=.8?h.push(String(i("confidence.explanations.excellentData"))):s>=.6?h.push(String(i("confidence.explanations.reliableInsight"))):s>=.3?h.push(String(i("confidence.explanations.emergingTrend"))):h.push(String(i("confidence.explanations.needMoreData")))),h},t=l(),p=m();return e.jsx(lt,{children:e.jsxs(ct,{children:[e.jsx(dt,{asChild:!0,children:e.jsxs("div",{className:`inline-flex items-center gap-1 cursor-help ${u}`,children:[e.jsxs("span",{className:`text-sm font-medium ${c()}`,children:[Math.round(s*100),"%"]}),e.jsx(At,{className:`h-3 w-3 ${c()}`})]})}),e.jsx(mt,{side:"bottom",className:"max-w-xs",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium",children:String(i(`confidence.${t}`))}),e.jsx("div",{className:"space-y-1",children:p.map(h=>e.jsxs("div",{className:"text-xs text-muted-foreground",children:["• ",h]},h))}),e.jsx("div",{className:"text-xs text-muted-foreground pt-1 border-t border-border",children:String(i("confidence.tooltip"))})]})})]})})});Ws.displayName="ConfidenceIndicator";const Fn=({patterns:s,predictiveInsights:n,anomalies:d,isAnalyzing:r,highlightState:u,handleHighlight:i,filteredData:l})=>{const c=t=>{switch(t.toLowerCase()){case"emotion":return e.jsx(ke,{className:"h-4 w-4"});case"sensory":return e.jsx(pe,{className:"h-4 w-4"});case"environmental":return e.jsx(Ss,{className:"h-4 w-4"});default:return e.jsx(ae,{className:"h-4 w-4"})}},m=t=>t>=.8?"text-success-foreground bg-success border-success/30":t>=.6?"text-warning-foreground bg-warning border-warning/30":"text-destructive-foreground bg-destructive border-destructive/30";return r?e.jsx("div",{"aria-label":"Loading chart data",className:"h-[400px] w-full",children:e.jsx("div",{className:"h-full w-full animate-pulse rounded-md border border-border/50 bg-muted/20"})}):s.length===0&&n.length===0?e.jsx("div",{className:"flex items-center justify-center h-64 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ts,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No patterns detected yet"}),e.jsx("p",{className:"text-sm",children:"Need more data for pattern analysis"})]})}):e.jsxs("div",{className:"space-y-6",children:[s.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(Ye,{className:"h-5 w-5"}),"Detected Patterns (",s.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s.map((t,p)=>e.jsx(Z,{className:X("bg-gradient-card cursor-pointer transition-all",u.type==="emotion"&&t.type==="emotion"&&"ring-2 ring-primary"),onClick:()=>i("emotion",`pattern-${p}`),children:e.jsx(q,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[c(t.type),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"font-medium capitalize",children:[t.type," Pattern"]}),e.jsxs($,{className:m(t.confidence),children:[Math.round(t.confidence*100),"% confident"]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:["Frequency: ",t.frequency," occurrences"]}),(t.recommendations?.length??0)>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"Recommendations:"}),(t.recommendations??[]).slice(0,2).map((h,v)=>e.jsxs("p",{className:"text-xs text-muted-foreground flex items-start gap-1",children:[e.jsx(Ge,{className:"h-3 w-3 mt-0.5 flex-shrink-0"}),h]},v))]})]})]})})},p))})]}),n.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5"}),"Predictive Insights (",n.length,")"]}),e.jsx("div",{className:"space-y-4",children:n.map((t,p)=>e.jsx(Z,{className:"bg-gradient-card",children:e.jsx(q,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:t.severity==="high"?e.jsx(be,{className:"h-5 w-5 text-destructive"}):t.severity==="medium"?e.jsx(we,{className:"h-5 w-5 text-warning"}):e.jsx(Ht,{className:"h-5 w-5 text-success"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium",children:t.title}),e.jsxs($,{variant:"outline",children:[Math.round(t.confidence*100),"% confidence"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:t.description}),t.prediction&&e.jsxs("div",{className:"mb-2",children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Prediction:"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[t.prediction.trend==="increasing"?e.jsx(Ce,{className:"h-4 w-4 text-success"}):t.prediction.trend==="decreasing"?e.jsx(Bt,{className:"h-4 w-4 text-destructive"}):e.jsx(ae,{className:"h-4 w-4 text-info"}),e.jsx("span",{className:"capitalize",children:t.prediction.trend}),e.jsx(Ws,{confidence:t.prediction.accuracy,dataPoints:l.emotions.length+l.sensoryInputs.length,timeSpanDays:l.emotions.length>0&&l.emotions[0]?Math.abs(Ct(new Date,l.emotions[0].timestamp)):0,rSquared:t.prediction.accuracy,className:"ml-1"})]})]}),t.recommendations.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"Recommendations:"}),t.recommendations.slice(0,3).map((h,v)=>e.jsxs("p",{className:"text-xs text-muted-foreground flex items-start gap-1",children:[e.jsx(Ge,{className:"h-3 w-3 mt-0.5 flex-shrink-0"}),h]},v))]}),t.severity&&e.jsx("div",{className:"mt-2 pt-2 border-t border-border",children:e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(It,{className:"h-3 w-3"}),"Severity: ",e.jsx("span",{className:"font-medium capitalize",children:t.severity})]})})]})]})})},p))})]}),d.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5"}),"Detected Anomalies (",d.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:d.map((t,p)=>e.jsx(Z,{className:X("bg-gradient-card border-orange-200 cursor-pointer",u.type==="anomaly"&&u.id===`anomaly-${p}`&&"ring-2 ring-orange-500"),onClick:()=>i("anomaly",`anomaly-${p}`),children:e.jsx(q,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(be,{className:"h-4 w-4 text-orange-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"font-medium mb-1",children:[t.type," Anomaly"]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:["Severity: ",e.jsx("span",{className:"font-medium capitalize",children:t.severity})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:se(t.timestamp,"MMM dd, yyyy")})]})]})})},p))})]})]})},Vn=["happy","calm","focused","excited","proud"],$n=["sad","angry","anxious","frustrated","overwhelmed"],Hn=o.memo(({emotions:s,sensoryInputs:n,trackingEntries:d,studentName:r})=>{const u=o.useRef(null),[i,l]=J.useState(!1),c=o.useMemo(()=>Array.isArray(s)?s:[],[s]),m=o.useMemo(()=>Array.isArray(n)?n:[],[n]),t=o.useMemo(()=>Array.isArray(d)?d:[],[d]),p=o.useMemo(()=>Array.from(new Set(c.map(S=>S.emotion))),[c]),h=cn(p),{layoutMode:v,selectedChartType:T,filterCriteria:k,highlightState:E}=h,N=ln({emotions:c,sensoryInputs:m,trackingEntries:t},{enabled:k.realtime,windowSize:h.selectedTimeRange==="7d"?10080:h.selectedTimeRange==="30d"?720*60:h.selectedTimeRange==="90d"?2160*60:0,updateInterval:1e3,smoothTransitions:!0,simulateData:!0}),O=k.realtime?N.emotions:c,C=k.realtime?N.sensoryInputs:m,f=k.realtime?N.trackingEntries:t,x=mn(O,C,f,h.selectedTimeRange,k,E),b=un(x),D=o.useMemo(()=>{const S=new Map;return x.emotions.forEach(y=>{if(!y?.timestamp)return;const L=y.timestamp.toISOString().split("T")[0];S.has(L)||S.set(L,{date:L,timestamp:y.timestamp,emotionCount:0,avgEmotionIntensity:0,positiveEmotions:0,negativeEmotions:0,sensorySeekingCount:0,sensoryAvoidingCount:0,totalSensoryInputs:0});const P=S.get(L);P.emotionCount++,P.avgEmotionIntensity=(P.avgEmotionIntensity*(P.emotionCount-1)+y.intensity)/P.emotionCount,Vn.includes(y.emotion.toLowerCase())?P.positiveEmotions++:$n.includes(y.emotion.toLowerCase())&&P.negativeEmotions++}),x.sensoryInputs.forEach(y=>{if(!y?.timestamp)return;const L=y.timestamp.toISOString().split("T")[0];S.has(L)||S.set(L,{date:L,timestamp:y.timestamp,emotionCount:0,avgEmotionIntensity:0,positiveEmotions:0,negativeEmotions:0,sensorySeekingCount:0,sensoryAvoidingCount:0,totalSensoryInputs:0});const P=S.get(L);P.totalSensoryInputs++,y.response?.toLowerCase().includes("seeking")?P.sensorySeekingCount++:y.response?.toLowerCase().includes("avoiding")&&P.sensoryAvoidingCount++}),Array.from(S.values()).sort((y,L)=>new Date(y.date).getTime()-new Date(L.date).getTime())},[x]),V=o.useCallback(()=>{document.fullscreenElement?(document.exitFullscreen(),h.setIsFullscreen(!1)):(u.current?.requestFullscreen(),h.setIsFullscreen(!0))},[h]),a=o.useCallback(()=>{h.setIsPictureInPicture(!h.isPictureInPicture),Re(h.isPictureInPicture?"Exited picture-in-picture mode":"Entered picture-in-picture mode")},[h]),w=async S=>{l(!0);try{const y=[...x.emotions.map(U=>U.timestamp),...x.sensoryInputs.map(U=>U.timestamp),...x.trackingEntries.map(U=>U.timestamp)].filter(U=>U);let L=Number.MAX_SAFE_INTEGER,P=Number.MIN_SAFE_INTEGER;for(const U of y){const oe=U.getTime();oe<L&&(L=oe),oe>P&&(P=oe)}const H=y.length>0?{start:new Date(L),end:new Date(P)}:{start:new Date,end:new Date},ee={student:{id:"current-student",name:r,grade:"",createdAt:new Date,baselineData:{emotionalRegulation:{averageIntensity:5,mostCommonEmotion:"neutral",triggerFrequency:{}},sensoryProcessing:{seekingBehaviors:{},avoidingBehaviors:{},preferredSensoryInput:[]},environmentalFactors:{optimalConditions:{},challengingConditions:[]},collectedDate:new Date,collectedBy:"System"}},dateRange:H,data:{entries:x.trackingEntries,emotions:x.emotions,sensoryInputs:x.sensoryInputs},analytics:{patterns:b.patterns,correlations:b.correlationMatrix?.significantPairs.map(U=>({...U,id:crypto.randomUUID(),description:"",recommendations:[]}))||[],insights:b.patterns.map(U=>U.description),predictiveInsights:b.predictiveInsights,anomalies:b.anomalies}};await Rt.exportTo(S,ee),Re.success(`Interactive analytics ${S.toUpperCase()} exported successfully`)}catch(y){je.error("Export failed",{error:y}),Re.error("Failed to export interactive analytics data")}finally{l(!1)}},A=S=>{switch(S){case"trends":if(h.projectionMode==="2d"){const y=h.projectionPlane,L=B=>{B.date;const ee=y==="xy"||y==="xz"?B.avgEmotionIntensity:B.totalSensoryInputs;return{name:B.date,value:[B.timestamp,ee],avgEmotionIntensity:B.avgEmotionIntensity,totalSensoryInputs:B.totalSensoryInputs}},P=D.map(L),H={xAxis:{type:"time"},yAxis:{type:"value",name:y==="yz"?"Sensory load":"Emotional energy"},series:[{type:"scatter",data:P,symbolSize:8}],animation:!h.motionSafe};return e.jsx(Qe,{option:H,height:360})}return e.jsx(_n,{chartData:D,selectedChartType:T});case"correlations":return e.jsx(On,{correlationMatrix:b.correlationMatrix,onRetry:()=>{},onShowAllTime:()=>h.setSelectedTimeRange("all")});case"patterns":return e.jsx(Fn,{...b,highlightState:E,handleHighlight:()=>{},filteredData:x});case"3d":return Fe?null:e.jsx(sn,{emotions:x.emotions,sensoryInputs:x.sensoryInputs,trackingEntries:x.trackingEntries});case"timeline":return e.jsx(an,{emotions:x.emotions,sensoryInputs:x.sensoryInputs,trackingEntries:x.trackingEntries,anomalies:b.anomalies.map(y=>({timestamp:y.timestamp,type:y.type,severity:y.severity})),onTimeRangeChange:(y,L)=>h.setFilterCriteria(P=>({...P,dateRange:{start:y,end:L}})),realtime:k.realtime});default:return null}};return e.jsx(ut,{children:e.jsxs("div",{ref:u,className:"space-y-6",children:[e.jsx(Dn,{studentName:r,isExporting:i,availableEmotions:p,filteredData:x,realtimeData:N,visualizationState:h,toggleFullscreen:V,togglePictureInPicture:a,handleExport:w}),v==="dashboard"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr_380px] gap-4 items-start",children:[e.jsx(Pn,{renderTrendsChart:()=>A("trends"),renderCorrelationHeatmap:()=>A("correlations"),renderPatternAnalysis:()=>A("patterns"),render3dVisualization:()=>A("3d"),renderTimeline:()=>A("timeline"),filteredData:x,correlationMatrix:b.correlationMatrix}),e.jsx(Yt,{student:{id:"current-student",name:r,createdAt:new Date},filteredData:x,analysis:b,activePreset:h.activePreset,onCreateGoal:()=>{},onAddIntervention:()=>{},onScheduleBreak:()=>{},onJumpToTracking:()=>{}})]}),v==="grid"&&e.jsx(Gs,{renderVisualization:A,selectedVisualizations:h.selectedVisualizations}),v==="focus"&&e.jsx(zn,{renderVisualization:A,focusedVisualization:h.focusedVisualization}),v==="comparison"&&e.jsx(Ln,{renderVisualization:A,selectedVisualizations:h.selectedVisualizations})]})})},(s,n)=>s.studentName===n.studentName&&s.emotions.length===n.emotions.length&&s.sensoryInputs.length===n.sensoryInputs.length&&s.trackingEntries.length===n.trackingEntries.length&&(s.emotions.length===0||n.emotions.length===0||s.emotions[0]?.timestamp?.getTime()===n.emotions[0]?.timestamp?.getTime())&&(s.sensoryInputs.length===0||n.sensoryInputs.length===0||s.sensoryInputs[0]?.timestamp?.getTime()===n.sensoryInputs[0]?.timestamp?.getTime())&&(s.trackingEntries.length===0||n.trackingEntries.length===0||s.trackingEntries[0]?.timestamp?.getTime()===n.trackingEntries[0]?.timestamp?.getTime()));Hn.displayName="InteractiveDataVisualization";export{Hn as InteractiveDataVisualization};
