const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ChartsPanel-C17DCFFF.js","assets/3d-DUDogAyU.js","assets/vendor-react-BiKKw5Rc.js","assets/vendor-ui-BGGfvU-n.js","assets/index-p40y1I9K.js","assets/vendor-utils-BNQKEpbf.js","assets/logger-Bi5o39IC.js","assets/i18n-DNqVcHxj.js","assets/index-uIufv1TD.css","assets/PatternsPanel-Cd4ai1uS.js","assets/badge-XQGYYPGp.js","assets/key-CKub7HOD.js","assets/analyticsManager-D5rdgc0M.js","assets/analyticsConfig-Di1mAdDI.js","assets/enhancedPatternAnalysis-BSzs8ls5.js","assets/ml-BTt1mEdE.js","assets/storageUtils-DyonkL-b.js","assets/dataStorage-ZXqbZ8jG.js","assets/clock-3bmf-fze.js","assets/tabs-Ctr851dG.js","assets/trending-up-B9AG_QY6.js","assets/chart-column-RudVS-6d.js","assets/eye-CGa4_C8K.js","assets/brain-BaLNfPwJ.js","assets/dropdown-menu-7gruBPiX.js","assets/check-JkTn6zF0.js","assets/label-DPtwVyR_.js","assets/slider-BzqSx8sm.js","assets/dialog-91XSgeKl.js","assets/x-CtjkR7Fw.js","assets/progress-DZC4VRn8.js","assets/analyticsExport-NqB-BhO_.js","assets/zap-DStDXklo.js","assets/loader-circle-D6K3-BGk.js","assets/download-B5AHGw6a.js","assets/save-C79c2pc2.js","assets/usePerformanceCache-BszGIQAI.js","assets/diagnostics-BmeDtVon.js","assets/file-text-x8qZG1DU.js","assets/CorrelationsPanel-D-7e999k.js","assets/ChartKit-BStub1tR.js","assets/charts-B1guaMDk.js","assets/skeleton-Cw78M60-.js","assets/chartRegistry-BLFZNPaW.js","assets/AlertsPanel-CZe7xz90.js","assets/textarea-2v1IUrdg.js","assets/circle-check-big-DUkzVwRO.js","assets/mockSeeders-DlsGwPCZ.js"])))=>i.map(i=>d[i]);
import{_ as B}from"./3d-DUDogAyU.js";import{o as ze,n as ls,e as cs,j as e,c as Oe,p as ds,g as ke,u as We,I as us,h as be,P as ms,ac as hs,ad as ps}from"./vendor-ui-BGGfvU-n.js";import{a as l,d as ue}from"./vendor-react-BiKKw5Rc.js";import{c as fs,a as Ve,u as Ue,J as E,C as F,d as U,e as G,n as Q,b as z,B as O,R as gs,j as xs,T as ys,g as js,h as vs,i as bs,D as oe,P as Ge,E as ne}from"./index-p40y1I9K.js";import{T as qe,a as Ke,b as ee,c as K,I as Ee}from"./tabs-Ctr851dG.js";import{e as ws,D as Ns,a as Ss,b as ks,c as me}from"./dropdown-menu-7gruBPiX.js";import{L as D}from"./label-DPtwVyR_.js";import{S as V,R as Ts}from"./slider-BzqSx8sm.js";import{D as Cs,b as As,c as Es,d as _s,e as Rs}from"./dialog-91XSgeKl.js";import{a as q,P as Ds}from"./analyticsConfig-Di1mAdDI.js";import{m as he,p as pe,e as _e}from"./enhancedPatternAnalysis-BSzs8ls5.js";import{P as Is}from"./progress-DZC4VRn8.js";import{B as Ms}from"./badge-XQGYYPGp.js";import{a as le,c as Re,S as Ps,d as fe,F as Fs,b as Ls}from"./analyticsExport-NqB-BhO_.js";import{l as f}from"./logger-Bi5o39IC.js";import{Z as zs,A as Os}from"./zap-DStDXklo.js";import{B as ce}from"./brain-BaLNfPwJ.js";import{L as re}from"./loader-circle-D6K3-BGk.js";import{D as Be}from"./download-B5AHGw6a.js";import{S as Ws}from"./save-C79c2pc2.js";import{u as Vs}from"./usePerformanceCache-BszGIQAI.js";import{v as Us,g as ie,d as Gs}from"./diagnostics-BmeDtVon.js";import{b as qs,c as De,a as Ks}from"./analyticsManager-D5rdgc0M.js";import{F as Bs}from"./file-text-x8qZG1DU.js";import{C as $s}from"./chart-column-RudVS-6d.js";import{E as Hs}from"./eye-CGa4_C8K.js";import{T as Js}from"./trending-up-B9AG_QY6.js";/**
 * @license lucide-react v0.452.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=fs("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var Te="Radio",[Ys,$e]=Oe(Te),[Xs,Zs]=Ys(Te),He=l.forwardRef((t,a)=>{const{__scopeRadio:n,name:s,checked:i=!1,required:o,disabled:k,value:g="on",onCheck:m,form:T,...j}=t,[C,h]=l.useState(null),I=We(a,L=>h(L)),w=l.useRef(!1),M=C?T||!!C.closest("form"):!0;return e.jsxs(Xs,{scope:n,checked:i,disabled:k,children:[e.jsx(ke.button,{type:"button",role:"radio","aria-checked":i,"data-state":Ye(i),"data-disabled":k?"":void 0,disabled:k,value:g,...j,ref:I,onClick:be(t.onClick,L=>{i||m?.(),M&&(w.current=L.isPropagationStopped(),w.current||L.stopPropagation())})}),M&&e.jsx(et,{control:C,bubbles:!w.current,name:s,value:g,checked:i,required:o,disabled:k,form:T,style:{transform:"translateX(-100%)"}})]})});He.displayName=Te;var Je="RadioIndicator",Qe=l.forwardRef((t,a)=>{const{__scopeRadio:n,forceMount:s,...i}=t,o=Zs(Je,n);return e.jsx(ms,{present:s||o.checked,children:e.jsx(ke.span,{"data-state":Ye(o.checked),"data-disabled":o.disabled?"":void 0,...i,ref:a})})});Qe.displayName=Je;var et=t=>{const{control:a,checked:n,bubbles:s=!0,...i}=t,o=l.useRef(null),k=hs(n),g=ps(a);return l.useEffect(()=>{const m=o.current,T=window.HTMLInputElement.prototype,C=Object.getOwnPropertyDescriptor(T,"checked").set;if(k!==n&&C){const h=new Event("click",{bubbles:s});C.call(m,n),m.dispatchEvent(h)}},[k,n,s]),e.jsx("input",{type:"radio","aria-hidden":!0,defaultChecked:n,...i,tabIndex:-1,ref:o,style:{...t.style,...g,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Ye(t){return t?"checked":"unchecked"}var st=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Ce="RadioGroup",[tt,ea]=Oe(Ce,[ze,$e]),Xe=ze(),Ze=$e(),[at,nt]=tt(Ce),es=l.forwardRef((t,a)=>{const{__scopeRadioGroup:n,name:s,defaultValue:i,value:o,required:k=!1,disabled:g=!1,orientation:m,dir:T,loop:j=!0,onValueChange:C,...h}=t,I=Xe(n),w=ls(T),[M,L]=cs({prop:o,defaultProp:i,onChange:C});return e.jsx(at,{scope:n,name:s,required:k,disabled:g,value:M,onValueChange:L,children:e.jsx(ds,{asChild:!0,...I,orientation:m,dir:w,loop:j,children:e.jsx(ke.div,{role:"radiogroup","aria-required":k,"aria-orientation":m,"data-disabled":g?"":void 0,dir:w,...h,ref:a})})})});es.displayName=Ce;var ss="RadioGroupItem",ts=l.forwardRef((t,a)=>{const{__scopeRadioGroup:n,disabled:s,...i}=t,o=nt(ss,n),k=o.disabled||s,g=Xe(n),m=Ze(n),T=l.useRef(null),j=We(a,T),C=o.value===i.value,h=l.useRef(!1);return l.useEffect(()=>{const I=M=>{st.includes(M.key)&&(h.current=!0)},w=()=>h.current=!1;return document.addEventListener("keydown",I),document.addEventListener("keyup",w),()=>{document.removeEventListener("keydown",I),document.removeEventListener("keyup",w)}},[]),e.jsx(us,{asChild:!0,...g,focusable:!k,active:C,children:e.jsx(He,{disabled:k,required:o.required,checked:C,...m,...i,name:o.name,ref:j,onCheck:()=>o.onValueChange(i.value),onKeyDown:be(I=>{I.key==="Enter"&&I.preventDefault()}),onFocus:be(i.onFocus,()=>{h.current&&T.current?.click()})})})});ts.displayName=ss;var rt="RadioGroupIndicator",as=l.forwardRef((t,a)=>{const{__scopeRadioGroup:n,...s}=t,i=Ze(n);return e.jsx(Qe,{...i,...s,ref:a})});as.displayName=rt;var ns=es,rs=ts,it=as;const we=l.forwardRef(({className:t,...a},n)=>e.jsx(ns,{className:Ve("grid gap-2",t),...a,ref:n}));we.displayName=ns.displayName;const X=l.forwardRef(({className:t,...a},n)=>e.jsx(rs,{ref:n,className:Ve("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...a,children:e.jsx(it,{className:"flex items-center justify-center",children:e.jsx(ws,{className:"h-2.5 w-2.5 fill-current text-current"})})}));X.displayName=rs.displayName;const ot=({onConfigChange:t,onClose:a})=>{const{tAnalytics:n}=Ue(),[s,i]=l.useState(q.getConfig()),[o,k]=l.useState("balanced"),[g,m]=l.useState(!1),[T,j]=l.useState(new Map),[C,h]=l.useState(null),[I,w]=l.useState(!0),[M,L]=l.useState(!0),[$,v]=l.useState(null);l.useEffect(()=>{const r=q.subscribe(u=>{i(u),t&&t(u)});return H(),r},[t]);const H=async()=>{L(!0);try{await he.init();const r=await he.getModelStatus();j(r)}catch(r){f.error("Failed to load ML model status",{error:r}),E.error("Failed to load ML models: Could not retrieve model status. Some features may be unavailable.")}finally{L(!1)}},R=(r,u)=>{const y={...s};let P=y;for(let Z=0;Z<r.length-1;Z++)P=P[r[Z]];P[r[r.length-1]]=u[0],i(y),m(!0)},W=r=>{const u={...s};u.alertSensitivity.level=r,i(u),m(!0)},J=r=>{k(r),q.setPreset(r),m(!1),E.success(`Applied ${Ds[r].name} configuration`)},te=()=>{q.updateConfig(s),m(!1),E.success("Analytics configuration has been updated")},ae=()=>{q.resetToDefaults(),k("balanced"),m(!1),E.success("Settings have been reset to defaults")},Y=()=>{const r=q.exportConfig(),u=new Blob([r],{type:"application/json"}),y=URL.createObjectURL(u),P=document.createElement("a");P.href=y,P.download="analytics-config.json",document.body.appendChild(P),P.click(),document.body.removeChild(P),URL.revokeObjectURL(y),E.success("Configuration saved to analytics-config.json")},A=r=>{const u=r.target.files?.[0];if(!u)return;const y=new FileReader;y.onload=P=>{try{const Z=P.target?.result;q.importConfig(Z)?(m(!1),E.success("Successfully imported configuration")):E.error("Invalid configuration file")}catch{E.error("Failed to read configuration file")}},y.readAsText(u)},[d,p]=l.useState(null);l.useEffect(()=>{if(!d)return;let r=!1;const u=window.setTimeout(async()=>{r||(h(null),await H(),E.success(`${d} model has been updated`),p(null))},3e3);return()=>{r=!0,clearTimeout(u)}},[d]);const c=async r=>{h(r),E(`Training ${r} model in background...`),p(r)},b=async r=>{v(r);try{await he.deleteModel(r),await H(),E.success(`${r} model has been removed`)}catch{E.error("Failed to delete model")}finally{v(null)}},N=r=>r.split("-").map(u=>u.charAt(0).toUpperCase()+u.slice(1)).join(" "),_=r=>{switch(r){case"emotion-prediction":return e.jsx(ce,{className:"h-4 w-4"});case"sensory-response":return e.jsx(Os,{className:"h-4 w-4"});case"baseline-clustering":return e.jsx(Re,{className:"h-4 w-4"});default:return e.jsx(le,{className:"h-4 w-4"})}},x=r=>e.jsx(ys,{children:e.jsxs(js,{children:[e.jsx(vs,{asChild:!0,children:e.jsx(Ee,{className:"h-4 w-4 ml-2 text-muted-foreground cursor-help"})}),e.jsx(bs,{children:e.jsx("p",{className:"max-w-xs",children:r})})]})});return e.jsx(Cs,{open:!0,onOpenChange:a,children:e.jsxs(As,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Es,{children:[e.jsxs(_s,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5"}),String(n("settings.title"))]}),e.jsx(Rs,{children:String(n("settings.subtitle"))})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(F,{children:[e.jsxs(U,{children:[e.jsx(G,{className:"text-lg",children:String(n("settings.presets.title"))}),e.jsx(Q,{children:String(n("settings.presets.description"))})]}),e.jsx(z,{children:e.jsx(we,{value:o,onValueChange:r=>J(r),children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(D,{htmlFor:"conservative",className:"flex flex-col space-y-2 cursor-pointer border rounded-lg p-4 hover:bg-muted/50",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(X,{value:"conservative",id:"conservative"}),e.jsx(Re,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"font-medium",children:String(n("settings.presets.conservative"))})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:String(n("settings.presets.conservativeDesc"))})]}),e.jsxs(D,{htmlFor:"balanced",className:"flex flex-col space-y-2 cursor-pointer border rounded-lg p-4 hover:bg-muted/50",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(X,{value:"balanced",id:"balanced"}),e.jsx(le,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"font-medium",children:String(n("settings.presets.balanced"))})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:String(n("settings.presets.balancedDesc"))})]}),e.jsxs(D,{htmlFor:"sensitive",className:"flex flex-col space-y-2 cursor-pointer border rounded-lg p-4 hover:bg-muted/50",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(X,{value:"sensitive",id:"sensitive"}),e.jsx(zs,{className:"h-4 w-4 text-yellow-500"}),e.jsx("span",{className:"font-medium",children:String(n("settings.presets.sensitive"))})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:String(n("settings.presets.sensitiveDesc"))})]})]})})})]}),e.jsxs(qe,{defaultValue:"thresholds",className:"w-full",children:[e.jsxs(Ke,{className:"grid w-full grid-cols-5",children:[e.jsx(ee,{value:"thresholds",children:String(n("settings.tabs.thresholds"))}),e.jsx(ee,{value:"sensitivity",children:String(n("settings.tabs.sensitivity"))}),e.jsx(ee,{value:"timewindows",children:String(n("settings.tabs.timeWindows"))}),e.jsx(ee,{value:"mlmodels",children:String(n("settings.tabs.mlModels"))}),e.jsx(ee,{value:"advanced",children:String(n("settings.tabs.advanced"))})]}),e.jsxs(K,{value:"thresholds",className:"space-y-4",children:[e.jsxs(F,{children:[e.jsxs(U,{children:[e.jsx(G,{className:"text-base",children:"Pattern Analysis Thresholds"}),e.jsx(Q,{children:"Adjust minimum requirements and thresholds for pattern detection"})]}),e.jsxs(z,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{htmlFor:"minDataPoints",children:"Minimum Data Points"}),x("Minimum number of data points required for analysis")]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(V,{id:"minDataPoints",value:[s.patternAnalysis.minDataPoints],onValueChange:r=>R(["patternAnalysis","minDataPoints"],r),min:1,max:10,step:1,className:"flex-1"}),e.jsx("span",{className:"w-12 text-right",children:s.patternAnalysis.minDataPoints})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{htmlFor:"correlationThreshold",children:"Correlation Threshold"}),x("Minimum correlation coefficient to consider significant")]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(V,{id:"correlationThreshold",value:[s.patternAnalysis.correlationThreshold],onValueChange:r=>R(["patternAnalysis","correlationThreshold"],r),min:.1,max:.9,step:.05,className:"flex-1"}),e.jsx("span",{className:"w-12 text-right",children:s.patternAnalysis.correlationThreshold.toFixed(2)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{htmlFor:"concernFrequency",children:"Concern Frequency Threshold"}),x("Percentage of sessions that must show concerning patterns")]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(V,{id:"concernFrequency",value:[s.patternAnalysis.concernFrequencyThreshold*100],onValueChange:r=>R(["patternAnalysis","concernFrequencyThreshold"],[r[0]/100]),min:10,max:50,step:5,className:"flex-1"}),e.jsxs("span",{className:"w-12 text-right",children:[(s.patternAnalysis.concernFrequencyThreshold*100).toFixed(0),"%"]})]})]})]})]}),e.jsxs(F,{children:[e.jsxs(U,{children:[e.jsx(G,{className:"text-base",children:"Enhanced Analysis Thresholds"}),e.jsx(Q,{children:"Configure advanced pattern detection and anomaly thresholds"})]}),e.jsxs(z,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{htmlFor:"anomalyThreshold",children:"Anomaly Detection Sensitivity"}),x("Number of standard deviations to trigger anomaly alert")]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(V,{id:"anomalyThreshold",value:[s.enhancedAnalysis.anomalyThreshold],onValueChange:r=>R(["enhancedAnalysis","anomalyThreshold"],r),min:1,max:3,step:.25,className:"flex-1"}),e.jsxs("span",{className:"w-12 text-right",children:[s.enhancedAnalysis.anomalyThreshold.toFixed(2),"σ"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{htmlFor:"minSampleSize",children:"Minimum Sample Size"}),x("Minimum data points for statistical analysis")]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(V,{id:"minSampleSize",value:[s.enhancedAnalysis.minSampleSize],onValueChange:r=>R(["enhancedAnalysis","minSampleSize"],r),min:3,max:15,step:1,className:"flex-1"}),e.jsx("span",{className:"w-12 text-right",children:s.enhancedAnalysis.minSampleSize})]})]})]})]})]}),e.jsx(K,{value:"sensitivity",className:"space-y-4",children:e.jsxs(F,{children:[e.jsxs(U,{children:[e.jsx(G,{className:"text-base",children:"Alert Sensitivity"}),e.jsx(Q,{children:"Control how sensitive the system is to potential issues"})]}),e.jsxs(z,{className:"space-y-4",children:[e.jsx(we,{value:s.alertSensitivity.level,onValueChange:W,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs(D,{className:"flex items-start space-x-3 cursor-pointer",children:[e.jsx(X,{value:"low",className:"mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Low Sensitivity"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Only alert for significant patterns with high confidence"})]})]}),e.jsxs(D,{className:"flex items-start space-x-3 cursor-pointer",children:[e.jsx(X,{value:"medium",className:"mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Medium Sensitivity"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Balanced approach to pattern detection and alerts"})]})]}),e.jsxs(D,{className:"flex items-start space-x-3 cursor-pointer",children:[e.jsx(X,{value:"high",className:"mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"High Sensitivity"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Alert for subtle patterns and potential concerns early"})]})]})]})}),e.jsxs("div",{className:"pt-4 space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Current Multipliers:"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{children:["Emotion: ",s.alertSensitivity.emotionIntensityMultiplier,"x"]}),e.jsxs("div",{children:["Frequency: ",s.alertSensitivity.frequencyMultiplier,"x"]}),e.jsxs("div",{children:["Anomaly: ",s.alertSensitivity.anomalyMultiplier,"x"]})]})]})]})]})}),e.jsx(K,{value:"timewindows",className:"space-y-4",children:e.jsxs(F,{children:[e.jsxs(U,{children:[e.jsx(G,{className:"text-base",children:"Analysis Time Windows"}),e.jsx(Q,{children:"Configure the time periods used for different analyses"})]}),e.jsxs(z,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{htmlFor:"defaultAnalysis",children:"Default Analysis Period"}),x("Standard time window for pattern analysis")]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(V,{id:"defaultAnalysis",value:[s.timeWindows.defaultAnalysisDays],onValueChange:r=>R(["timeWindows","defaultAnalysisDays"],r),min:7,max:90,step:7,className:"flex-1"}),e.jsxs("span",{className:"w-16 text-right",children:[s.timeWindows.defaultAnalysisDays," days"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{htmlFor:"recentData",children:"Recent Data Window"}),x("Time window for recent activity alerts")]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(V,{id:"recentData",value:[s.timeWindows.recentDataDays],onValueChange:r=>R(["timeWindows","recentDataDays"],r),min:3,max:14,step:1,className:"flex-1"}),e.jsxs("span",{className:"w-16 text-right",children:[s.timeWindows.recentDataDays," days"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{htmlFor:"longTerm",children:"Long-term Analysis Window"}),x("Extended time window for trend analysis")]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(V,{id:"longTerm",value:[s.timeWindows.longTermDays],onValueChange:r=>R(["timeWindows","longTermDays"],r),min:30,max:180,step:30,className:"flex-1"}),e.jsxs("span",{className:"w-16 text-right",children:[s.timeWindows.longTermDays," days"]})]})]})]})]})}),e.jsx(K,{value:"mlmodels",className:"space-y-4",children:e.jsxs(F,{children:[e.jsxs(U,{children:[e.jsxs(G,{className:"text-base flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4"}),"Machine Learning Models"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{htmlFor:"ml-enabled",className:"text-sm font-normal",children:"Enable ML"}),e.jsx(Ps,{id:"ml-enabled",checked:I,onCheckedChange:w})]})]}),e.jsx(Q,{children:"Manage AI-powered prediction models for enhanced analytics"})]}),e.jsx(z,{className:"space-y-4",children:M?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(re,{className:"h-8 w-8 animate-spin text-muted-foreground"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"Loading ML models..."})]}):e.jsxs(e.Fragment,{children:[["emotion-prediction","sensory-response","baseline-clustering"].map(r=>{const u=T.get(r),y=C===r;return e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[_(r),e.jsx("h4",{className:"font-medium",children:N(r)})]}),e.jsx(Ms,{variant:u?"default":"outline",children:u?"Trained":"Not Trained"})]}),u?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Version"}),e.jsx("p",{className:"font-medium",children:u.version})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Last Trained"}),e.jsx("p",{className:"font-medium",children:new Date(u.lastTrainedAt).toLocaleDateString()})]}),u.accuracy&&e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Accuracy"}),e.jsxs("p",{className:"font-medium",children:[(u.accuracy*100).toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Data Points"}),e.jsx("p",{className:"font-medium",children:u.dataPoints})]})]}),u.accuracy&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Model Performance"}),e.jsxs("span",{children:[(u.accuracy*100).toFixed(1),"%"]})]}),e.jsx(Is,{value:u.accuracy*100,className:"h-2"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(O,{size:"sm",variant:"outline",onClick:()=>c(r),disabled:y||!I,children:y?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-3 w-3 mr-1 animate-spin"}),"Training..."]}):e.jsxs(e.Fragment,{children:[e.jsx(gs,{className:"h-3 w-3 mr-1"}),"Retrain"]})}),e.jsx(O,{size:"sm",variant:"outline",onClick:()=>b(r),disabled:y||$===r,children:$===r?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-3 w-3 mr-1 animate-spin"}),"Deleting..."]}):"Delete"})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"No model trained yet. Model will be trained automatically when sufficient data is available."}),e.jsx(O,{size:"sm",variant:"outline",onClick:()=>c(r),disabled:y||!I,children:y?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-3 w-3 mr-1 animate-spin"}),"Training..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"h-3 w-3 mr-1"}),"Train Model"]})})]})]},r)}),e.jsxs("div",{className:"rounded-lg bg-muted/50 p-4 space-y-2",children:[e.jsxs("h5",{className:"font-medium flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4"}),"About Machine Learning"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"ML models enhance predictions by learning from historical patterns. They require:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1 ml-4",children:[e.jsx("li",{children:"• Emotion prediction: 7+ days of data"}),e.jsx("li",{children:"• Sensory response: 10+ tracking sessions"}),e.jsx("li",{children:"• Baseline clustering: 10+ tracking entries"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Models are trained locally in your browser and improve over time as more data is collected."})]})]})})]})}),e.jsxs(K,{value:"advanced",className:"space-y-4",children:[e.jsxs(F,{children:[e.jsxs(U,{children:[e.jsx(G,{className:"text-base",children:"Cache Settings"}),e.jsx(Q,{children:"Configure performance optimization settings"})]}),e.jsxs(z,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{htmlFor:"cacheTTL",children:"Cache Duration"}),x("How long to keep cached analytics results")]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(V,{id:"cacheTTL",value:[s.cache.ttl/6e4],onValueChange:r=>R(["cache","ttl"],[r[0]*6e4]),min:1,max:30,step:1,className:"flex-1"}),e.jsxs("span",{className:"w-16 text-right",children:[s.cache.ttl/6e4," min"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{children:"Invalidate cache on config change"}),x("Clear cached results when settings change")]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s.cache.invalidateOnConfigChange?"Enabled":"Disabled"})]})]})]}),e.jsxs(F,{children:[e.jsxs(U,{children:[e.jsx(G,{className:"text-base",children:"Import/Export Configuration"}),e.jsx(Q,{children:"Save and share your configuration settings"})]}),e.jsxs(z,{className:"flex gap-4",children:[e.jsxs(O,{variant:"outline",onClick:Y,className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-4 w-4"}),"Export Config"]}),e.jsxs(D,{htmlFor:"import-config",className:"cursor-pointer",children:[e.jsx(O,{variant:"outline",asChild:!0,className:"flex items-center gap-2",children:e.jsxs("span",{children:[e.jsx(Qs,{className:"h-4 w-4"}),"Import Config"]})}),e.jsx("input",{id:"import-config",type:"file",accept:".json",onChange:A,"aria-label":"Import configuration file",className:"hidden"})]})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(O,{variant:"outline",onClick:ae,className:"flex items-center gap-2",children:[e.jsx(Ts,{className:"h-4 w-4"}),"Reset to Defaults"]}),e.jsxs("div",{className:"flex gap-2",children:[g&&e.jsxs("p",{className:"text-sm text-yellow-600 flex items-center gap-1 mr-4",children:[e.jsx(xs,{className:"h-4 w-4"}),"Unsaved changes"]}),e.jsx(O,{variant:"outline",onClick:a,children:"Cancel"}),e.jsxs(O,{onClick:te,disabled:!g,className:"flex items-center gap-2",children:[e.jsx(Ws,{className:"h-4 w-4"}),"Save Changes"]})]})]})]})]})})},lt=ue.lazy(()=>B(()=>import("./ChartsPanel-C17DCFFF.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(t=>({default:t.ChartsPanel}))),ct=ue.lazy(()=>B(()=>import("./PatternsPanel-Cd4ai1uS.js"),__vite__mapDeps([9,3,2,4,1,5,6,7,8,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38])).then(t=>({default:t.PatternsPanel}))),dt=ue.lazy(()=>B(()=>import("./CorrelationsPanel-D-7e999k.js"),__vite__mapDeps([39,3,2,4,1,5,6,7,8,10,11,40,41,42,43,14,13,15,19,21,18])).then(t=>({default:t.CorrelationsPanel}))),ut=ue.lazy(()=>B(()=>import("./AlertsPanel-CZe7xz90.js"),__vite__mapDeps([44,3,2,13,6,4,1,5,7,8,10,45,28,29,12,14,15,16,17,46,22,20])).then(t=>({default:t.AlertsPanel}))),mt=1,ht=1e6;let ge=0;function pt(){return ge=(ge+1)%Number.MAX_SAFE_INTEGER,ge.toString()}const xe=new Map,Ie=t=>{if(xe.has(t))return;const a=setTimeout(()=>{xe.delete(t),de({type:"REMOVE_TOAST",toastId:t})},ht);xe.set(t,a)},ft=(t,a)=>{switch(a.type){case"ADD_TOAST":return{...t,toasts:[a.toast,...t.toasts].slice(0,mt)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(n=>n.id===a.toast.id?{...n,...a.toast}:n)};case"DISMISS_TOAST":{const{toastId:n}=a;return n?Ie(n):t.toasts.forEach(s=>{Ie(s.id)}),{...t,toasts:t.toasts.map(s=>s.id===n||n===void 0?{...s,open:!1}:s)}}case"REMOVE_TOAST":return a.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(n=>n.id!==a.toastId)}}},gt=[];let ye={toasts:[]};function de(t){ye=ft(ye,t),gt.forEach(a=>{a(ye)})}function se({...t}){const a=pt(),n=i=>de({type:"UPDATE_TOAST",toast:{...i,id:a}}),s=()=>de({type:"DISMISS_TOAST",toastId:a});return de({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:i=>{i||s()}}}),{id:a,dismiss:s,update:n}}class xt{isProcessing=!1;queue=[];async processAnalytics(a){return new Promise((n,s)=>{this.queue.push({data:a,resolve:n,reject:s}),this.processQueue()})}async processQueue(){if(this.isProcessing||this.queue.length===0)return;this.isProcessing=!0;const{data:a,resolve:n,reject:s}=this.queue.shift();try{await new Promise(o=>setTimeout(o,0));const i={patterns:[],correlations:[],environmentalCorrelations:[],predictiveInsights:[],anomalies:[],insights:[]};if(a.emotions.length>0)try{const o=pe.analyzeEmotionPatterns(a.emotions,30);i.patterns.push(...o)}catch(o){f.error("Fallback: Error analyzing emotion patterns",o)}if(await new Promise(o=>setTimeout(o,0)),a.sensoryInputs.length>0)try{const o=pe.analyzeSensoryPatterns(a.sensoryInputs,30);i.patterns.push(...o)}catch(o){f.error("Fallback: Error analyzing sensory patterns",o)}if(await new Promise(o=>setTimeout(o,0)),a.entries.length>2)try{const o=pe.analyzeEnvironmentalCorrelations(a.entries);i.correlations=o,i.environmentalCorrelations=o}catch(o){f.error("Fallback: Error analyzing correlations",o)}if(await new Promise(o=>setTimeout(o,0)),a.entries.length>1){try{const o=await _e.generatePredictiveInsights(a.emotions,a.sensoryInputs,a.entries,[]);i.predictiveInsights=o}catch(o){f.error("Fallback: Error generating predictive insights",o)}await new Promise(o=>setTimeout(o,0));try{const o=_e.detectAnomalies(a.emotions,a.sensoryInputs,a.entries);i.anomalies=o}catch(o){f.error("Fallback: Error detecting anomalies",o)}}a.entries.length<5?i.insights.push(`Limited data available (${a.entries.length} sessions). Continue collecting data for better insights.`):i.insights.push("Analytics processed successfully. Continue collecting data for more detailed patterns."),n(i)}catch(i){f.error("Fallback analytics failed",i),s(i instanceof Error?i:new Error("Analytics processing failed"))}finally{this.isProcessing=!1,setTimeout(()=>this.processQueue(),100)}}}const je=new xt,S={worker:null,refs:0,ready:!1,circuitUntil:0};function Ae(){return Date.now()}function Ne(){return Ae()<S.circuitUntil}function Me(t){S.circuitUntil=Ae()+Math.max(0,t)}const Pe=new Map;function is(t,a,n){const s=Ae(),i=Pe.get(t)??0;if(s-i>a){Pe.set(t,s);try{n()}catch{}}}const Se=[],ve=[];function os(){if(!(!S.worker||!S.ready))for(;Se.length;)try{S.worker.postMessage(Se.shift())}catch{break}}async function yt(){if(Ge||oe)return null;if(S.worker)return S.worker;if(Ne())return null;try{const a=(await B(()=>import("./analytics.worker-CpFVpmUT.js"),[])).default,n=new a;return n.onmessage=s=>{if(!S.ready){const i=s.data;(!i||i.type==="progress"||i.type==="partial"||i.type==="complete"||i.type==="error")&&(S.ready=!0,os())}},n.onerror=s=>{f.error("[useAnalyticsWorker] Worker runtime error, switching to fallback",s);try{n.terminate()}catch{}S.worker=null,S.ready=!1,Me(6e4),is("analytics_worker_failure",6e4,()=>{try{B(async()=>{const{useTranslation:i}=await import("./index-p40y1I9K.js").then(o=>o.s);return{useTranslation:i}},__vite__mapDeps([4,3,2,1,5,6,7,8])).then(({useTranslation:i})=>{const{t:o}=i("analytics");se({title:o("worker.fallbackTitle"),description:o("worker.fallbackDescription")})}).catch(()=>{se({title:"Analytics running in fallback mode",description:"Background worker failed. Using safe fallback to keep the UI responsive."})})}catch{se({title:"Analytics running in fallback mode",description:"Background worker failed. Using safe fallback to keep the UI responsive."})}})},S.worker=n,S.ready=!1,f.info("[useAnalyticsWorker] Analytics worker initialized successfully"),n}catch(t){return f.error("[useAnalyticsWorker] Failed to initialize worker",t),S.worker=null,Me(15e3),null}}function jt(){S.refs+=1}function Fe(){if(S.refs=Math.max(0,S.refs-1),S.refs===0&&S.worker){try{f.debug("[useAnalyticsWorker] Terminating analytics worker"),S.worker.terminate()}catch{}S.worker=null,S.ready=!1}}const vt=(t={})=>{const a=(()=>{try{return q.getConfig()}catch{return null}})(),{config:n}=Us(a??void 0),s=typeof t.cacheTTL=="number"?t.cacheTTL:n?.cache?.ttl??3e5,{cacheTTL:i=s,enableCacheStats:o=!1,precomputeOnIdle:k=!1}=t,g=l.useRef(null),m=l.useRef(null),[T,j]=l.useState(null),[C,h]=l.useState(!1),[I,w]=l.useState(null),M=l.useRef(null),[L,$]=l.useState(!1),v=Vs({maxSize:n?.cache?.maxSize??50,ttl:i,enableStats:o,versioning:!0}),H=l.useCallback(d=>{const p=["analytics"];if("entries"in d&&d.entries?.length>0){const b=Array.from(new Set(d.entries.map(N=>N.studentId)));p.push(...b.map(N=>`student-${N}`))}const c=new Date;return p.push(`analytics-${c.getFullYear()}-${c.getMonth()+1}`),p},[]),R=t.extractTagsFromData??H;l.useEffect(()=>{let d=!0;return(async()=>{if(Ge||oe){g.current=null,$(!1),oe&&is("analytics_worker_disabled",6e4,()=>{try{B(async()=>{const{useTranslation:b}=await import("./index-p40y1I9K.js").then(N=>N.s);return{useTranslation:b}},__vite__mapDeps([4,3,2,1,5,6,7,8])).then(({useTranslation:b})=>{const{t:N}=b("analytics");se({title:N("worker.disabledTitle"),description:N("worker.disabledDescription")})}).catch(()=>{se({title:"Analytics worker disabled",description:"Running analytics without a background worker (debug mode)."})})}catch{se({title:"Analytics worker disabled",description:"Running analytics without a background worker (debug mode)."})}});return}if(Ne()){g.current=null,$(!1);return}jt();const c=await yt();if(!d){Fe();return}if(g.current=c,$(!!(S.ready&&c)),c){const b=_=>{const x=_.data;if(x){S.ready||(S.ready=!0,os()),m.current&&(clearTimeout(m.current),m.current=null);try{switch(x.type){case"partial":break;case"complete":j(x.payload),h(!1),w(null);break;case"error":h(!1),w(typeof x.error=="string"?x.error:"Analytics worker error"),j(r=>r??{patterns:[],correlations:[],environmentalCorrelations:[],predictiveInsights:[],anomalies:[],insights:["Analytics temporarily unavailable."]});break;case"progress":break;default:break}}catch(r){f.error("[useAnalyticsWorker] Failed handling worker message",r)}}},N=_=>{f.error("[useAnalyticsWorker] messageerror from analytics worker",_)};c.addEventListener("message",b),c.addEventListener("messageerror",N),ve.push(()=>{try{c.removeEventListener("message",b),c.removeEventListener("messageerror",N)}catch{}})}})(),()=>{for(d=!1,M.current&&(cancelIdleCallback(M.current),M.current=null),m.current&&(clearTimeout(m.current),m.current=null);ve.length;)try{ve.pop()()}catch{}Fe()}},[]);const W=l.useCallback(d=>{const p={entries:d.entries,emotions:d.emotions,sensoryInputs:d.sensoryInputs},c=ie();return qs(p,{config:c})},[]),J=l.useCallback(async d=>{const p=W(d),c=v.get(p);if(c){if(!v.get(`_logged_${p}`))try{f.debug("[useAnalyticsWorker] cache hit",{cacheKey:p}),v.set(`_logged_${p}`,!0,["logging"],6e4)}catch{}j(c),w(null);return}if(!g.current||oe){v.get("_logged_fallback_mode")||(f.debug("[useAnalyticsWorker] No worker available, using fallback"),v.set("_logged_fallback_mode",!0,["logging"],36e5)),h(!0),w(null);try{const u=await je.processAnalytics(d);j(u);const y=R(d);v.set(p,u,y)}catch(u){f.error("[useAnalyticsWorker] Fallback failed",u),w("Analytics processing failed. Please try again."),j({patterns:[],correlations:[],environmentalCorrelations:[],predictiveInsights:[],anomalies:[],insights:["Analytics temporarily unavailable."]})}finally{h(!1)}return}h(!0),w(null),j(null),m.current&&(clearTimeout(m.current),m.current=null);const N=ie()?.cache?.ttl??15e3,_=Math.min(2e4,Math.max(5e3,N));m.current=setTimeout(async()=>{try{f.error("[useAnalyticsWorker] watchdog timeout: worker did not respond, attempting fallback")}catch{}Gs.logWorkerTimeout("analytics",_),g.current&&(g.current.terminate(),g.current=null);try{const u=await je.processAnalytics(d);j(u);const y=R(d);v.set(p,u,y),w("Worker timeout - results computed using fallback mode.")}catch(u){f.error("[useAnalyticsWorker] Fallback failed after watchdog timeout",u),w("Analytics processing failed. Please try again."),j({patterns:[],correlations:[],environmentalCorrelations:[],predictiveInsights:[],anomalies:[],insights:["Analytics temporarily unavailable."]})}finally{h(!1)}},_);const x=ie(),r=`_logged_worker_post_${new Date().getMinutes()}`;if(!v.get(r))try{f.debug("[useAnalyticsWorker] posting to worker (runAnalysis)",{hasConfig:!!x,cacheKey:p}),v.set(r,!0,["logging"],6e4)}catch{}try{const u={entries:d.entries,emotions:d.emotions,sensoryInputs:d.sensoryInputs},y=De(u,{config:x,tags:R(d)}),P=`_logged_worker_message_${p}_${new Date().getMinutes()}`;if(v.get(P)||(f.debug("[WORKER_MESSAGE] Sending Insights/Compute task to analytics worker",{cacheKey:y.cacheKey,ttlSeconds:y.ttlSeconds,tagCount:y.tags?.length??0,emotionsCount:d.emotions?.length||0,sensoryInputsCount:d.sensoryInputs?.length||0,entriesCount:d.entries?.length||0}),v.set(P,!0,["logging"],6e4)),(!g.current||Ne())&&!S.worker)throw new Error("Worker unavailable or circuit open");if(g.current&&!S.ready)Se.push(y);else if(g.current)g.current.postMessage(y);else throw new Error("Worker reference missing")}catch(u){f.error("[WORKER_MESSAGE] Failed to post message to worker, falling back to sync",{error:u}),m.current&&(clearTimeout(m.current),m.current=null);try{const y=await je.processAnalytics(d);j(y);const P=R(d);v.set(p,y,P),w(null)}catch(y){f.error("[useAnalyticsWorker] Fallback processing failed after worker post error",y),w("Analytics processing failed.")}finally{h(!1)}}},[v,W,R]),te=l.useCallback(d=>{if(!k||!g.current)return;const p=()=>{const c=d(),b=ie();c.forEach((N,_)=>{setTimeout(()=>{const x=W(N);if(!v.has(x)){try{f.debug("[useAnalyticsWorker] posting Insights/Compute task (precompute)",{hasConfig:!!b,cacheKey:x,idx:_})}catch{}const r=De({entries:N.entries,emotions:N.emotions,sensoryInputs:N.sensoryInputs},{config:b,tags:R(N)});g.current?.postMessage(r)}},_*100)})};"requestIdleCallback"in window?M.current=requestIdleCallback(p,{timeout:5e3}):setTimeout(p,2e3)},[k,v,W]),ae=l.useCallback(d=>{v.invalidateByTag(`student-${d}`)},[v]),Y=l.useCallback(()=>{v.clear()},[v]);l.useEffect(()=>q.subscribe(p=>{p.cache.invalidateOnConfigChange&&Y()}),[Y]);const A=l.useCallback(()=>v.stats,[v]);return{results:T,isAnalyzing:C,error:I,runAnalysis:J,precomputeCommonAnalytics:te,invalidateCacheForStudent:ae,clearCache:Y,cacheStats:A(),cacheSize:v.size}},bt=["charts","patterns","correlations","alerts"];function wt(t){if(!t)return!1;const a=t==="visualizations"?"charts":t;return bt.includes(a)}function Nt(t){return!t||t==="visualizations"?"charts":wt(t)?t:"charts"}function St(t={}){const{debounceMs:a=150,paramKey:n="tab",defaultTab:s="charts"}=t,i=l.useCallback(()=>{try{const j=new URLSearchParams(window.location.search).get(n),h=Nt(j==="visualizations"?"charts":j)||s;try{f.debug("[useSyncedTabParam] Read tab from URL",{tab:h,paramKey:n})}catch{}return h}catch{return s}},[s,n]),[o,k]=l.useState(()=>i());l.useEffect(()=>{const T=()=>{const j=i();try{f.debug("[useSyncedTabParam] popstate -> sync activeTab",{tab:j,paramKey:n})}catch{}k(j)};return window.addEventListener("popstate",T),()=>window.removeEventListener("popstate",T)},[i,n]);const g=l.useRef(void 0),m=l.useCallback(T=>{const j=()=>{try{const C=new URL(window.location.href);C.searchParams.set(n,T),window.history.replaceState(window.history.state,"",C.toString());try{f.debug("[useSyncedTabParam] URL sync via history.replaceState",{tab:T,paramKey:n})}catch{}}catch{}};g.current&&window.clearTimeout(g.current),g.current=window.setTimeout(j,a)},[a,n]);return l.useEffect(()=>{m(o)},[o,m]),[o,k]}const Le=[{key:"charts",labelKey:"tabs.charts",testId:"dashboard-charts-tab",ariaLabelKey:"aria.tabs.charts"},{key:"patterns",labelKey:"tabs.patterns",testId:"dashboard-patterns-tab",ariaLabelKey:"aria.tabs.patterns"},{key:"correlations",labelKey:"tabs.correlations",testId:"dashboard-correlations-tab",ariaLabelKey:"aria.tabs.correlations"},{key:"alerts",labelKey:"tabs.alerts",testId:"dashboard-alerts-tab",ariaLabelKey:"aria.tabs.alerts"}],kt={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_ENABLE_GEMMA_DEMO:"true",VITE_GEMMA_BASE_URL:"http://127.0.0.1:8000"},Tt=l.memo(({student:t,filteredData:a={entries:[],emotions:[],sensoryInputs:[]}})=>{const{tStudent:n,tAnalytics:s,tCommon:i}=Ue(),[o,k]=l.useState(!1),[g,m]=l.useState(!1),[T,j]=l.useState(!1),C=l.useRef(null),{results:h,isAnalyzing:I,runAnalysis:w,invalidateCacheForStudent:M}=vt({precomputeOnIdle:!1}),L=(()=>{try{const A=kt??{};return!!(A?.DEV||A?.MODE==="development"||A?.VITE_ENABLE_DEV_SEED==="true")}catch{return!1}})(),$=l.useCallback(async()=>{j(!0);try{const A=await B(()=>import("./mockSeeders-DlsGwPCZ.js"),__vite__mapDeps([47,17,6,16])),{seedDemoData:d}=A,{totalStudentsAffected:p,totalEntriesCreated:c}=await d({forExistingStudents:!0,createNewStudents:1,batchesPerStudent:1});E.success(String(s("dev.seed.success",{students:p,entries:c}))),M(t.id),w(a)}catch(A){f.error("[AnalyticsDashboard] Demo seed failed",{error:A}),E.error(String(s("dev.seed.failure")))}finally{j(!1)}},[a,M,w,t.id,s]);l.useEffect(()=>{const A=d=>{const p=c=>{try{if(c instanceof Date&&!isNaN(c.getTime()))return c;if(typeof c=="string"||typeof c=="number"){const b=new Date(c);return isNaN(b.getTime())?new Date:b}return new Date}catch(b){return f.error("Error coercing timestamp:",c,b),new Date}};try{return{entries:(d.entries||[]).map(c=>({...c,timestamp:p(c.timestamp)})),emotions:(d.emotions||[]).map(c=>({...c,timestamp:p(c.timestamp)})),sensoryInputs:(d.sensoryInputs||[]).map(c=>({...c,timestamp:p(c.timestamp)}))}}catch(c){return f.error("Error normalizing filteredData:",c),{entries:[],emotions:[],sensoryInputs:[]}}};a&&a.entries&&w(A(a)),Ks.initializeStudentAnalytics(t.id)},[t.id,a,w]),l.useEffect(()=>()=>{},[]);const v=l.useMemo(()=>h?.patterns||[],[h]),H=l.useMemo(()=>h?.correlations||[],[h]);l.useMemo(()=>h?.environmentalCorrelations||h?.correlations||[],[h]);const R=l.useMemo(()=>h?.insights||[],[h]),W=l.useCallback(async A=>{k(!0);try{const d={start:a.entries.length>0?a.entries.reduce((c,b)=>{const N=b.timestamp instanceof Date?b.timestamp:new Date(b.timestamp),_=c instanceof Date?c:new Date(c);return N<_?N:_},a.entries[0].timestamp):new Date,end:a.entries.length>0?a.entries.reduce((c,b)=>{const N=b.timestamp instanceof Date?b.timestamp:new Date(b.timestamp),_=c instanceof Date?c:new Date(c);return N>_?N:_},a.entries[0].timestamp):new Date},p={student:t,dateRange:d,data:a,analytics:{patterns:v,correlations:H,insights:R,predictiveInsights:h?.predictiveInsights||[],anomalies:h?.anomalies||[]},charts:A==="pdf"&&C.current?[{element:C.current,title:String(s("export.chartTitle"))}]:void 0,chartExports:A==="pdf"?await(async()=>{try{const c=(await B(async()=>{const{chartRegistry:x}=await import("./chartRegistry-BLFZNPaW.js");return{chartRegistry:x}},[])).chartRegistry.all();if(!c||c.length===0)return E.error(String(s("export.noCharts"))),[];const b=c.slice(0,6),_=(await Promise.all(b.map(async x=>{const r=x.getMethods(),u=r.getImage({pixelRatio:2,backgroundColor:"#ffffff"}),y=r.getSVG();return{title:x.title,type:x.type,dataURL:u,svgString:y}}))).filter(x=>x.dataURL||x.svgString);return _.length===0&&E.error(String(s("export.noCharts"))),_}catch(c){return f.error("Failed to collect chart exports",c),E.error(String(s("export.noCharts"))),[]}})():void 0};switch(A){case"pdf":await fe.exportToPDF(p),E.success(String(s("export.success.pdf")));break;case"csv":fe.exportToCSV(p),E.success(String(s("export.success.csv")));break;case"json":fe.exportToJSON(p),E.success(String(s("export.success.json")));break}}catch(d){f.error("Export failed:",d),E.error(String(s("export.failure")))}finally{k(!1)}},[a,t,v,H,R,h,s]),[J,te]=St({debounceMs:150,paramKey:"tab",defaultTab:"charts"}),[ae,Y]=l.useState("");return l.useEffect(()=>{try{f.debug("[AnalyticsDashboard] Active tab changed",{studentId:t.id,tab:J})}catch{}const A=Le.find(d=>d.key===J);if(A){const d=String(s(A.labelKey));Y(d)}},[J,s,t.id]),e.jsxs(ne,{children:[e.jsx("a",{href:"#analytics-tabpanel",className:"sr-only focus:not-sr-only focus:fixed focus:top-2 focus:left-2 focus:z-50 focus:px-4 focus:py-2 focus:rounded-md focus:bg-primary focus:text-primary-foreground",children:String(s("skipToContent"))}),e.jsxs("section",{role:"region","aria-labelledby":"analytics-dashboard-title",className:"space-y-6",children:[e.jsx("div",{id:"analytics-live-region",className:"sr-only","aria-live":"polite","aria-atomic":"true",role:"status",children:ae}),e.jsx(F,{children:e.jsxs(U,{className:"flex flex-row items-center justify-between",children:[e.jsx(G,{id:"analytics-dashboard-title",children:String(s("dashboard.title",{name:t.name}))}),e.jsxs("div",{className:"flex items-center gap-2",children:[L&&e.jsx(O,{variant:"outline",size:"sm",onClick:$,disabled:T,"aria-label":String(s("dev.seed.aria")),title:String(s("dev.seed.button")),children:String(s(T?"dev.seed.seeding":"dev.seed.button"))}),e.jsxs(O,{variant:"outline",size:"sm","aria-label":String(i("settings")),title:String(i("settings")),onClick:()=>m(!0),children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:String(i("settings"))})]}),e.jsxs(Ns,{children:[e.jsx(Ss,{asChild:!0,children:e.jsxs(O,{variant:"outline",size:"sm",disabled:o,"aria-label":String(i("export")),title:String(i("export")),children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:String(i(o?"exporting":"export"))})]})}),e.jsxs(ks,{align:"end",children:[e.jsxs(me,{onClick:()=>W("pdf"),disabled:o,children:[e.jsx(Bs,{className:"h-4 w-4 mr-2"}),String(i("exportAsPdf"))]}),e.jsxs(me,{onClick:()=>W("csv"),disabled:o,children:[e.jsx(Fs,{className:"h-4 w-4 mr-2"}),String(i("exportAsCsv"))]}),e.jsxs(me,{onClick:()=>W("json"),disabled:o,children:[e.jsx(Ls,{className:"h-4 w-4 mr-2"}),String(i("exportAsJson"))]})]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(F,{children:e.jsx(z,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:String(s("metrics.totalSessions"))}),e.jsx("p",{className:"text-2xl font-bold",children:a.entries.length})]}),e.jsx($s,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(F,{children:e.jsx(z,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:String(n("interface.emotionsTracked"))}),e.jsx("p",{className:"text-2xl font-bold",children:a.emotions.length})]}),e.jsx(ce,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(F,{children:e.jsx(z,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:String(n("interface.sensoryInputs"))}),e.jsx("p",{className:"text-2xl font-bold",children:a.sensoryInputs.length})]}),e.jsx(Hs,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(F,{children:e.jsx(z,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:String(s("metrics.patternsFound"))}),e.jsx("p",{className:"text-2xl font-bold",children:v.length})]}),e.jsx(Js,{className:"h-8 w-8 text-muted-foreground"})]})})})]}),e.jsxs(qe,{value:J,onValueChange:te,className:"w-full",children:[e.jsx(Ke,{className:"grid w-full grid-cols-4 relative z-10","aria-label":String(s("tabs.label")),children:Le.map(({key:A,labelKey:d,testId:p,ariaLabelKey:c})=>e.jsx(ee,{value:A,"aria-label":String(s(c||d)),"data-testid":p,children:String(s(d))},A))}),e.jsx(K,{id:"analytics-tabpanel",value:"charts",className:"space-y-6",tabIndex:-1,children:e.jsx("div",{ref:C,children:e.jsx(ne,{showToast:!1,children:e.jsx(l.Suspense,{fallback:e.jsx("div",{className:"h-[360px] rounded-xl border bg-card motion-safe:animate-pulse","aria-label":String(s("states.analyzing"))}),children:e.jsx(lt,{studentName:t.name,filteredData:a})})})})}),e.jsx(K,{value:"patterns",className:"space-y-6","aria-busy":I,children:e.jsx(ne,{showToast:!1,children:e.jsx(l.Suspense,{fallback:e.jsx("div",{className:"h-[280px] rounded-xl border bg-card motion-safe:animate-pulse","aria-label":String(s("states.analyzing"))}),children:e.jsx(ct,{filteredData:a})})})}),e.jsx(K,{value:"correlations",className:"space-y-6",children:e.jsx(ne,{showToast:!1,children:e.jsx(l.Suspense,{fallback:e.jsx("div",{className:"h-[420px] rounded-xl border bg-card motion-safe:animate-pulse","aria-label":String(s("states.analyzing"))}),children:e.jsx(dt,{filteredData:a})})})}),e.jsx(K,{value:"alerts",className:"space-y-6",children:e.jsx(ne,{showToast:!1,children:e.jsx(l.Suspense,{fallback:e.jsx("div",{className:"h-[200px] rounded-xl border bg-card motion-safe:animate-pulse","aria-label":String(s("states.analyzing"))}),children:e.jsx(ut,{filteredData:a,studentId:t.id})})})})]}),g&&e.jsx(ot,{onConfigChange:()=>{M(t.id),w(a)},onClose:()=>m(!1)})]})]})},(t,a)=>t.student.id===a.student.id&&t.student.name===a.student.name&&t.filteredData.entries.length===a.filteredData.entries.length&&t.filteredData.emotions.length===a.filteredData.emotions.length&&t.filteredData.sensoryInputs.length===a.filteredData.sensoryInputs.length&&(t.filteredData.entries.length===0||a.filteredData.entries.length===0||(()=>{try{const n=t.filteredData.entries[0]?.timestamp,s=a.filteredData.entries[0]?.timestamp,i=n instanceof Date?n.getTime():typeof n=="string"||typeof n=="number"?new Date(n).getTime():0,o=s instanceof Date?s.getTime():typeof s=="string"||typeof s=="number"?new Date(s).getTime():0;return i===o}catch(n){return f.error("Error comparing timestamps in AnalyticsDashboard memo:",n),!1}})())),sa=Object.freeze(Object.defineProperty({__proto__:null,AnalyticsDashboard:Tt},Symbol.toStringTag,{value:"Module"}));export{Tt as A,sa as a,vt as u};
